{"version":3,"file":"text-page.cjs.production.min.js","sources":["../src/setupEnv.ts","../src/appSettings.ts","../src/context/SettingsContext.tsx","../src/context/SharedHistoryContext.tsx","../src/ui/Modal.tsx","../src/hooks/useModal.tsx","../src/utils/join-classes.ts","../src/ui/Button.tsx","../src/plugins/ActionsPlugin.tsx","../src/nodes/AutocompleteNode.tsx","../src/utils/swipe.ts","../src/plugins/AutocompletePlugin.tsx","../src/plugins/AutoLinkPlugin.tsx","../src/plugins/ClickableLinkPlugin.ts","../src/plugins/CodeHighlightPlugin.ts","../src/nodes/EmojiNode.tsx","../src/plugins/EmojisPlugin.ts","../src/ui/EquationEditor.tsx","../src/ui/KatexRenderer.tsx","../src/nodes/EquationNode.tsx","../src/plugins/EquationsPlugin.ts","../src/ui/ImageResizer.tsx","../src/nodes/ExcalidrawNode/ExcalidrawImage.tsx","../src/nodes/ExcalidrawNode/index.tsx","../src/plugins/ExcalidrawPlugin.ts","../src/plugins/HorizontalRulePlugin.ts","../src/shared/src/getDOMSelection.ts","../src/nodes/KeywordNode.ts","../src/plugins/KeywordsPlugin.ts","../src/shared/src/useLayoutEffect.ts","../src/shared/src/canUseDOM.ts","../src/nodes/MentionNode.ts","../src/plugins/MentionsPlugin.tsx","../src/plugins/TableActionMenuPlugin.tsx","../src/nodes/ImageNode.tsx","../src/plugins/ImagesPlugin.ts","../src/plugins/ListMaxIndentLevelPlugin.ts","../src/plugins/MaxLengthPlugin.tsx","../src/nodes/PollNode.tsx","../src/plugins/PollPlugin.ts","../src/hooks/useReport.ts","../src/plugins/SpeechToTextPlugin.ts","../src/plugins/TabFocusPlugin.tsx","../src/plugins/TableCellResizer.tsx","../src/plugins/TextFormatFloatingToolbarPlugin.tsx","../src/shared/src/environment.ts","../src/nodes/StickyNode.tsx","../src/ui/DropDown.tsx","../src/ui/TextInput.tsx","../src/ui/ColorPicker.tsx","../src/ui/FileInput.tsx","../src/ui/KatexEquationAlterer.tsx","../src/ui/LinkPreview.tsx","../src/nodes/TweetNode.tsx","../src/plugins/TwitterPlugin.ts","../src/nodes/YouTubeNode.tsx","../src/plugins/YouTubePlugin.ts","../src/plugins/ToolbarPlugin.tsx","../src/ui/Placeholder.tsx","../src/Editor.tsx","../src/nodes/PlaygroundNodes.ts","../src/nodes/TypeaheadNode.ts","../src/plugins/TestRecorderPlugin.tsx","../src/ui/Switch.tsx","../src/Settings.tsx","../src/themes/PlaygroundEditorTheme.ts","../src/App.tsx","../src/index.tsx"],"sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {DEFAULT_SETTINGS, Settings} from './appSettings';\n\n// override default options with query parameters if any\nconst urlSearchParams = new URLSearchParams(window.location.search);\n\nfor (const param of Object.keys(DEFAULT_SETTINGS)) {\n  if (urlSearchParams.has(param)) {\n    try {\n      const value = JSON.parse(urlSearchParams.get(param) ?? 'true');\n      DEFAULT_SETTINGS[param as keyof Settings] = Boolean(value);\n    } catch (error) {\n      console.warn(`Unable to parse query parameter \"${param}\"`);\n    }\n  }\n}\n\nif (DEFAULT_SETTINGS.disableBeforeInput) {\n  // @ts-expect-error\n  delete window.InputEvent.prototype.getTargetRanges;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport type SettingName =\n  | 'disableBeforeInput'\n  | 'measureTypingPerf'\n  | 'isRichText'\n  | 'isCollab'\n  | 'isCharLimit'\n  | 'isMaxLength'\n  | 'isCharLimitUtf8'\n  | 'isAutocomplete'\n  | 'showTreeView'\n  | 'showNestedEditorTreeView'\n  | 'emptyEditor';\n\nexport type Settings = Record<SettingName, boolean>;\n\nconst hostName = window.location.hostname;\nexport const isDevPlayground: boolean =\n  hostName !== 'playground.lexical.dev' &&\n  hostName !== 'lexical-playground.vercel.app';\n\nexport const DEFAULT_SETTINGS: Settings = {\n  disableBeforeInput: false,\n  emptyEditor: isDevPlayground,\n  isAutocomplete: false,\n  isCharLimit: false,\n  isCharLimitUtf8: false,\n  isCollab: false,\n  isMaxLength: false,\n  isRichText: true,\n  measureTypingPerf: false,\n  showNestedEditorTreeView: false,\n  showTreeView: true,\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {SettingName} from '../appSettings';\n\nimport * as React from 'react';\nimport {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n} from 'react';\n\nimport {DEFAULT_SETTINGS} from '../appSettings';\n\ntype SettingsContextShape = {\n  setOption: (name: SettingName, value: boolean) => void;\n  settings: Record<SettingName, boolean>;\n};\n\nconst Context: React.Context<SettingsContextShape> = createContext({\n  setOption: (name: SettingName, value: boolean) => {\n    return;\n  },\n  settings: DEFAULT_SETTINGS,\n});\n\nexport const SettingsContext = ({\n  children,\n}: {\n  children: ReactNode;\n}): JSX.Element => {\n  const [settings, setSettings] = useState(DEFAULT_SETTINGS);\n\n  const setOption = useCallback((setting: SettingName, value: boolean) => {\n    setSettings((options) => ({\n      ...options,\n      [setting as string]: value,\n    }));\n    if (DEFAULT_SETTINGS[setting] === value) {\n      setURLParam(setting, null);\n    } else {\n      setURLParam(setting, value);\n    }\n  }, []);\n\n  const contextValue = useMemo(() => {\n    return {setOption, settings};\n  }, [setOption, settings]);\n\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n};\n\nexport const useSettings = (): SettingsContextShape => {\n  return useContext(Context);\n};\n\nfunction setURLParam(param: SettingName, value: null | boolean) {\n  const url = new URL(window.location.href);\n  const params = new URLSearchParams(url.search);\n  if (value !== null) {\n    if (params.has(param)) {\n      params.set(param, String(value));\n    } else {\n      params.append(param, String(value));\n    }\n  } else {\n    if (params.has(param)) {\n      params.delete(param);\n    }\n  }\n  url.search = params.toString();\n  window.history.pushState(null, '', url.toString());\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {HistoryState} from '@lexical/react/LexicalHistoryPlugin';\n\nimport {createEmptyHistoryState} from '@lexical/react/LexicalHistoryPlugin';\nimport * as React from 'react';\nimport {createContext, ReactNode, useContext, useMemo} from 'react';\n\ntype ContextShape = {\n  historyState?: HistoryState;\n};\n\nconst Context: React.Context<ContextShape> = createContext({});\n\nexport const SharedHistoryContext = ({\n  children,\n}: {\n  children: ReactNode;\n}): JSX.Element => {\n  const historyContext = useMemo(\n    () => ({historyState: createEmptyHistoryState()}),\n    [],\n  );\n  return <Context.Provider value={historyContext}>{children}</Context.Provider>;\n};\n\nexport const useSharedHistoryContext = (): ContextShape => {\n  return useContext(Context);\n};\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './Modal.css';\n\nimport * as React from 'react';\nimport {ReactNode, useEffect, useRef} from 'react';\nimport {createPortal} from 'react-dom';\n\nfunction PortalImpl({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside,\n}: {\n  children: ReactNode;\n  closeOnClickOutside: boolean;\n  onClose: () => void;\n  title: string;\n}) {\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (modalRef.current !== null) {\n      modalRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    let modalOverlayElement: HTMLElement | null = null;\n    const handler = (event: KeyboardEvent) => {\n      if (event.keyCode === 27) {\n        onClose();\n      }\n    };\n    const clickOutsideHandler = (event: MouseEvent) => {\n      const target = event.target;\n      if (\n        modalRef.current !== null &&\n        !modalRef.current.contains(target as Node) &&\n        closeOnClickOutside\n      ) {\n        onClose();\n      }\n    };\n    if (modalRef.current !== null) {\n      modalOverlayElement = modalRef.current?.parentElement;\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.addEventListener('click', clickOutsideHandler);\n      }\n    }\n\n    window.addEventListener('keydown', handler);\n\n    return () => {\n      window.removeEventListener('keydown', handler);\n      if (modalOverlayElement !== null) {\n        modalOverlayElement?.removeEventListener('click', clickOutsideHandler);\n      }\n    };\n  }, [closeOnClickOutside, onClose]);\n\n  return (\n    <div className=\"Modal__overlay\" role=\"dialog\">\n      <div className=\"Modal__modal\" tabIndex={-1} ref={modalRef}>\n        <h2 className=\"Modal__title\">{title}</h2>\n        <button\n          className=\"Modal__closeButton\"\n          aria-label=\"Close modal\"\n          type=\"button\"\n          onClick={onClose}>\n          X\n        </button>\n        <div className=\"Modal__content\">{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Modal({\n  onClose,\n  children,\n  title,\n  closeOnClickOutside = false,\n}: {\n  children: ReactNode;\n  closeOnClickOutside?: boolean;\n  onClose: () => void;\n  title: string;\n}): JSX.Element {\n  return createPortal(\n    <PortalImpl\n      onClose={onClose}\n      title={title}\n      closeOnClickOutside={closeOnClickOutside}>\n      {children}\n    </PortalImpl>,\n    document.body,\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useCallback, useMemo, useState} from 'react';\nimport * as React from 'react';\n\nimport Modal from '../ui/Modal';\n\nexport default function useModal(): [\n  JSX.Element | null,\n  (title: string, showModal: (onClose: () => void) => JSX.Element) => void,\n] {\n  const [modalContent, setModalContent] = useState<null | {\n    closeOnClickOutside: boolean;\n    content: JSX.Element;\n    title: string;\n  }>(null);\n\n  const onClose = useCallback(() => {\n    setModalContent(null);\n  }, []);\n\n  const modal = useMemo(() => {\n    if (modalContent === null) {\n      return null;\n    }\n    const {title, content, closeOnClickOutside} = modalContent;\n    return (\n      <Modal\n        onClose={onClose}\n        title={title}\n        closeOnClickOutside={closeOnClickOutside}>\n        {content}\n      </Modal>\n    );\n  }, [modalContent, onClose]);\n\n  const showModal = useCallback(\n    (\n      title: string,\n      // eslint-disable-next-line no-shadow\n      getContent: (onClose: () => void) => JSX.Element,\n      closeOnClickOutside = false,\n    ) => {\n      setModalContent({\n        closeOnClickOutside,\n        content: getContent(onClose),\n        title,\n      });\n    },\n    [onClose],\n  );\n\n  return [modal, showModal];\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport default function joinClasses(\n  ...args: Array<string | boolean | null | undefined>\n) {\n  return args.filter(Boolean).join(' ');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './Button.css';\n\nimport * as React from 'react';\nimport {ReactNode} from 'react';\n\nimport joinClasses from '../utils/join-classes';\n\nexport default function Button({\n  'data-test-id': dataTestId,\n  children,\n  className,\n  onClick,\n  disabled,\n  small,\n  title,\n}: {\n  'data-test-id'?: string;\n  children: ReactNode;\n  className?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  small?: boolean;\n  title?: string;\n}): JSX.Element {\n  return (\n    <button\n      disabled={disabled}\n      className={joinClasses(\n        'Button__root',\n        disabled && 'Button__disabled',\n        small && 'Button__small',\n        className,\n      )}\n      onClick={onClick}\n      title={title}\n      aria-label={title}\n      {...(dataTestId && {'data-test-id': dataTestId})}>\n      {children}\n    </button>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalEditor} from 'lexical';\n\nimport {$createCodeNode, $isCodeNode} from '@lexical/code';\n// import {exportFile, importFile} from '@lexical/file';\nimport {\n  $convertFromMarkdownString,\n  $convertToMarkdownString,\n} from '@lexical/markdown';\n// import {useCollaborationContext} from '@lexical/react/LexicalCollaborationPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {mergeRegister} from '@lexical/utils';\nimport {CONNECTED_COMMAND, TOGGLE_CONNECT_COMMAND} from '@lexical/yjs';\nimport {\n  $createTextNode,\n  $getRoot,\n  $isParagraphNode,\n  CLEAR_EDITOR_COMMAND,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useEffect, useState} from 'react';\n\nimport useModal from '../hooks/useModal';\nimport Button from '../ui/Button';\n// import {PLAYGROUND_TRANSFORMERS} from './MarkdownTransformers';\nimport {\n  SPEECH_TO_TEXT_COMMAND,\n  SUPPORT_SPEECH_RECOGNITION,\n} from './SpeechToTextPlugin';\n\nexport default function ActionsPlugin({\n  isRichText,\n}: {\n  isRichText: boolean;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  // const [isReadOnly, setIsReadyOnly] = useState(() => editor.isReadOnly());\n  const [isSpeechToText, setIsSpeechToText] = useState(false);\n  const [connected, setConnected] = useState(false);\n  const [isEditorEmpty, setIsEditorEmpty] = useState(true);\n  const [modal, showModal] = useModal();\n  // const {yjsDocMap} = useCollaborationContext();\n  // const isCollab = yjsDocMap.get('main') !== undefined;\n\n  // useEffect(() => {\n  //   return mergeRegister(\n  //     editor.registerReadOnlyListener((readOnly) => {\n  //       setIsReadyOnly(readOnly);\n  //     }),\n  //     editor.registerCommand<boolean>(\n  //       CONNECTED_COMMAND,\n  //       (payload) => {\n  //         const isConnected = payload;\n  //         setConnected(isConnected);\n  //         return false;\n  //       },\n  //       COMMAND_PRIORITY_EDITOR,\n  //     ),\n  //   );\n  // }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        const root = $getRoot();\n        const children = root.getChildren();\n\n        if (children.length > 1) {\n          setIsEditorEmpty(false);\n        } else {\n          if ($isParagraphNode(children[0])) {\n            const paragraphChildren = children[0].getChildren();\n            setIsEditorEmpty(paragraphChildren.length === 0);\n          } else {\n            setIsEditorEmpty(false);\n          }\n        }\n      });\n    });\n  }, [editor]);\n\n  const handleMarkdownToggle = useCallback(() => {\n    editor.update(() => {\n      const root = $getRoot();\n      const firstChild = root.getFirstChild();\n      if ($isCodeNode(firstChild) && firstChild.getLanguage() === 'markdown') {\n        // $convertFromMarkdownString(\n        //   firstChild.getTextContent(),\n        //   PLAYGROUND_TRANSFORMERS,\n        // );\n      } else {\n        // const markdown = $convertToMarkdownString(PLAYGROUND_TRANSFORMERS);\n        // root\n        //   .clear()\n        //   .append(\n        //     $createCodeNode('markdown').append($createTextNode(markdown)),\n        //   );\n      }\n      root.selectEnd();\n    });\n  }, [editor]);\n\n  return (\n    <div className=\"actions\">\n      {/* {SUPPORT_SPEECH_RECOGNITION && (\n        // <button\n        //   onClick={() => {\n        //     editor.dispatchCommand<boolean>(\n        //       SPEECH_TO_TEXT_COMMAND,\n        //       !isSpeechToText,\n        //     );\n        //     setIsSpeechToText(!isSpeechToText);\n        //   }}\n        //   className={\n        //     'action-button action-button-mic ' +\n        //     (isSpeechToText ? 'active' : '')\n        //   }\n        //   title=\"Speech To Text\"\n        //   aria-label={`${\n        //     isSpeechToText ? 'Enable' : 'Disable'\n        //   } speech to text`}>\n        //   <i className=\"mic\" />\n        // </button>\n      )} */}\n      {/* <button\n        className=\"action-button import\"\n        onClick={() => importFile(editor)}\n        title=\"Import\"\n        aria-label=\"Import editor state from JSON\">\n        <i className=\"import\" />\n      </button> */}\n      {/* <button\n        className=\"action-button export\"\n        onClick={() =>\n          exportFile(editor, {\n            fileName: `Playground ${new Date().toISOString()}`,\n            source: 'Playground',\n          })\n        }\n        title=\"Export\"\n        aria-label=\"Export editor state to JSON\">\n        <i className=\"export\" />\n      </button> */}\n      <button\n        className=\"action-button clear\"\n        disabled={isEditorEmpty}\n        onClick={() => {\n          showModal('Clear editor', (onClose) => (\n            <ShowClearDialog editor={editor} onClose={onClose} />\n          ));\n        }}\n        title=\"Clear\"\n        aria-label=\"Clear editor contents\">\n        <i className=\"clear\" />\n      </button>\n      {/* <button\n        className={`action-button ${isReadOnly ? 'unlock' : 'lock'}`}\n        onClick={() => {\n          editor.setReadOnly(!editor.isReadOnly());\n        }}\n        title=\"Read-Only Mode\"\n        aria-label={`${isReadOnly ? 'Unlock' : 'Lock'} read-only mode`}>\n        <i className={isReadOnly ? 'unlock' : 'lock'} />\n      </button> */}\n      <button\n        className=\"action-button\"\n        onClick={handleMarkdownToggle}\n        title=\"Convert From Markdown\"\n        aria-label=\"Convert from markdown\">\n        <i className=\"markdown\" />\n      </button>\n      {/* {isCollab && (\n        <button\n          className=\"action-button connect\"\n          onClick={() => {\n            editor.dispatchCommand(TOGGLE_CONNECT_COMMAND, !connected);\n          }}\n          title={`${\n            connected ? 'Disconnect' : 'Connect'\n          } Collaborative Editing`}\n          aria-label={`${\n            connected ? 'Disconnect from' : 'Connect to'\n          } a collaborative editing server`}>\n          <i className={connected ? 'disconnect' : 'connect'} />\n        </button>\n      )} */}\n      {modal}\n    </div>\n  );\n}\n\nfunction ShowClearDialog({\n  editor,\n  onClose,\n}: {\n  editor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  return (\n    <>\n      Are you sure you want to clear the editor?\n      <div className=\"Modal__content\">\n        {/* <Button\n          onClick={() => {\n            editor.dispatchCommand<void>(CLEAR_EDITOR_COMMAND, undefined);\n            editor.focus();\n            onClose();\n          }}>\n          Clear\n        </Button>{' '} */}\n        <Button\n          onClick={() => {\n            editor.focus();\n            onClose();\n          }}>\n          Cancel\n        </Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {Spread} from 'lexical';\n\nimport {\n  DecoratorNode,\n  EditorConfig,\n  NodeKey,\n  SerializedLexicalNode,\n} from 'lexical';\nimport * as React from 'react';\n\n// import {useSharedAutocompleteContext} from '../context/SharedAutocompleteContext';\nimport {uuid as UUID} from '../plugins/AutocompletePlugin';\n\nexport type SerializedAutocompleteNode = Spread<\n  {\n    type: 'autocomplete';\n    version: 1;\n    uuid: string;\n  },\n  SerializedLexicalNode\n>;\n\nexport class AutocompleteNode extends DecoratorNode<JSX.Element | null> {\n  // TODO add comment\n  __uuid: string;\n\n  static clone(node: AutocompleteNode): AutocompleteNode {\n    return new AutocompleteNode(node.__key);\n  }\n\n  static getType(): 'autocomplete' {\n    return 'autocomplete';\n  }\n\n  static importJSON(\n    serializedNode: SerializedAutocompleteNode,\n  ): AutocompleteNode {\n    const node = $createAutocompleteNode(serializedNode.uuid);\n    return node;\n  }\n\n  exportJSON(): SerializedAutocompleteNode {\n    return {\n      ...super.exportJSON(),\n      type: 'autocomplete',\n      uuid: this.__uuid,\n      version: 1,\n    };\n  }\n\n  constructor(uuid: string, key?: NodeKey) {\n    super(key);\n    this.__uuid = uuid;\n  }\n\n  updateDOM(\n    prevNode: unknown,\n    dom: HTMLElement,\n    config: EditorConfig,\n  ): boolean {\n    return false;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    return document.createElement('span');\n  }\n\n  decorate(): JSX.Element | null {\n    if (this.__uuid !== UUID) {\n      return null;\n    }\n    return <AutocompleteComponent />;\n  }\n}\n\nexport function $createAutocompleteNode(uuid: string): AutocompleteNode {\n  return new AutocompleteNode(uuid);\n}\n\nfunction AutocompleteComponent(): JSX.Element {\n  // const [suggestion] = useSharedAutocompleteContext();\n  // @ts-ignore Experimental property\n  const userAgentData = window.navigator.userAgentData;\n  const isMobile =\n    userAgentData !== undefined\n      ? userAgentData.mobile\n      : window.innerWidth <= 800 && window.innerHeight <= 600;\n  // TODO Move to theme\n  return (\n    <span style={{color: '#ccc'}} spellCheck=\"false\">\n      {/* {suggestion} {isMobile ? '(SWIPE \\u2B95)' : '(TAB)'} */}\n    </span>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\ntype Force = [number, number];\ntype Listener = (force: Force, e: TouchEvent) => void;\ntype ElementValues = {\n  start: null | Force;\n  listeners: Set<Listener>;\n  handleTouchstart: (e: TouchEvent) => void;\n  handleTouchend: (e: TouchEvent) => void;\n};\n\nconst elements = new WeakMap<HTMLElement, ElementValues>();\n\nfunction readTouch(e: TouchEvent): [number, number] | null {\n  const touch = e.changedTouches[0];\n  if (touch === undefined) {\n    return null;\n  }\n  return [touch.clientX, touch.clientY];\n}\n\nfunction addListener(element: HTMLElement, cb: Listener): () => void {\n  let elementValues = elements.get(element);\n  if (elementValues === undefined) {\n    const listeners = new Set<Listener>();\n    const handleTouchstart = (e: TouchEvent) => {\n      if (elementValues !== undefined) {\n        elementValues.start = readTouch(e);\n      }\n    };\n    const handleTouchend = (e: TouchEvent) => {\n      if (elementValues === undefined) {\n        return;\n      }\n      const start = elementValues.start;\n      if (start === null) {\n        return;\n      }\n      const end = readTouch(e);\n      for (const listener of listeners) {\n        if (end !== null) {\n          listener([end[0] - start[0], end[1] - start[1]], e);\n        }\n      }\n    };\n    element.addEventListener('touchstart', handleTouchstart);\n    element.addEventListener('touchend', handleTouchend);\n\n    elementValues = {\n      handleTouchend,\n      handleTouchstart,\n      listeners,\n      start: null,\n    };\n    elements.set(element, elementValues);\n  }\n  elementValues.listeners.add(cb);\n  return () => deleteListener(element, cb);\n}\n\nfunction deleteListener(element: HTMLElement, cb: Listener): void {\n  const elementValues = elements.get(element);\n  if (elementValues === undefined) {\n    return;\n  }\n  const listeners = elementValues.listeners;\n  listeners.delete(cb);\n  if (listeners.size === 0) {\n    elements.delete(element);\n    element.removeEventListener('touchstart', elementValues.handleTouchstart);\n    element.removeEventListener('touchend', elementValues.handleTouchend);\n  }\n}\n\nexport function addSwipeLeftListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n) {\n  return addListener(element, (force, e) => {\n    const [x, y] = force;\n    if (x < 0 && -x > Math.abs(y)) {\n      cb(x, e);\n    }\n  });\n}\n\nexport function addSwipeRightListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n) {\n  return addListener(element, (force, e) => {\n    const [x, y] = force;\n    if (x > 0 && x > Math.abs(y)) {\n      cb(x, e);\n    }\n  });\n}\n\nexport function addSwipeUpListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n) {\n  return addListener(element, (force, e) => {\n    const [x, y] = force;\n    if (y < 0 && -y > Math.abs(x)) {\n      cb(x, e);\n    }\n  });\n}\n\nexport function addSwipeDownListener(\n  element: HTMLElement,\n  cb: (_force: number, e: TouchEvent) => void,\n) {\n  return addListener(element, (force, e) => {\n    const [x, y] = force;\n    if (y > 0 && y > Math.abs(x)) {\n      cb(x, e);\n    }\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  GridSelection,\n  NodeKey,\n  NodeSelection,\n  RangeSelection,\n} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {$isAtNodeEnd} from '@lexical/selection';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $createTextNode,\n  $getNodeByKey,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  $setSelection,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_RIGHT_COMMAND,\n  KEY_TAB_COMMAND,\n} from 'lexical';\nimport {useCallback, useEffect} from 'react';\n\n// import {useSharedAutocompleteContext} from '../context/SharedAutocompleteContext';\nimport {\n  $createAutocompleteNode,\n  AutocompleteNode,\n} from '../nodes/AutocompleteNode';\nimport {addSwipeRightListener} from '../utils/swipe';\n\ntype SearchPromise = {\n  dismiss: () => void;\n  promise: Promise<null | string>;\n};\n\nexport const uuid = Math.random()\n  .toString(36)\n  .replace(/[^a-z]+/g, '')\n  .substr(0, 5);\n\n// TODO lookup should be custom\nfunction $search(\n  selection: null | RangeSelection | NodeSelection | GridSelection,\n): [boolean, string] {\n  if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n    return [false, ''];\n  }\n  const node = selection.getNodes()[0];\n  const anchor = selection.anchor;\n  // Check siblings?\n  if (!$isTextNode(node) || !node.isSimpleText() || !$isAtNodeEnd(anchor)) {\n    return [false, ''];\n  }\n  const word = [];\n  const text = node.getTextContent();\n  let i = node.getTextContentSize();\n  let c;\n  while (i-- && i >= 0 && (c = text[i]) !== ' ') {\n    word.push(c);\n  }\n  if (word.length === 0) {\n    return [false, ''];\n  }\n  return [true, word.reverse().join('')];\n}\n\n// TODO query should be custom\nfunction useQuery(): (searchText: string) => SearchPromise {\n  return useCallback((searchText: string) => {\n    const server = new AutocompleteServer();\n    console.time('query');\n    const response = server.query(searchText);\n    console.timeEnd('query');\n    return response;\n  }, []);\n}\n\nexport default function AutocompletePlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  // const [, setSuggestion] = useSharedAutocompleteContext();\n  const query = useQuery();\n\n  useEffect(() => {\n    let autocompleteNodeKey: null | NodeKey = null;\n    let lastMatch: null | string = null;\n    let lastSuggestion: null | string = null;\n    let searchPromise: null | SearchPromise = null;\n    function $clearSuggestion() {\n      const autocompleteNode =\n        autocompleteNodeKey !== null\n          ? $getNodeByKey(autocompleteNodeKey)\n          : null;\n      if (autocompleteNode !== null && autocompleteNode.isAttached()) {\n        autocompleteNode.remove();\n        autocompleteNodeKey = null;\n      }\n      if (searchPromise !== null) {\n        searchPromise.dismiss();\n        searchPromise = null;\n      }\n      lastMatch = null;\n      lastSuggestion = null;\n      // setSuggestion(null);\n    }\n    function updateAsyncSuggestion(\n      refSearchPromise: SearchPromise,\n      newSuggestion: null | string,\n    ) {\n      if (searchPromise !== refSearchPromise || newSuggestion === null) {\n        // Outdated or no suggestion\n        return;\n      }\n      editor.update(\n        () => {\n          const selection = $getSelection();\n          // const [hasMatch, match] = $search(selection);\n          // if (\n          //   !hasMatch ||\n          //   match !== lastMatch ||\n          //   !$isRangeSelection(selection)\n          // ) {\n          //   // Outdated\n          //   return;\n          // }\n          // const selectionCopy = selection.clone();\n          // const node = $createAutocompleteNode(uuid);\n          // autocompleteNodeKey = node.getKey();\n          // selection.insertNodes([node]);\n          // $setSelection(selectionCopy);\n          lastSuggestion = newSuggestion;\n          // setSuggestion(newSuggestion);\n        },\n        {tag: 'history-merge'},\n      );\n    }\n\n    function handleAutocompleteNodeTransform(node: AutocompleteNode) {\n      const key = node.getKey();\n      if (node.__uuid === uuid && key !== autocompleteNodeKey) {\n        // Max one Autocomplete node per session\n        $clearSuggestion();\n      }\n    }\n    function handleUpdate() {\n      editor.update(() => {\n        const selection = $getSelection();\n        // const [hasMatch, match] = $search(selection);\n        // if (!hasMatch) {\n        //   $clearSuggestion();\n        //   return;\n        // }\n        // if (match === lastMatch) {\n        //   return;\n        // }\n        $clearSuggestion();\n        // searchPromise = query(match);\n        // searchPromise.promise\n        //   .then((newSuggestion) => {\n        //     if (searchPromise !== null) {\n        //       updateAsyncSuggestion(searchPromise, newSuggestion);\n        //     }\n        //   })\n        //   .catch((e) => {\n        //     console.error(e);\n        //   });\n        // lastMatch = match;\n      });\n    }\n    function $handleAutocompleteIntent(): boolean {\n      if (lastSuggestion === null || autocompleteNodeKey === null) {\n        return false;\n      }\n      const autocompleteNode = $getNodeByKey(autocompleteNodeKey);\n      if (autocompleteNode === null) {\n        return false;\n      }\n      const textNode = $createTextNode(lastSuggestion);\n      autocompleteNode.replace(textNode);\n      textNode.selectNext();\n      $clearSuggestion();\n      return true;\n    }\n    function $handleKeypressCommand(e: Event) {\n      if ($handleAutocompleteIntent()) {\n        e.preventDefault();\n        return true;\n      }\n      return false;\n    }\n    function handleSwipeRight(_force: number, e: TouchEvent) {\n      editor.update(() => {\n        if ($handleAutocompleteIntent()) {\n          e.preventDefault();\n        }\n      });\n    }\n    function unmountSuggestion() {\n      editor.update(() => {\n        $clearSuggestion();\n      });\n    }\n\n    const rootElem = editor.getRootElement();\n\n    return mergeRegister(\n      editor.registerNodeTransform(\n        AutocompleteNode,\n        handleAutocompleteNodeTransform,\n      ),\n      editor.registerUpdateListener(handleUpdate),\n      editor.registerCommand(\n        KEY_TAB_COMMAND,\n        $handleKeypressCommand,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_ARROW_RIGHT_COMMAND,\n        $handleKeypressCommand,\n        COMMAND_PRIORITY_LOW,\n      ),\n      ...(rootElem !== null\n        ? [addSwipeRightListener(rootElem, handleSwipeRight)]\n        : []),\n      unmountSuggestion,\n    );\n  }, [editor, query]);\n\n  return null;\n}\n\n/*\n * Simulate an asynchronous autocomplete server (typical in more common use cases like GMail where\n * the data is not static).\n */\nclass AutocompleteServer {\n  DATABASE = DICTIONARY;\n  LATENCY = 200;\n\n  query = (searchText: string): SearchPromise => {\n    let isDismissed = false;\n\n    const dismiss = () => {\n      isDismissed = true;\n    };\n    const promise: Promise<null | string> = new Promise((resolve, reject) => {\n      setTimeout(() => {\n        if (isDismissed) {\n          // TODO cache result\n          return reject('Dismissed');\n        }\n        const searchTextLength = searchText.length;\n        if (searchText === '' || searchTextLength < 4) {\n          return resolve(null);\n        }\n        const char0 = searchText.charCodeAt(0);\n        const isCapitalized = char0 >= 65 && char0 <= 90;\n        const caseInsensitiveSearchText = isCapitalized\n          ? String.fromCharCode(char0 + 32) + searchText.substring(1)\n          : searchText;\n        const match = this.DATABASE.find(\n          (dictionaryWord) =>\n            dictionaryWord.startsWith(caseInsensitiveSearchText) ?? null,\n        );\n        if (match === undefined) {\n          return resolve(null);\n        }\n        const matchCapitalized = isCapitalized\n          ? String.fromCharCode(match.charCodeAt(0) - 32) + match.substring(1)\n          : match;\n        const autocompleteChunk = matchCapitalized.substring(searchTextLength);\n        if (autocompleteChunk === '') {\n          return resolve(null);\n        }\n        return resolve(autocompleteChunk);\n      }, this.LATENCY);\n    });\n\n    return {\n      dismiss,\n      promise,\n    };\n  };\n}\n\n// https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-usa-no-swears-long.txt\nconst DICTIONARY = [\n  'information',\n  'available',\n  'copyright',\n  'university',\n  'management',\n  'international',\n  'development',\n  'education',\n  'community',\n  'technology',\n  'following',\n  'resources',\n  'including',\n  'directory',\n  'government',\n  'department',\n  'description',\n  'insurance',\n  'different',\n  'categories',\n  'conditions',\n  'accessories',\n  'september',\n  'questions',\n  'application',\n  'financial',\n  'equipment',\n  'performance',\n  'experience',\n  'important',\n  'activities',\n  'additional',\n  'something',\n  'professional',\n  'committee',\n  'washington',\n  'california',\n  'reference',\n  'companies',\n  'computers',\n  'president',\n  'australia',\n  'discussion',\n  'entertainment',\n  'agreement',\n  'marketing',\n  'association',\n  'collection',\n  'solutions',\n  'electronics',\n  'technical',\n  'microsoft',\n  'conference',\n  'environment',\n  'statement',\n  'downloads',\n  'applications',\n  'requirements',\n  'individual',\n  'subscribe',\n  'everything',\n  'production',\n  'commercial',\n  'advertising',\n  'treatment',\n  'newsletter',\n  'knowledge',\n  'currently',\n  'construction',\n  'registered',\n  'protection',\n  'engineering',\n  'published',\n  'corporate',\n  'customers',\n  'materials',\n  'countries',\n  'standards',\n  'political',\n  'advertise',\n  'environmental',\n  'availability',\n  'employment',\n  'commission',\n  'administration',\n  'institute',\n  'sponsored',\n  'electronic',\n  'condition',\n  'effective',\n  'organization',\n  'selection',\n  'corporation',\n  'executive',\n  'necessary',\n  'according',\n  'particular',\n  'facilities',\n  'opportunities',\n  'appropriate',\n  'statistics',\n  'investment',\n  'christmas',\n  'registration',\n  'furniture',\n  'wednesday',\n  'structure',\n  'distribution',\n  'industrial',\n  'potential',\n  'responsible',\n  'communications',\n  'associated',\n  'foundation',\n  'documents',\n  'communication',\n  'independent',\n  'operating',\n  'developed',\n  'telephone',\n  'population',\n  'navigation',\n  'operations',\n  'therefore',\n  'christian',\n  'understand',\n  'publications',\n  'worldwide',\n  'connection',\n  'publisher',\n  'introduction',\n  'properties',\n  'accommodation',\n  'excellent',\n  'opportunity',\n  'assessment',\n  'especially',\n  'interface',\n  'operation',\n  'restaurants',\n  'beautiful',\n  'locations',\n  'significant',\n  'technologies',\n  'manufacturer',\n  'providing',\n  'authority',\n  'considered',\n  'programme',\n  'enterprise',\n  'educational',\n  'employees',\n  'alternative',\n  'processing',\n  'responsibility',\n  'resolution',\n  'publication',\n  'relations',\n  'photography',\n  'components',\n  'assistance',\n  'completed',\n  'organizations',\n  'otherwise',\n  'transportation',\n  'disclaimer',\n  'membership',\n  'recommended',\n  'background',\n  'character',\n  'maintenance',\n  'functions',\n  'trademarks',\n  'phentermine',\n  'submitted',\n  'television',\n  'interested',\n  'throughout',\n  'established',\n  'programming',\n  'regarding',\n  'instructions',\n  'increased',\n  'understanding',\n  'beginning',\n  'associates',\n  'instruments',\n  'businesses',\n  'specified',\n  'restaurant',\n  'procedures',\n  'relationship',\n  'traditional',\n  'sometimes',\n  'themselves',\n  'transport',\n  'interesting',\n  'evaluation',\n  'implementation',\n  'galleries',\n  'references',\n  'presented',\n  'literature',\n  'respective',\n  'definition',\n  'secretary',\n  'networking',\n  'australian',\n  'magazines',\n  'francisco',\n  'individuals',\n  'guidelines',\n  'installation',\n  'described',\n  'attention',\n  'difference',\n  'regulations',\n  'certificate',\n  'directions',\n  'documentation',\n  'automotive',\n  'successful',\n  'communities',\n  'situation',\n  'publishing',\n  'emergency',\n  'developing',\n  'determine',\n  'temperature',\n  'announcements',\n  'historical',\n  'ringtones',\n  'difficult',\n  'scientific',\n  'satellite',\n  'particularly',\n  'functional',\n  'monitoring',\n  'architecture',\n  'recommend',\n  'dictionary',\n  'accounting',\n  'manufacturing',\n  'professor',\n  'generally',\n  'continued',\n  'techniques',\n  'permission',\n  'generation',\n  'component',\n  'guarantee',\n  'processes',\n  'interests',\n  'paperback',\n  'classifieds',\n  'supported',\n  'competition',\n  'providers',\n  'characters',\n  'thousands',\n  'apartments',\n  'generated',\n  'administrative',\n  'practices',\n  'reporting',\n  'essential',\n  'affiliate',\n  'immediately',\n  'designated',\n  'integrated',\n  'configuration',\n  'comprehensive',\n  'universal',\n  'presentation',\n  'languages',\n  'compliance',\n  'improvement',\n  'pennsylvania',\n  'challenge',\n  'acceptance',\n  'strategies',\n  'affiliates',\n  'multimedia',\n  'certified',\n  'computing',\n  'interactive',\n  'procedure',\n  'leadership',\n  'religious',\n  'breakfast',\n  'developer',\n  'approximately',\n  'recommendations',\n  'comparison',\n  'automatically',\n  'minnesota',\n  'adventure',\n  'institutions',\n  'assistant',\n  'advertisement',\n  'headlines',\n  'yesterday',\n  'determined',\n  'wholesale',\n  'extension',\n  'statements',\n  'completely',\n  'electrical',\n  'applicable',\n  'manufacturers',\n  'classical',\n  'dedicated',\n  'direction',\n  'basketball',\n  'wisconsin',\n  'personnel',\n  'identified',\n  'professionals',\n  'advantage',\n  'newsletters',\n  'estimated',\n  'anonymous',\n  'miscellaneous',\n  'integration',\n  'interview',\n  'framework',\n  'installed',\n  'massachusetts',\n  'associate',\n  'frequently',\n  'discussions',\n  'laboratory',\n  'destination',\n  'intelligence',\n  'specifications',\n  'tripadvisor',\n  'residential',\n  'decisions',\n  'industries',\n  'partnership',\n  'editorial',\n  'expression',\n  'provisions',\n  'principles',\n  'suggestions',\n  'replacement',\n  'strategic',\n  'economics',\n  'compatible',\n  'apartment',\n  'netherlands',\n  'consulting',\n  'recreation',\n  'participants',\n  'favorites',\n  'translation',\n  'estimates',\n  'protected',\n  'philadelphia',\n  'officials',\n  'contained',\n  'legislation',\n  'parameters',\n  'relationships',\n  'tennessee',\n  'representative',\n  'frequency',\n  'introduced',\n  'departments',\n  'residents',\n  'displayed',\n  'performed',\n  'administrator',\n  'addresses',\n  'permanent',\n  'agriculture',\n  'constitutes',\n  'portfolio',\n  'practical',\n  'delivered',\n  'collectibles',\n  'infrastructure',\n  'exclusive',\n  'originally',\n  'utilities',\n  'philosophy',\n  'regulation',\n  'reduction',\n  'nutrition',\n  'recording',\n  'secondary',\n  'wonderful',\n  'announced',\n  'prevention',\n  'mentioned',\n  'automatic',\n  'healthcare',\n  'maintained',\n  'increasing',\n  'connected',\n  'directors',\n  'participation',\n  'containing',\n  'combination',\n  'amendment',\n  'guaranteed',\n  'libraries',\n  'distributed',\n  'singapore',\n  'enterprises',\n  'convention',\n  'principal',\n  'certification',\n  'previously',\n  'buildings',\n  'household',\n  'batteries',\n  'positions',\n  'subscription',\n  'contemporary',\n  'panasonic',\n  'permalink',\n  'signature',\n  'provision',\n  'certainly',\n  'newspaper',\n  'liability',\n  'trademark',\n  'trackback',\n  'americans',\n  'promotion',\n  'conversion',\n  'reasonable',\n  'broadband',\n  'influence',\n  'importance',\n  'webmaster',\n  'prescription',\n  'specifically',\n  'represent',\n  'conservation',\n  'louisiana',\n  'javascript',\n  'marketplace',\n  'evolution',\n  'certificates',\n  'objectives',\n  'suggested',\n  'concerned',\n  'structures',\n  'encyclopedia',\n  'continuing',\n  'interracial',\n  'competitive',\n  'suppliers',\n  'preparation',\n  'receiving',\n  'accordance',\n  'discussed',\n  'elizabeth',\n  'reservations',\n  'playstation',\n  'instruction',\n  'annotation',\n  'differences',\n  'establish',\n  'expressed',\n  'paragraph',\n  'mathematics',\n  'compensation',\n  'conducted',\n  'percentage',\n  'mississippi',\n  'requested',\n  'connecticut',\n  'personals',\n  'immediate',\n  'agricultural',\n  'supporting',\n  'collections',\n  'participate',\n  'specialist',\n  'experienced',\n  'investigation',\n  'institution',\n  'searching',\n  'proceedings',\n  'transmission',\n  'characteristics',\n  'experiences',\n  'extremely',\n  'verzeichnis',\n  'contracts',\n  'concerning',\n  'developers',\n  'equivalent',\n  'chemistry',\n  'neighborhood',\n  'variables',\n  'continues',\n  'curriculum',\n  'psychology',\n  'responses',\n  'circumstances',\n  'identification',\n  'appliances',\n  'elementary',\n  'unlimited',\n  'printable',\n  'enforcement',\n  'hardcover',\n  'celebrity',\n  'chocolate',\n  'hampshire',\n  'bluetooth',\n  'controlled',\n  'requirement',\n  'authorities',\n  'representatives',\n  'pregnancy',\n  'biography',\n  'attractions',\n  'transactions',\n  'authorized',\n  'retirement',\n  'financing',\n  'efficiency',\n  'efficient',\n  'commitment',\n  'specialty',\n  'interviews',\n  'qualified',\n  'discovery',\n  'classified',\n  'confidence',\n  'lifestyle',\n  'consistent',\n  'clearance',\n  'connections',\n  'inventory',\n  'converter',\n  'organisation',\n  'objective',\n  'indicated',\n  'securities',\n  'volunteer',\n  'democratic',\n  'switzerland',\n  'parameter',\n  'processor',\n  'dimensions',\n  'contribute',\n  'challenges',\n  'recognition',\n  'submission',\n  'encourage',\n  'regulatory',\n  'inspection',\n  'consumers',\n  'territory',\n  'transaction',\n  'manchester',\n  'contributions',\n  'continuous',\n  'resulting',\n  'cambridge',\n  'initiative',\n  'execution',\n  'disability',\n  'increases',\n  'contractor',\n  'examination',\n  'indicates',\n  'committed',\n  'extensive',\n  'affordable',\n  'candidate',\n  'databases',\n  'outstanding',\n  'perspective',\n  'messenger',\n  'tournament',\n  'consideration',\n  'discounts',\n  'catalogue',\n  'publishers',\n  'caribbean',\n  'reservation',\n  'remaining',\n  'depending',\n  'expansion',\n  'purchased',\n  'performing',\n  'collected',\n  'absolutely',\n  'featuring',\n  'implement',\n  'scheduled',\n  'calculator',\n  'significantly',\n  'temporary',\n  'sufficient',\n  'awareness',\n  'vancouver',\n  'contribution',\n  'measurement',\n  'constitution',\n  'packaging',\n  'consultation',\n  'northwest',\n  'classroom',\n  'democracy',\n  'wallpaper',\n  'merchandise',\n  'resistance',\n  'baltimore',\n  'candidates',\n  'charlotte',\n  'biological',\n  'transition',\n  'preferences',\n  'instrument',\n  'classification',\n  'physician',\n  'hollywood',\n  'wikipedia',\n  'spiritual',\n  'photographs',\n  'relatively',\n  'satisfaction',\n  'represents',\n  'pittsburgh',\n  'preferred',\n  'intellectual',\n  'comfortable',\n  'interaction',\n  'listening',\n  'effectively',\n  'experimental',\n  'revolution',\n  'consolidation',\n  'landscape',\n  'dependent',\n  'mechanical',\n  'consultants',\n  'applicant',\n  'cooperation',\n  'acquisition',\n  'implemented',\n  'directories',\n  'recognized',\n  'notification',\n  'licensing',\n  'textbooks',\n  'diversity',\n  'cleveland',\n  'investments',\n  'accessibility',\n  'sensitive',\n  'templates',\n  'completion',\n  'universities',\n  'technique',\n  'contractors',\n  'subscriptions',\n  'calculate',\n  'alexander',\n  'broadcast',\n  'converted',\n  'anniversary',\n  'improvements',\n  'specification',\n  'accessible',\n  'accessory',\n  'typically',\n  'representation',\n  'arrangements',\n  'conferences',\n  'uniprotkb',\n  'consumption',\n  'birmingham',\n  'afternoon',\n  'consultant',\n  'controller',\n  'ownership',\n  'committees',\n  'legislative',\n  'researchers',\n  'unsubscribe',\n  'molecular',\n  'residence',\n  'attorneys',\n  'operators',\n  'sustainable',\n  'philippines',\n  'statistical',\n  'innovation',\n  'employers',\n  'definitions',\n  'elections',\n  'stainless',\n  'newspapers',\n  'hospitals',\n  'exception',\n  'successfully',\n  'indonesia',\n  'primarily',\n  'capabilities',\n  'recommendation',\n  'recruitment',\n  'organized',\n  'improving',\n  'expensive',\n  'organisations',\n  'explained',\n  'programmes',\n  'expertise',\n  'mechanism',\n  'jewellery',\n  'eventually',\n  'agreements',\n  'considering',\n  'innovative',\n  'conclusion',\n  'disorders',\n  'collaboration',\n  'detection',\n  'formation',\n  'engineers',\n  'proposals',\n  'moderator',\n  'tutorials',\n  'settlement',\n  'collectables',\n  'fantastic',\n  'governments',\n  'purchasing',\n  'appointed',\n  'operational',\n  'corresponding',\n  'descriptions',\n  'determination',\n  'animation',\n  'productions',\n  'telecommunications',\n  'instructor',\n  'approaches',\n  'highlights',\n  'designers',\n  'melbourne',\n  'scientists',\n  'blackjack',\n  'argentina',\n  'possibility',\n  'commissioner',\n  'dangerous',\n  'reliability',\n  'unfortunately',\n  'respectively',\n  'volunteers',\n  'attachment',\n  'appointment',\n  'workshops',\n  'hurricane',\n  'represented',\n  'mortgages',\n  'responsibilities',\n  'carefully',\n  'productivity',\n  'investors',\n  'underground',\n  'diagnosis',\n  'principle',\n  'vacations',\n  'calculated',\n  'appearance',\n  'incorporated',\n  'notebooks',\n  'algorithm',\n  'valentine',\n  'involving',\n  'investing',\n  'christopher',\n  'admission',\n  'terrorism',\n  'parliament',\n  'situations',\n  'allocated',\n  'corrections',\n  'structural',\n  'municipal',\n  'describes',\n  'disabilities',\n  'substance',\n  'prohibited',\n  'addressed',\n  'simulation',\n  'initiatives',\n  'concentration',\n  'interpretation',\n  'bankruptcy',\n  'optimization',\n  'substances',\n  'discovered',\n  'restrictions',\n  'participating',\n  'exhibition',\n  'composition',\n  'nationwide',\n  'definitely',\n  'existence',\n  'commentary',\n  'limousines',\n  'developments',\n  'immigration',\n  'destinations',\n  'necessarily',\n  'attribute',\n  'apparently',\n  'surrounding',\n  'mountains',\n  'popularity',\n  'postposted',\n  'coordinator',\n  'obviously',\n  'fundamental',\n  'substantial',\n  'progressive',\n  'championship',\n  'sacramento',\n  'impossible',\n  'depression',\n  'testimonials',\n  'memorabilia',\n  'cartridge',\n  'explanation',\n  'cincinnati',\n  'subsection',\n  'electricity',\n  'permitted',\n  'workplace',\n  'confirmed',\n  'wallpapers',\n  'infection',\n  'eligibility',\n  'involvement',\n  'placement',\n  'observations',\n  'vbulletin',\n  'subsequent',\n  'motorcycle',\n  'disclosure',\n  'establishment',\n  'presentations',\n  'undergraduate',\n  'occupation',\n  'donations',\n  'associations',\n  'citysearch',\n  'radiation',\n  'seriously',\n  'elsewhere',\n  'pollution',\n  'conservative',\n  'guestbook',\n  'effectiveness',\n  'demonstrate',\n  'atmosphere',\n  'experiment',\n  'purchases',\n  'federation',\n  'assignment',\n  'chemicals',\n  'everybody',\n  'nashville',\n  'counseling',\n  'acceptable',\n  'satisfied',\n  'measurements',\n  'milwaukee',\n  'medication',\n  'warehouse',\n  'shareware',\n  'violation',\n  'configure',\n  'stability',\n  'southwest',\n  'institutional',\n  'expectations',\n  'independence',\n  'metabolism',\n  'personally',\n  'excellence',\n  'somewhere',\n  'attributes',\n  'recognize',\n  'screening',\n  'thumbnail',\n  'forgotten',\n  'intelligent',\n  'edinburgh',\n  'obligation',\n  'regardless',\n  'restricted',\n  'republican',\n  'merchants',\n  'attendance',\n  'arguments',\n  'amsterdam',\n  'adventures',\n  'announcement',\n  'appreciate',\n  'regularly',\n  'mechanisms',\n  'customize',\n  'tradition',\n  'indicators',\n  'emissions',\n  'physicians',\n  'complaint',\n  'experiments',\n  'afghanistan',\n  'scholarship',\n  'governance',\n  'supplements',\n  'camcorder',\n  'implementing',\n  'ourselves',\n  'conversation',\n  'capability',\n  'producing',\n  'precision',\n  'contributed',\n  'reproduction',\n  'ingredients',\n  'franchise',\n  'complaints',\n  'promotions',\n  'rehabilitation',\n  'maintaining',\n  'environments',\n  'reception',\n  'correctly',\n  'consequences',\n  'geography',\n  'appearing',\n  'integrity',\n  'discrimination',\n  'processed',\n  'implications',\n  'functionality',\n  'intermediate',\n  'emotional',\n  'platforms',\n  'overnight',\n  'geographic',\n  'preliminary',\n  'districts',\n  'introduce',\n  'promotional',\n  'chevrolet',\n  'specialists',\n  'generator',\n  'suspension',\n  'correction',\n  'authentication',\n  'communicate',\n  'supplement',\n  'showtimes',\n  'promoting',\n  'machinery',\n  'bandwidth',\n  'probability',\n  'dimension',\n  'schedules',\n  'admissions',\n  'quarterly',\n  'illustrated',\n  'continental',\n  'alternate',\n  'achievement',\n  'limitations',\n  'automated',\n  'passenger',\n  'convenient',\n  'orientation',\n  'childhood',\n  'flexibility',\n  'jurisdiction',\n  'displaying',\n  'encouraged',\n  'cartridges',\n  'declaration',\n  'automation',\n  'advantages',\n  'preparing',\n  'recipient',\n  'extensions',\n  'athletics',\n  'southeast',\n  'alternatives',\n  'determining',\n  'personalized',\n  'conditioning',\n  'partnerships',\n  'destruction',\n  'increasingly',\n  'migration',\n  'basically',\n  'conventional',\n  'applicants',\n  'occupational',\n  'adjustment',\n  'treatments',\n  'camcorders',\n  'difficulty',\n  'collective',\n  'coalition',\n  'enrollment',\n  'producers',\n  'collector',\n  'interfaces',\n  'advertisers',\n  'representing',\n  'observation',\n  'restoration',\n  'convenience',\n  'returning',\n  'opposition',\n  'container',\n  'defendant',\n  'confirmation',\n  'supervisor',\n  'peripherals',\n  'bestsellers',\n  'departure',\n  'minneapolis',\n  'interactions',\n  'intervention',\n  'attraction',\n  'modification',\n  'customized',\n  'understood',\n  'assurance',\n  'happening',\n  'amendments',\n  'metropolitan',\n  'compilation',\n  'verification',\n  'attractive',\n  'recordings',\n  'jefferson',\n  'gardening',\n  'obligations',\n  'orchestra',\n  'polyphonic',\n  'outsourcing',\n  'adjustable',\n  'allocation',\n  'discipline',\n  'demonstrated',\n  'identifying',\n  'alphabetical',\n  'dispatched',\n  'installing',\n  'voluntary',\n  'photographer',\n  'messaging',\n  'constructed',\n  'additions',\n  'requiring',\n  'engagement',\n  'refinance',\n  'calendars',\n  'arrangement',\n  'conclusions',\n  'bibliography',\n  'compatibility',\n  'furthermore',\n  'cooperative',\n  'measuring',\n  'jacksonville',\n  'headquarters',\n  'transfers',\n  'transformation',\n  'attachments',\n  'administrators',\n  'personality',\n  'facilitate',\n  'subscriber',\n  'priorities',\n  'bookstore',\n  'parenting',\n  'incredible',\n  'commonwealth',\n  'pharmaceutical',\n  'manhattan',\n  'workforce',\n  'organizational',\n  'portuguese',\n  'everywhere',\n  'discharge',\n  'halloween',\n  'hazardous',\n  'methodology',\n  'housewares',\n  'reputation',\n  'resistant',\n  'democrats',\n  'recycling',\n  'qualifications',\n  'slideshow',\n  'variation',\n  'transferred',\n  'photograph',\n  'distributor',\n  'underlying',\n  'wrestling',\n  'photoshop',\n  'gathering',\n  'projection',\n  'mathematical',\n  'specialized',\n  'diagnostic',\n  'indianapolis',\n  'corporations',\n  'criticism',\n  'automobile',\n  'confidential',\n  'statutory',\n  'accommodations',\n  'northeast',\n  'downloaded',\n  'paintings',\n  'injection',\n  'yorkshire',\n  'populations',\n  'protective',\n  'initially',\n  'indicator',\n  'eliminate',\n  'sunglasses',\n  'preference',\n  'threshold',\n  'venezuela',\n  'exploration',\n  'sequences',\n  'astronomy',\n  'translate',\n  'announces',\n  'compression',\n  'establishing',\n  'constitutional',\n  'perfectly',\n  'instantly',\n  'litigation',\n  'submissions',\n  'broadcasting',\n  'horizontal',\n  'terrorist',\n  'informational',\n  'ecommerce',\n  'suffering',\n  'prospective',\n  'ultimately',\n  'artificial',\n  'spectacular',\n  'coordination',\n  'connector',\n  'affiliated',\n  'activation',\n  'naturally',\n  'subscribers',\n  'mitsubishi',\n  'underwear',\n  'potentially',\n  'constraints',\n  'inclusive',\n  'dimensional',\n  'considerable',\n  'selecting',\n  'processors',\n  'pantyhose',\n  'difficulties',\n  'complexity',\n  'constantly',\n  'barcelona',\n  'presidential',\n  'documentary',\n  'territories',\n  'palestinian',\n  'legislature',\n  'hospitality',\n  'procurement',\n  'theoretical',\n  'exercises',\n  'surveillance',\n  'protocols',\n  'highlight',\n  'substitute',\n  'inclusion',\n  'hopefully',\n  'brilliant',\n  'evaluated',\n  'assignments',\n  'termination',\n  'households',\n  'authentic',\n  'montgomery',\n  'architectural',\n  'louisville',\n  'macintosh',\n  'movements',\n  'amenities',\n  'virtually',\n  'authorization',\n  'projector',\n  'comparative',\n  'psychological',\n  'surprised',\n  'genealogy',\n  'expenditure',\n  'liverpool',\n  'connectivity',\n  'algorithms',\n  'similarly',\n  'collaborative',\n  'excluding',\n  'commander',\n  'suggestion',\n  'spotlight',\n  'investigate',\n  'connecting',\n  'logistics',\n  'proportion',\n  'significance',\n  'symposium',\n  'essentials',\n  'protecting',\n  'transmitted',\n  'screenshots',\n  'intensive',\n  'switching',\n  'correspondence',\n  'supervision',\n  'expenditures',\n  'separation',\n  'testimony',\n  'celebrities',\n  'mandatory',\n  'boundaries',\n  'syndication',\n  'celebration',\n  'filtering',\n  'luxembourg',\n  'offensive',\n  'deployment',\n  'colleagues',\n  'separated',\n  'directive',\n  'governing',\n  'retailers',\n  'occasionally',\n  'attending',\n  'recruiting',\n  'instructional',\n  'traveling',\n  'permissions',\n  'biotechnology',\n  'prescribed',\n  'catherine',\n  'reproduced',\n  'calculation',\n  'consolidated',\n  'occasions',\n  'equations',\n  'exceptional',\n  'respondents',\n  'considerations',\n  'queensland',\n  'musicians',\n  'composite',\n  'unavailable',\n  'essentially',\n  'designing',\n  'assessments',\n  'brunswick',\n  'sensitivity',\n  'preservation',\n  'streaming',\n  'intensity',\n  'technological',\n  'syndicate',\n  'antivirus',\n  'addressing',\n  'discounted',\n  'bangladesh',\n  'constitute',\n  'concluded',\n  'desperate',\n  'demonstration',\n  'governmental',\n  'manufactured',\n  'graduation',\n  'variations',\n  'addiction',\n  'springfield',\n  'synthesis',\n  'undefined',\n  'unemployment',\n  'enhancement',\n  'newcastle',\n  'performances',\n  'societies',\n  'brazilian',\n  'identical',\n  'petroleum',\n  'norwegian',\n  'retention',\n  'exchanges',\n  'soundtrack',\n  'wondering',\n  'profession',\n  'separately',\n  'physiology',\n  'collecting',\n  'participant',\n  'scholarships',\n  'recreational',\n  'dominican',\n  'friendship',\n  'expanding',\n  'provincial',\n  'investigations',\n  'medications',\n  'rochester',\n  'advertiser',\n  'encryption',\n  'downloadable',\n  'sophisticated',\n  'possession',\n  'laboratories',\n  'vegetables',\n  'thumbnails',\n  'stockings',\n  'respondent',\n  'destroyed',\n  'manufacture',\n  'wordpress',\n  'vulnerability',\n  'accountability',\n  'celebrate',\n  'accredited',\n  'appliance',\n  'compressed',\n  'scheduling',\n  'perspectives',\n  'mortality',\n  'christians',\n  'therapeutic',\n  'impressive',\n  'accordingly',\n  'architect',\n  'challenging',\n  'microwave',\n  'accidents',\n  'relocation',\n  'contributors',\n  'violations',\n  'temperatures',\n  'competitions',\n  'discretion',\n  'cosmetics',\n  'repository',\n  'concentrations',\n  'christianity',\n  'negotiations',\n  'realistic',\n  'generating',\n  'christina',\n  'congressional',\n  'photographic',\n  'modifications',\n  'millennium',\n  'achieving',\n  'fisheries',\n  'exceptions',\n  'reactions',\n  'macromedia',\n  'companion',\n  'divisions',\n  'additionally',\n  'fellowship',\n  'victorian',\n  'copyrights',\n  'lithuania',\n  'mastercard',\n  'chronicles',\n  'obtaining',\n  'distribute',\n  'decorative',\n  'enlargement',\n  'campaigns',\n  'conjunction',\n  'instances',\n  'indigenous',\n  'validation',\n  'corruption',\n  'incentives',\n  'cholesterol',\n  'differential',\n  'scientist',\n  'starsmerchant',\n  'arthritis',\n  'nevertheless',\n  'practitioners',\n  'transcript',\n  'inflation',\n  'compounds',\n  'contracting',\n  'structured',\n  'reasonably',\n  'graduates',\n  'recommends',\n  'controlling',\n  'distributors',\n  'arlington',\n  'particles',\n  'extraordinary',\n  'indicating',\n  'coordinate',\n  'exclusively',\n  'limitation',\n  'widescreen',\n  'illustration',\n  'construct',\n  'inquiries',\n  'inspiration',\n  'affecting',\n  'downloading',\n  'aggregate',\n  'forecasts',\n  'complicated',\n  'shopzilla',\n  'decorating',\n  'expressions',\n  'shakespeare',\n  'connectors',\n  'conflicts',\n  'travelers',\n  'offerings',\n  'incorrect',\n  'furnishings',\n  'guatemala',\n  'perception',\n  'renaissance',\n  'pathology',\n  'ordinance',\n  'photographers',\n  'infections',\n  'configured',\n  'festivals',\n  'possibilities',\n  'contributing',\n  'analytical',\n  'circulation',\n  'assumption',\n  'jerusalem',\n  'transexuales',\n  'invention',\n  'technician',\n  'executives',\n  'enquiries',\n  'cognitive',\n  'exploring',\n  'registrar',\n  'supporters',\n  'withdrawal',\n  'predicted',\n  'saskatchewan',\n  'cancellation',\n  'ministers',\n  'veterinary',\n  'prostores',\n  'relevance',\n  'incentive',\n  'butterfly',\n  'mechanics',\n  'numerical',\n  'reflection',\n  'accompanied',\n  'invitation',\n  'princeton',\n  'spirituality',\n  'meanwhile',\n  'proprietary',\n  'childrens',\n  'thumbzilla',\n  'porcelain',\n  'pichunter',\n  'translated',\n  'columnists',\n  'consensus',\n  'delivering',\n  'journalism',\n  'intention',\n  'undertaken',\n  'statewide',\n  'semiconductor',\n  'illustrations',\n  'happiness',\n  'substantially',\n  'identifier',\n  'calculations',\n  'conducting',\n  'accomplished',\n  'calculators',\n  'impression',\n  'correlation',\n  'fragrance',\n  'neighbors',\n  'transparent',\n  'charleston',\n  'champions',\n  'selections',\n  'projectors',\n  'inappropriate',\n  'comparing',\n  'vocational',\n  'pharmacies',\n  'introducing',\n  'appreciated',\n  'albuquerque',\n  'distinguished',\n  'projected',\n  'assumptions',\n  'shareholders',\n  'developmental',\n  'regulated',\n  'anticipated',\n  'completing',\n  'comparable',\n  'confusion',\n  'copyrighted',\n  'warranties',\n  'documented',\n  'paperbacks',\n  'keyboards',\n  'vulnerable',\n  'reflected',\n  'respiratory',\n  'notifications',\n  'transexual',\n  'mainstream',\n  'evaluating',\n  'subcommittee',\n  'maternity',\n  'journalists',\n  'foundations',\n  'volleyball',\n  'liabilities',\n  'decreased',\n  'tolerance',\n  'creativity',\n  'describing',\n  'lightning',\n  'quotations',\n  'inspector',\n  'bookmarks',\n  'behavioral',\n  'riverside',\n  'bathrooms',\n  'abilities',\n  'initiated',\n  'nonprofit',\n  'lancaster',\n  'suspended',\n  'containers',\n  'attitudes',\n  'simultaneously',\n  'integrate',\n  'sociology',\n  'screenshot',\n  'exhibitions',\n  'confident',\n  'retrieved',\n  'officially',\n  'consortium',\n  'recipients',\n  'delicious',\n  'traditions',\n  'periodically',\n  'hungarian',\n  'referring',\n  'transform',\n  'educators',\n  'vegetable',\n  'humanities',\n  'independently',\n  'alignment',\n  'henderson',\n  'britannica',\n  'competitors',\n  'visibility',\n  'consciousness',\n  'encounter',\n  'resolutions',\n  'accessing',\n  'attempted',\n  'witnesses',\n  'administered',\n  'strengthen',\n  'frederick',\n  'aggressive',\n  'advertisements',\n  'sublimedirectory',\n  'disturbed',\n  'determines',\n  'sculpture',\n  'motivation',\n  'pharmacology',\n  'passengers',\n  'quantities',\n  'petersburg',\n  'consistently',\n  'powerpoint',\n  'obituaries',\n  'punishment',\n  'appreciation',\n  'subsequently',\n  'providence',\n  'restriction',\n  'incorporate',\n  'backgrounds',\n  'treasurer',\n  'lightweight',\n  'transcription',\n  'complications',\n  'scripting',\n  'remembered',\n  'synthetic',\n  'testament',\n  'specifics',\n  'partially',\n  'wilderness',\n  'generations',\n  'tournaments',\n  'sponsorship',\n  'headphones',\n  'proceeding',\n  'volkswagen',\n  'uncertainty',\n  'breakdown',\n  'reconstruction',\n  'subsidiary',\n  'strengths',\n  'encouraging',\n  'furnished',\n  'terrorists',\n  'comparisons',\n  'beneficial',\n  'distributions',\n  'viewpicture',\n  'threatened',\n  'republicans',\n  'discusses',\n  'responded',\n  'abstracts',\n  'prediction',\n  'pharmaceuticals',\n  'thesaurus',\n  'individually',\n  'battlefield',\n  'literally',\n  'ecological',\n  'appraisal',\n  'consisting',\n  'submitting',\n  'citations',\n  'geographical',\n  'mozambique',\n  'disclaimers',\n  'championships',\n  'sheffield',\n  'finishing',\n  'wellington',\n  'prospects',\n  'bulgarian',\n  'aboriginal',\n  'remarkable',\n  'preventing',\n  'productive',\n  'boulevard',\n  'compliant',\n  'penalties',\n  'imagination',\n  'refurbished',\n  'activated',\n  'conferencing',\n  'armstrong',\n  'politicians',\n  'trackbacks',\n  'accommodate',\n  'christine',\n  'accepting',\n  'precipitation',\n  'isolation',\n  'sustained',\n  'approximate',\n  'programmer',\n  'greetings',\n  'inherited',\n  'incomplete',\n  'chronicle',\n  'legitimate',\n  'biographies',\n  'investigator',\n  'plaintiff',\n  'prisoners',\n  'mediterranean',\n  'nightlife',\n  'architects',\n  'entrepreneur',\n  'freelance',\n  'excessive',\n  'screensaver',\n  'valuation',\n  'unexpected',\n  'cigarette',\n  'characteristic',\n  'metallica',\n  'consequently',\n  'appointments',\n  'narrative',\n  'academics',\n  'quantitative',\n  'screensavers',\n  'subdivision',\n  'distinction',\n  'livestock',\n  'exemption',\n  'sustainability',\n  'formatting',\n  'nutritional',\n  'nicaragua',\n  'affiliation',\n  'relatives',\n  'satisfactory',\n  'revolutionary',\n  'bracelets',\n  'telephony',\n  'breathing',\n  'thickness',\n  'adjustments',\n  'graphical',\n  'discussing',\n  'aerospace',\n  'meaningful',\n  'maintains',\n  'shortcuts',\n  'voyeurweb',\n  'extending',\n  'specifies',\n  'accreditation',\n  'blackberry',\n  'meditation',\n  'microphone',\n  'macedonia',\n  'combining',\n  'instrumental',\n  'organizing',\n  'moderators',\n  'kazakhstan',\n  'standings',\n  'partition',\n  'invisible',\n  'translations',\n  'commodity',\n  'kilometers',\n  'thanksgiving',\n  'guarantees',\n  'indication',\n  'congratulations',\n  'cigarettes',\n  'controllers',\n  'consultancy',\n  'conventions',\n  'coordinates',\n  'responding',\n  'physically',\n  'stakeholders',\n  'hydrocodone',\n  'consecutive',\n  'attempting',\n  'representations',\n  'competing',\n  'peninsula',\n  'accurately',\n  'considers',\n  'ministries',\n  'vacancies',\n  'parliamentary',\n  'acknowledge',\n  'thoroughly',\n  'nottingham',\n  'identifies',\n  'questionnaire',\n  'qualification',\n  'modelling',\n  'miniature',\n  'interstate',\n  'consequence',\n  'systematic',\n  'perceived',\n  'madagascar',\n  'presenting',\n  'troubleshooting',\n  'uzbekistan',\n  'centuries',\n  'magnitude',\n  'richardson',\n  'fragrances',\n  'vocabulary',\n  'earthquake',\n  'fundraising',\n  'geological',\n  'assessing',\n  'introduces',\n  'webmasters',\n  'computational',\n  'acdbentity',\n  'participated',\n  'handhelds',\n  'answering',\n  'impressed',\n  'conspiracy',\n  'organizer',\n  'combinations',\n  'preceding',\n  'cumulative',\n  'amplifier',\n  'arbitrary',\n  'prominent',\n  'lexington',\n  'contacted',\n  'recorders',\n  'occasional',\n  'innovations',\n  'postcards',\n  'reviewing',\n  'explicitly',\n  'transsexual',\n  'citizenship',\n  'informative',\n  'girlfriend',\n  'bloomberg',\n  'hierarchy',\n  'influenced',\n  'abandoned',\n  'complement',\n  'mauritius',\n  'checklist',\n  'requesting',\n  'lauderdale',\n  'scenarios',\n  'extraction',\n  'elevation',\n  'utilization',\n  'beverages',\n  'calibration',\n  'efficiently',\n  'entertaining',\n  'prerequisite',\n  'hypothesis',\n  'medicines',\n  'regression',\n  'enhancements',\n  'renewable',\n  'intersection',\n  'passwords',\n  'consistency',\n  'collectors',\n  'azerbaijan',\n  'astrology',\n  'occurring',\n  'supplemental',\n  'travelling',\n  'induction',\n  'precisely',\n  'spreading',\n  'provinces',\n  'widespread',\n  'incidence',\n  'incidents',\n  'enhancing',\n  'interference',\n  'palestine',\n  'listprice',\n  'atmospheric',\n  'knowledgestorm',\n  'referenced',\n  'publicity',\n  'proposition',\n  'allowance',\n  'designation',\n  'duplicate',\n  'criterion',\n  'civilization',\n  'vietnamese',\n  'tremendous',\n  'corrected',\n  'encountered',\n  'internationally',\n  'surrounded',\n  'creatures',\n  'commented',\n  'accomplish',\n  'vegetarian',\n  'newfoundland',\n  'investigated',\n  'ambassador',\n  'stephanie',\n  'contacting',\n  'vegetation',\n  'findarticles',\n  'specially',\n  'infectious',\n  'continuity',\n  'phenomenon',\n  'conscious',\n  'referrals',\n  'differently',\n  'integrating',\n  'revisions',\n  'reasoning',\n  'charitable',\n  'annotated',\n  'convinced',\n  'burlington',\n  'replacing',\n  'researcher',\n  'watershed',\n  'occupations',\n  'acknowledged',\n  'equilibrium',\n  'characterized',\n  'privilege',\n  'qualifying',\n  'estimation',\n  'pediatric',\n  'techrepublic',\n  'institutes',\n  'brochures',\n  'traveller',\n  'appropriations',\n  'suspected',\n  'benchmark',\n  'beginners',\n  'instructors',\n  'highlighted',\n  'stationery',\n  'unauthorized',\n  'competent',\n  'contributor',\n  'demonstrates',\n  'gradually',\n  'desirable',\n  'journalist',\n  'afterwards',\n  'religions',\n  'explosion',\n  'signatures',\n  'disciplines',\n  'daughters',\n  'conversations',\n  'simplified',\n  'motherboard',\n  'bibliographic',\n  'champagne',\n  'deviation',\n  'superintendent',\n  'housewives',\n  'influences',\n  'inspections',\n  'irrigation',\n  'hydraulic',\n  'robertson',\n  'penetration',\n  'conviction',\n  'omissions',\n  'retrieval',\n  'qualities',\n  'prototype',\n  'importantly',\n  'apparatus',\n  'explaining',\n  'nomination',\n  'empirical',\n  'dependence',\n  'sexuality',\n  'polyester',\n  'commitments',\n  'suggesting',\n  'remainder',\n  'privileges',\n  'televisions',\n  'specializing',\n  'commodities',\n  'motorcycles',\n  'concentrate',\n  'reproductive',\n  'molecules',\n  'refrigerator',\n  'intervals',\n  'sentences',\n  'exclusion',\n  'workstation',\n  'holocaust',\n  'receivers',\n  'disposition',\n  'navigator',\n  'investigators',\n  'marijuana',\n  'cathedral',\n  'fairfield',\n  'fascinating',\n  'landscapes',\n  'lafayette',\n  'computation',\n  'cardiovascular',\n  'salvation',\n  'predictions',\n  'accompanying',\n  'selective',\n  'arbitration',\n  'configuring',\n  'editorials',\n  'sacrifice',\n  'removable',\n  'convergence',\n  'gibraltar',\n  'anthropology',\n  'malpractice',\n  'reporters',\n  'necessity',\n  'rendering',\n  'hepatitis',\n  'nationally',\n  'waterproof',\n  'specialties',\n  'humanitarian',\n  'invitations',\n  'functioning',\n  'economies',\n  'alexandria',\n  'bacterial',\n  'undertake',\n  'continuously',\n  'achievements',\n  'convertible',\n  'secretariat',\n  'paragraphs',\n  'adolescent',\n  'nominations',\n  'cancelled',\n  'introductory',\n  'reservoir',\n  'occurrence',\n  'worcester',\n  'demographic',\n  'disciplinary',\n  'respected',\n  'portraits',\n  'interpreted',\n  'evaluations',\n  'elimination',\n  'hypothetical',\n  'immigrants',\n  'complimentary',\n  'helicopter',\n  'performer',\n  'commissions',\n  'powerseller',\n  'graduated',\n  'surprising',\n  'unnecessary',\n  'dramatically',\n  'yugoslavia',\n  'characterization',\n  'likelihood',\n  'fundamentals',\n  'contamination',\n  'endangered',\n  'compromise',\n  'expiration',\n  'namespace',\n  'peripheral',\n  'negotiation',\n  'opponents',\n  'nominated',\n  'confidentiality',\n  'electoral',\n  'changelog',\n  'alternatively',\n  'greensboro',\n  'controversial',\n  'recovered',\n  'upgrading',\n  'frontpage',\n  'demanding',\n  'defensive',\n  'forbidden',\n  'programmers',\n  'monitored',\n  'installations',\n  'deutschland',\n  'practitioner',\n  'motivated',\n  'smithsonian',\n  'examining',\n  'revelation',\n  'delegation',\n  'dictionaries',\n  'greenhouse',\n  'transparency',\n  'currencies',\n  'survivors',\n  'positioning',\n  'descending',\n  'temporarily',\n  'frequencies',\n  'reflections',\n  'municipality',\n  'detective',\n  'experiencing',\n  'fireplace',\n  'endorsement',\n  'psychiatry',\n  'persistent',\n  'summaries',\n  'looksmart',\n  'magnificent',\n  'colleague',\n  'adaptation',\n  'paintball',\n  'enclosure',\n  'supervisors',\n  'westminster',\n  'distances',\n  'absorption',\n  'treasures',\n  'transcripts',\n  'disappointed',\n  'continually',\n  'communist',\n  'collectible',\n  'entrepreneurs',\n  'creations',\n  'acquisitions',\n  'biodiversity',\n  'excitement',\n  'presently',\n  'mysterious',\n  'librarian',\n  'subsidiaries',\n  'stockholm',\n  'indonesian',\n  'therapist',\n  'promising',\n  'relaxation',\n  'thereafter',\n  'commissioners',\n  'forwarding',\n  'nightmare',\n  'reductions',\n  'southampton',\n  'organisms',\n  'telescope',\n  'portsmouth',\n  'advancement',\n  'harassment',\n  'generators',\n  'generates',\n  'replication',\n  'inexpensive',\n  'receptors',\n  'interventions',\n  'huntington',\n  'internship',\n  'aluminium',\n  'snowboard',\n  'beastality',\n  'evanescence',\n  'coordinated',\n  'shipments',\n  'antarctica',\n  'chancellor',\n  'controversy',\n  'legendary',\n  'beautifully',\n  'antibodies',\n  'examinations',\n  'immunology',\n  'departmental',\n  'terminology',\n  'gentleman',\n  'reproduce',\n  'convicted',\n  'roommates',\n  'threatening',\n  'spokesman',\n  'activists',\n  'frankfurt',\n  'encourages',\n  'assembled',\n  'restructuring',\n  'terminals',\n  'simulations',\n  'sufficiently',\n  'conditional',\n  'crossword',\n  'conceptual',\n  'liechtenstein',\n  'translator',\n  'automobiles',\n  'continent',\n  'longitude',\n  'challenged',\n  'telecharger',\n  'insertion',\n  'instrumentation',\n  'constraint',\n  'groundwater',\n  'strengthening',\n  'insulation',\n  'infringement',\n  'subjective',\n  'swaziland',\n  'varieties',\n  'mediawiki',\n  'configurations',\n];\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {AutoLinkPlugin} from '@lexical/react/LexicalAutoLinkPlugin';\nimport * as React from 'react';\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nconst EMAIL_MATCHER =\n  /(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/;\n\nconst MATCHERS = [\n  (text: string) => {\n    const match = URL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: match[0],\n      }\n    );\n  },\n  (text: string) => {\n    const match = EMAIL_MATCHER.exec(text);\n    return (\n      match && {\n        index: match.index,\n        length: match[0].length,\n        text: match[0],\n        url: `mailto:${match[0]}`,\n      }\n    );\n  },\n];\n\nexport default function LexicalAutoLinkPlugin(): JSX.Element {\n  return <AutoLinkPlugin matchers={MATCHERS} />;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LinkNode} from '@lexical/link';\nimport type {LexicalEditor} from 'lexical';\n\nimport {$isLinkNode} from '@lexical/link';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  $isRangeSelection,\n} from 'lexical';\nimport {useEffect} from 'react';\n\ntype LinkFilter = (event: MouseEvent, linkNode: LinkNode) => boolean;\n\nexport default function ClickableLinkPlugin({\n  filter,\n  newTab = true,\n}: {\n  filter?: LinkFilter;\n  newTab?: boolean;\n}): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    function onClick(e: Event) {\n      const event = e as MouseEvent;\n      const linkDomNode = getLinkDomNode(event, editor);\n\n      if (linkDomNode === null) {\n        return;\n      }\n\n      const href = linkDomNode.getAttribute('href');\n\n      if (\n        linkDomNode.getAttribute('contenteditable') === 'false' ||\n        href === undefined\n      ) {\n        return;\n      }\n\n      // Allow user to select link text without follwing url\n      const selection = editor.getEditorState().read($getSelection);\n      if ($isRangeSelection(selection) && !selection.isCollapsed()) {\n        return;\n      }\n\n      let linkNode = null;\n      editor.update(() => {\n        const maybeLinkNode = $getNearestNodeFromDOMNode(linkDomNode);\n\n        if ($isLinkNode(maybeLinkNode)) {\n          linkNode = maybeLinkNode;\n        }\n      });\n\n      if (\n        linkNode === null ||\n        (filter !== undefined && !filter(event, linkNode))\n      ) {\n        return;\n      }\n\n      try {\n        if (href !== null) {\n          window.open(\n            href,\n            newTab || event.metaKey || event.ctrlKey ? '_blank' : '_self',\n          );\n        }\n      } catch {\n        // It didn't work, which is better than throwing an exception!\n      }\n    }\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement,\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('click', onClick);\n        }\n\n        if (rootElement !== null) {\n          rootElement.addEventListener('click', onClick);\n        }\n      },\n    );\n  }, [editor, filter, newTab]);\n  return null;\n}\n\nfunction isLinkDomNode(domNode: Node): boolean {\n  return domNode.nodeName.toLowerCase() === 'a';\n}\n\nfunction getLinkDomNode(\n  event: MouseEvent,\n  editor: LexicalEditor,\n): HTMLAnchorElement | null {\n  return editor.getEditorState().read(() => {\n    const domNode = event.target as Node;\n\n    if (isLinkDomNode(domNode)) {\n      return domNode as HTMLAnchorElement;\n    }\n\n    if (domNode.parentNode && isLinkDomNode(domNode.parentNode)) {\n      return domNode.parentNode as HTMLAnchorElement;\n    }\n\n    return null;\n  });\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {registerCodeHighlighting} from '@lexical/code';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {useEffect} from 'react';\n\nexport default function CodeHighlightPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return registerCodeHighlighting(editor);\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalNode,\n  NodeKey,\n  SerializedTextNode,\n  Spread,\n} from 'lexical';\n\nimport {TextNode} from 'lexical';\n\nexport type SerializedEmojiNode = Spread<\n  {\n    className: string;\n    type: 'emoji';\n  },\n  SerializedTextNode\n>;\n\nexport class EmojiNode extends TextNode {\n  __className: string;\n\n  static getType(): string {\n    return 'emoji';\n  }\n\n  static clone(node: EmojiNode): EmojiNode {\n    return new EmojiNode(node.__className, node.__text, node.__key);\n  }\n\n  constructor(className: string, text: string, key?: NodeKey) {\n    super(text, key);\n    this.__className = className;\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = document.createElement('span');\n    const inner = super.createDOM(config);\n    dom.className = this.__className;\n    inner.className = 'emoji-inner';\n    dom.appendChild(inner);\n    return dom;\n  }\n\n  updateDOM(\n    prevNode: TextNode,\n    dom: HTMLElement,\n    config: EditorConfig,\n  ): boolean {\n    const inner = dom.firstChild;\n    if (inner === null) {\n      return true;\n    }\n    super.updateDOM(prevNode, inner as HTMLElement, config);\n    return false;\n  }\n\n  static importJSON(serializedNode: SerializedEmojiNode): EmojiNode {\n    const node = $createEmojiNode(\n      serializedNode.className,\n      serializedNode.text,\n    );\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedEmojiNode {\n    return {\n      ...super.exportJSON(),\n      className: this.getClassName(),\n      type: 'emoji',\n    };\n  }\n\n  getClassName(): string {\n    const self = this.getLatest();\n    return self.__className;\n  }\n}\n\nexport function $isEmojiNode(\n  node: LexicalNode | null | undefined,\n): node is EmojiNode {\n  return node instanceof EmojiNode;\n}\n\nexport function $createEmojiNode(\n  className: string,\n  emojiText: string,\n): EmojiNode {\n  return new EmojiNode(className, emojiText).setMode('token');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalEditor} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {TextNode} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createEmojiNode, EmojiNode} from '../nodes/EmojiNode';\n\nconst emojis: Map<string, [string, string]> = new Map([\n  [':)', ['emoji happysmile', '🙂']],\n  [':D', ['emoji veryhappysmile', '😀']],\n  [':(', ['emoji unhappysmile', '🙁']],\n  ['<3', ['emoji heart', '❤']],\n  ['🙂', ['emoji happysmile', '🙂']],\n  ['😀', ['emoji veryhappysmile', '😀']],\n  ['🙁', ['emoji unhappysmile', '🙁']],\n  ['❤', ['emoji heart', '❤']],\n]);\n\nfunction findAndTransformEmoji(node: TextNode): null | TextNode {\n  const text = node.getTextContent();\n\n  for (let i = 0; i < text.length; i++) {\n    const emojiData = emojis.get(text[i]) || emojis.get(text.slice(i, i + 2));\n\n    if (emojiData !== undefined) {\n      const [emojiStyle, emojiText] = emojiData;\n      let targetNode;\n\n      if (i === 0) {\n        [targetNode] = node.splitText(i + 2);\n      } else {\n        [, targetNode] = node.splitText(i, i + 2);\n      }\n\n      const emojiNode = $createEmojiNode(emojiStyle, emojiText);\n      targetNode.replace(emojiNode);\n      return emojiNode;\n    }\n  }\n\n  return null;\n}\n\nfunction textNodeTransform(node: TextNode): void {\n  let targetNode: TextNode | null = node;\n\n  while (targetNode !== null) {\n    if (!targetNode.isSimpleText()) {\n      return;\n    }\n\n    targetNode = findAndTransformEmoji(targetNode);\n  }\n}\n\nfunction useEmojis(editor: LexicalEditor): void {\n  useEffect(() => {\n    if (!editor.hasNodes([EmojiNode])) {\n      throw new Error('EmojisPlugin: EmojiNode not registered on editor');\n    }\n\n    return editor.registerNodeTransform(TextNode, textNodeTransform);\n  }, [editor]);\n}\n\nexport default function EmojisPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  useEmojis(editor);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './EquationEditor.css';\n\nimport * as React from 'react';\nimport {ChangeEvent, RefObject} from 'react';\n\ntype BaseEquationEditorProps = {\n  equation: string;\n  inline: boolean;\n  inputRef: {current: null | HTMLInputElement | HTMLTextAreaElement};\n  setEquation: (equation: string) => void;\n};\n\nexport default function EquationEditor({\n  equation,\n  setEquation,\n  inline,\n  inputRef,\n}: BaseEquationEditorProps): JSX.Element {\n  const onChange = (event: ChangeEvent) => {\n    setEquation((event.target as HTMLInputElement).value);\n  };\n\n  const props = {\n    equation,\n    inputRef,\n    onChange,\n  };\n\n  return inline ? (\n    <InlineEquationEditor\n      {...props}\n      inputRef={inputRef as RefObject<HTMLInputElement>}\n    />\n  ) : (\n    <BlockEquationEditor\n      {...props}\n      inputRef={inputRef as RefObject<HTMLTextAreaElement>}\n    />\n  );\n}\n\ntype EquationEditorImplProps = {\n  equation: string;\n  inputRef: {current: null | HTMLInputElement};\n  onChange: (event: ChangeEvent<HTMLInputElement>) => void;\n};\n\nfunction InlineEquationEditor({\n  equation,\n  onChange,\n  inputRef,\n}: EquationEditorImplProps): JSX.Element {\n  return (\n    <span className=\"EquationEditor_inputBackground\">\n      <span className=\"EquationEditor_dollarSign\">$</span>\n      <input\n        className=\"EquationEditor_inlineEditor\"\n        value={equation}\n        onChange={onChange}\n        autoFocus={true}\n        ref={inputRef}\n      />\n      <span className=\"EquationEditor_dollarSign\">$</span>\n    </span>\n  );\n}\n\ntype BlockEquationEditorImplProps = {\n  equation: string;\n  inputRef: {current: null | HTMLTextAreaElement};\n  onChange: (event: ChangeEvent<HTMLTextAreaElement>) => void;\n};\n\nfunction BlockEquationEditor({\n  equation,\n  onChange,\n  inputRef,\n}: BlockEquationEditorImplProps): JSX.Element {\n  return (\n    <div className=\"EquationEditor_inputBackground\">\n      <span className=\"EquationEditor_dollarSign\">{'$$\\n'}</span>\n      <textarea\n        className=\"EquationEditor_blockEditor\"\n        value={equation}\n        onChange={onChange}\n        ref={inputRef}\n      />\n      <span className=\"EquationEditor_dollarSign\">{'\\n$$'}</span>\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport katex from 'katex';\nimport * as React from 'react';\nimport {useEffect, useRef} from 'react';\n\nexport default function KatexRenderer({\n  equation,\n  inline,\n  onClick,\n}: Readonly<{\n  equation: string;\n  inline: boolean;\n  onClick: () => void;\n}>): JSX.Element {\n  const katexElementRef = useRef(null);\n\n  useEffect(() => {\n    const katexElement = katexElementRef.current;\n\n    if (katexElement !== null) {\n      katex.render(equation, katexElement, {\n        displayMode: !inline, // true === block display //\n        errorColor: '#cc0000',\n        output: 'html',\n        strict: 'warn',\n        throwOnError: false,\n        trust: false,\n      });\n    }\n  }, [equation, inline]);\n\n  return (\n    // We use spacers either side to ensure Android doesn't try and compose from the\n    // inner text from Katex. There didn't seem to be any other way of making this work,\n    // without having a physical space.\n    <>\n      <span className=\"spacer\"> </span>\n      <span\n        role=\"button\"\n        tabIndex={-1}\n        onClick={onClick}\n        ref={katexElementRef}\n      />\n      <span className=\"spacer\"> </span>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  COMMAND_PRIORITY_HIGH,\n  DecoratorNode,\n  KEY_ESCAPE_COMMAND,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useEffect, useRef, useState} from 'react';\n\nimport EquationEditor from '../ui/EquationEditor';\nimport KatexRenderer from '../ui/KatexRenderer';\n\ntype EquationComponentProps = {\n  equation: string;\n  inline: boolean;\n  nodeKey: NodeKey;\n};\n\nfunction EquationComponent({\n  equation,\n  inline,\n  nodeKey,\n}: EquationComponentProps): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [equationValue, setEquationValue] = useState(equation);\n  const [showEquationEditor, setShowEquationEditor] = useState<boolean>(false);\n  const inputRef = useRef(null);\n\n  const onHide = useCallback(\n    (restoreSelection?: boolean) => {\n      setShowEquationEditor(false);\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isEquationNode(node)) {\n          node.setEquation(equationValue);\n          if (restoreSelection) {\n            node.selectNext(0, 0);\n          }\n        }\n      });\n    },\n    [editor, equationValue, nodeKey],\n  );\n\n  useEffect(() => {\n    if (showEquationEditor) {\n      return mergeRegister(\n        editor.registerCommand(\n          SELECTION_CHANGE_COMMAND,\n          (payload) => {\n            const activeElement = document.activeElement;\n            const inputElem = inputRef.current;\n            if (inputElem !== activeElement) {\n              onHide();\n            }\n            return false;\n          },\n          COMMAND_PRIORITY_HIGH,\n        ),\n        editor.registerCommand(\n          KEY_ESCAPE_COMMAND,\n          (payload) => {\n            const activeElement = document.activeElement;\n            const inputElem = inputRef.current;\n            if (inputElem === activeElement) {\n              onHide(true);\n              return true;\n            }\n            return false;\n          },\n          COMMAND_PRIORITY_HIGH,\n        ),\n      );\n    }\n  }, [editor, onHide, showEquationEditor]);\n\n  return (\n    <>\n      {showEquationEditor ? (\n        <EquationEditor\n          equation={equationValue}\n          setEquation={setEquationValue}\n          inline={inline}\n          inputRef={inputRef}\n        />\n      ) : (\n        <KatexRenderer\n          equation={equationValue}\n          inline={inline}\n          onClick={() => {\n            setShowEquationEditor(true);\n          }}\n        />\n      )}\n    </>\n  );\n}\n\nexport type SerializedEquationNode = Spread<\n  {\n    type: 'equation';\n    equation: string;\n    inline: boolean;\n  },\n  SerializedLexicalNode\n>;\n\nexport class EquationNode extends DecoratorNode<JSX.Element> {\n  __equation: string;\n  __inline: boolean;\n\n  static getType(): string {\n    return 'equation';\n  }\n\n  static clone(node: EquationNode): EquationNode {\n    return new EquationNode(node.__equation, node.__inline, node.__key);\n  }\n\n  constructor(equation: string, inline?: boolean, key?: NodeKey) {\n    super(key);\n    this.__equation = equation;\n    this.__inline = inline ?? false;\n  }\n\n  static importJSON(serializedNode: SerializedEquationNode): EquationNode {\n    const node = $createEquationNode(\n      serializedNode.equation,\n      serializedNode.inline,\n    );\n    return node;\n  }\n\n  exportJSON(): SerializedEquationNode {\n    return {\n      equation: this.getEquation(),\n      inline: this.__inline,\n      type: 'equation',\n      version: 1,\n    };\n  }\n\n  createDOM(_config: EditorConfig): HTMLElement {\n    return document.createElement(this.__inline ? 'span' : 'div');\n  }\n\n  updateDOM(prevNode: EquationNode): boolean {\n    // If the inline property changes, replace the element\n    return this.__inline !== prevNode.__inline;\n  }\n\n  getEquation(): string {\n    return this.__equation;\n  }\n\n  setEquation(equation: string): void {\n    const writable = this.getWritable();\n    writable.__equation = equation;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <EquationComponent\n        equation={this.__equation}\n        inline={this.__inline}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createEquationNode(\n  equation = '',\n  inline = false,\n): EquationNode {\n  const equationNode = new EquationNode(equation, inline);\n  return equationNode;\n}\n\nexport function $isEquationNode(\n  node: LexicalNode | null | undefined,\n): node is EquationNode {\n  return node instanceof EquationNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalCommand} from 'lexical';\n\nimport 'katex/dist/katex.css';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createEquationNode, EquationNode} from '../nodes/EquationNode';\n\ntype CommandPayload = {\n  equation: string;\n  inline: boolean;\n};\n\nexport const INSERT_EQUATION_COMMAND: LexicalCommand<CommandPayload> =\n  createCommand();\n\nexport default function EquationsPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([EquationNode])) {\n      throw new Error(\n        'EquationsPlugins: EquationsNode not registered on editor',\n      );\n    }\n\n    return editor.registerCommand<CommandPayload>(\n      INSERT_EQUATION_COMMAND,\n      (payload) => {\n        const {equation, inline} = payload;\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const equationNode = $createEquationNode(equation, inline);\n          selection.insertNodes([equationNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalEditor} from 'lexical';\n\nimport * as React from 'react';\nimport {useRef} from 'react';\n\nfunction clamp(value: number, min: number, max: number) {\n  return Math.min(Math.max(value, min), max);\n}\n\nconst Direction = {\n  east: 1 << 0,\n  north: 1 << 3,\n  south: 1 << 1,\n  west: 1 << 2,\n};\n\nexport default function ImageResizer({\n  onResizeStart,\n  onResizeEnd,\n  imageRef,\n  maxWidth,\n  editor,\n  showCaption,\n  setShowCaption,\n}: {\n  editor: LexicalEditor;\n  imageRef: {current: null | HTMLElement};\n  maxWidth?: number;\n  onResizeEnd: (width: 'inherit' | number, height: 'inherit' | number) => void;\n  onResizeStart: () => void;\n  setShowCaption: (show: boolean) => void;\n  showCaption: boolean;\n}): JSX.Element {\n  const buttonRef = useRef(null);\n  const controlWrapperRef = useRef<HTMLDivElement>(null);\n  const userSelect = useRef({\n    priority: '',\n    value: 'default',\n  });\n  const positioningRef = useRef<{\n    currentHeight: 'inherit' | number;\n    currentWidth: 'inherit' | number;\n    direction: number;\n    isResizing: boolean;\n    ratio: number;\n    startHeight: number;\n    startWidth: number;\n    startX: number;\n    startY: number;\n  }>({\n    currentHeight: 0,\n    currentWidth: 0,\n    direction: 0,\n    isResizing: false,\n    ratio: 0,\n    startHeight: 0,\n    startWidth: 0,\n    startX: 0,\n    startY: 0,\n  });\n  const editorRootElement = editor.getRootElement();\n  // Find max width, accounting for editor padding.\n  const maxWidthContainer = maxWidth\n    ? maxWidth\n    : editorRootElement !== null\n    ? editorRootElement.getBoundingClientRect().width - 20\n    : 100;\n  const maxHeightContainer =\n    editorRootElement !== null\n      ? editorRootElement.getBoundingClientRect().height - 20\n      : 100;\n\n  const minWidth = 100;\n  const minHeight = 100;\n\n  const setStartCursor = (direction: number) => {\n    const ew = direction === Direction.east || direction === Direction.west;\n    const ns = direction === Direction.north || direction === Direction.south;\n    const nwse =\n      (direction & Direction.north && direction & Direction.west) ||\n      (direction & Direction.south && direction & Direction.east);\n\n    const cursorDir = ew ? 'ew' : ns ? 'ns' : nwse ? 'nwse' : 'nesw';\n\n    if (editorRootElement !== null) {\n      editorRootElement.style.setProperty(\n        'cursor',\n        `${cursorDir}-resize`,\n        'important',\n      );\n    }\n    if (document.body !== null) {\n      document.body.style.setProperty(\n        'cursor',\n        `${cursorDir}-resize`,\n        'important',\n      );\n      userSelect.current.value = document.body.style.getPropertyValue(\n        '-webkit-user-select',\n      );\n      userSelect.current.priority = document.body.style.getPropertyPriority(\n        '-webkit-user-select',\n      );\n      document.body.style.setProperty(\n        '-webkit-user-select',\n        `none`,\n        'important',\n      );\n    }\n  };\n\n  const setEndCursor = () => {\n    if (editorRootElement !== null) {\n      editorRootElement.style.setProperty('cursor', 'default');\n    }\n    if (document.body !== null) {\n      document.body.style.setProperty('cursor', 'default');\n      document.body.style.setProperty(\n        '-webkit-user-select',\n        userSelect.current.value,\n        userSelect.current.priority,\n      );\n    }\n  };\n\n  const handlePointerDown = (\n    event: React.PointerEvent<HTMLDivElement>,\n    direction: number,\n  ) => {\n    const image = imageRef.current;\n    const controlWrapper = controlWrapperRef.current;\n\n    if (image !== null && controlWrapper !== null) {\n      const {width, height} = image.getBoundingClientRect();\n      const positioning = positioningRef.current;\n      positioning.startWidth = width;\n      positioning.startHeight = height;\n      positioning.ratio = width / height;\n      positioning.currentWidth = width;\n      positioning.currentHeight = height;\n      positioning.startX = event.clientX;\n      positioning.startY = event.clientY;\n      positioning.isResizing = true;\n      positioning.direction = direction;\n\n      setStartCursor(direction);\n      onResizeStart();\n\n      controlWrapper.classList.add('image-control-wrapper--resizing');\n      image.style.height = `${height}px`;\n      image.style.width = `${width}px`;\n\n      document.addEventListener('pointermove', handlePointerMove);\n      document.addEventListener('pointerup', handlePointerUp);\n    }\n  };\n  const handlePointerMove = (event: PointerEvent) => {\n    const image = imageRef.current;\n    const positioning = positioningRef.current;\n\n    const isHorizontal =\n      positioning.direction & (Direction.east | Direction.west);\n    const isVertical =\n      positioning.direction & (Direction.south | Direction.north);\n\n    if (image !== null && positioning.isResizing) {\n      // Corner cursor\n      if (isHorizontal && isVertical) {\n        let diff = Math.floor(positioning.startX - event.clientX);\n        diff = positioning.direction & Direction.east ? -diff : diff;\n\n        const width = clamp(\n          positioning.startWidth + diff,\n          minWidth,\n          maxWidthContainer,\n        );\n\n        const height = width / positioning.ratio;\n        image.style.width = `${width}px`;\n        image.style.height = `${height}px`;\n        positioning.currentHeight = height;\n        positioning.currentWidth = width;\n      } else if (isVertical) {\n        let diff = Math.floor(positioning.startY - event.clientY);\n        diff = positioning.direction & Direction.south ? -diff : diff;\n\n        const height = clamp(\n          positioning.startHeight + diff,\n          minHeight,\n          maxHeightContainer,\n        );\n\n        image.style.height = `${height}px`;\n        positioning.currentHeight = height;\n      } else {\n        let diff = Math.floor(positioning.startX - event.clientX);\n        diff = positioning.direction & Direction.east ? -diff : diff;\n\n        const width = clamp(\n          positioning.startWidth + diff,\n          minWidth,\n          maxWidthContainer,\n        );\n\n        image.style.width = `${width}px`;\n        positioning.currentWidth = width;\n      }\n    }\n  };\n  const handlePointerUp = () => {\n    const image = imageRef.current;\n    const positioning = positioningRef.current;\n    const controlWrapper = controlWrapperRef.current;\n    if (image !== null && controlWrapper !== null && positioning.isResizing) {\n      const width = positioning.currentWidth;\n      const height = positioning.currentHeight;\n      positioning.startWidth = 0;\n      positioning.startHeight = 0;\n      positioning.ratio = 0;\n      positioning.startX = 0;\n      positioning.startY = 0;\n      positioning.currentWidth = 0;\n      positioning.currentHeight = 0;\n      positioning.isResizing = false;\n\n      controlWrapper.classList.remove('image-control-wrapper--resizing');\n\n      setEndCursor();\n      onResizeEnd(width, height);\n\n      document.removeEventListener('pointermove', handlePointerMove);\n      document.removeEventListener('pointerup', handlePointerUp);\n    }\n  };\n  return (\n    <div ref={controlWrapperRef}>\n      {!showCaption && (\n        <button\n          className=\"image-caption-button\"\n          ref={buttonRef}\n          onClick={() => {\n            setShowCaption(!showCaption);\n          }}>\n          Add Caption\n        </button>\n      )}\n      <div\n        className=\"image-resizer image-resizer-n\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-ne\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north | Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-e\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-se\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south | Direction.east);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-s\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-sw\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.south | Direction.west);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-w\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.west);\n        }}\n      />\n      <div\n        className=\"image-resizer image-resizer-nw\"\n        onPointerDown={(event) => {\n          handlePointerDown(event, Direction.north | Direction.west);\n        }}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {exportToSvg} from '@excalidraw/excalidraw';\nimport {\n  ExcalidrawElement,\n  NonDeleted,\n} from '@excalidraw/excalidraw/types/element/types';\nimport {AppState} from '@excalidraw/excalidraw/types/types';\nimport * as React from 'react';\nimport {useEffect, useState} from 'react';\n\ntype ImageType = 'svg' | 'canvas';\n\ntype Props = {\n  /**\n   * Configures the export setting for SVG/Canvas\n   */\n  appState?: Partial<Omit<AppState, 'offsetTop' | 'offsetLeft'>> | null;\n  /**\n   * The css class applied to image to be rendered\n   */\n  className?: string;\n  /**\n   * The Excalidraw elements to be rendered as an image\n   */\n  elements: NonDeleted<ExcalidrawElement>[];\n  /**\n   * The height of the image to be rendered\n   */\n  height?: number | null;\n  /**\n   * The ref object to be used to render the image\n   */\n  imageContainerRef: {current: null | HTMLDivElement};\n  /**\n   * The type of image to be rendered\n   */\n  imageType?: ImageType;\n  /**\n   * The css class applied to the root element of this component\n   */\n  rootClassName?: string | null;\n  /**\n   * The width of the image to be rendered\n   */\n  width?: number | null;\n};\n\n// exportToSvg has fonts from excalidraw.com\n// We don't want them to be used in open source\nconst removeStyleFromSvg_HACK = (svg: SVGElement) => {\n  const styleTag = svg?.firstElementChild?.firstElementChild;\n\n  // Generated SVG is getting double-sized by height and width attributes\n  // We want to match the real size of the SVG element\n  const viewBox = svg.getAttribute('viewBox');\n  if (viewBox != null) {\n    const viewBoxDimensions = viewBox.split(' ');\n    svg.setAttribute('width', viewBoxDimensions[2]);\n    svg.setAttribute('height', viewBoxDimensions[3]);\n  }\n\n  if (styleTag && styleTag.tagName === 'style') {\n    styleTag.remove();\n  }\n};\n\n/**\n * @explorer-desc\n * A component for rendering Excalidraw elements as a static image\n */\nexport default function ExcalidrawImage({\n  elements,\n  imageContainerRef,\n  appState = null,\n  rootClassName = null,\n}: Props): JSX.Element {\n  const [Svg, setSvg] = useState<SVGElement | null>(null);\n\n  useEffect(() => {\n    const setContent = async () => {\n      if (appState === null) {\n        return;\n      }\n\n      const svg: SVGElement = await exportToSvg({\n        appState,\n        elements,\n        files: null,\n      });\n      removeStyleFromSvg_HACK(svg);\n\n      svg.setAttribute('width', '100%');\n      svg.setAttribute('height', '100%');\n      svg.setAttribute('display', 'block');\n\n      setSvg(svg);\n    };\n    setContent();\n  }, [elements, appState]);\n\n  return (\n    <div\n      ref={imageContainerRef}\n      className={rootClassName ?? ''}\n      dangerouslySetInnerHTML={{__html: Svg?.outerHTML ?? ''}}\n    />\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {ExcalidrawElementFragment} from './ExcalidrawModal';\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {useLexicalNodeSelection} from '@lexical/react/useLexicalNodeSelection';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isNodeSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  DecoratorNode,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useEffect, useMemo, useRef, useState} from 'react';\n\nimport ImageResizer from '../../ui/ImageResizer';\nimport ExcalidrawImage from './ExcalidrawImage';\nimport ExcalidrawModal from './ExcalidrawModal';\n\nfunction ExcalidrawComponent({\n  nodeKey,\n  data,\n}: {\n  data: string;\n  nodeKey: NodeKey;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  // const [isModalOpen, setModalOpen] = useState<boolean>(\n  //   data === '[]' && !editor.isReadOnly(),\n  // );\n  const imageContainerRef = useRef<HTMLImageElement | null>(null);\n  const buttonRef = useRef<HTMLButtonElement | null>(null);\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey);\n  const [isResizing, setIsResizing] = useState<boolean>(false);\n\n  const onDelete = useCallback(\n    (event: KeyboardEvent) => {\n      if (isSelected && $isNodeSelection($getSelection())) {\n        event.preventDefault();\n        editor.update(() => {\n          const node = $getNodeByKey(nodeKey);\n          if ($isExcalidrawNode(node)) {\n            node.remove();\n          }\n          setSelected(false);\n        });\n      }\n      return false;\n    },\n    [editor, isSelected, nodeKey, setSelected],\n  );\n\n  // Set editor to readOnly if excalidraw is open to prevent unwanted changes\n  // useEffect(() => {\n  //   if (isModalOpen) {\n  //     editor.setReadOnly(true);\n  //   } else {\n  //     editor.setReadOnly(false);\n  //   }\n  // }, [isModalOpen, editor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerCommand(\n        CLICK_COMMAND,\n        (event: MouseEvent) => {\n          const buttonElem = buttonRef.current;\n          const eventTarget = event.target;\n\n          if (isResizing) {\n            return true;\n          }\n\n          if (buttonElem !== null && buttonElem.contains(eventTarget as Node)) {\n            if (!event.shiftKey) {\n              clearSelection();\n            }\n            setSelected(!isSelected);\n            if (event.detail > 1) {\n              // setModalOpen(true);\n            }\n            return true;\n          }\n\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [clearSelection, editor, isSelected, isResizing, onDelete, setSelected]);\n\n  const deleteNode = useCallback(() => {\n    // setModalOpen(false);\n    return editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isExcalidrawNode(node)) {\n        node.remove();\n      }\n    });\n  }, [editor, nodeKey]);\n\n  const setData = (newData: ReadonlyArray<ExcalidrawElementFragment>) => {\n    // if (editor.isReadOnly()) {\n    //   return;\n    // }\n    return editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isExcalidrawNode(node)) {\n        if (newData.length > 0) {\n          node.setData(JSON.stringify(newData));\n        } else {\n          node.remove();\n        }\n      }\n    });\n  };\n\n  const onResizeStart = () => {\n    setIsResizing(true);\n  };\n\n  const onResizeEnd = () => {\n    // Delay hiding the resize bars for click case\n    setTimeout(() => {\n      setIsResizing(false);\n    }, 200);\n  };\n\n  const elements = useMemo(() => JSON.parse(data), [data]);\n  return (\n    <>\n      {/* <ExcalidrawModal\n        initialElements={elements}\n        isShown={isModalOpen}\n        onDelete={deleteNode}\n        onHide={() => {\n          editor.setReadOnly(false);\n          setModalOpen(false);\n        }}\n        onSave={(newData) => {\n          editor.setReadOnly(false);\n          setData(newData);\n          setModalOpen(false);\n        }}\n        closeOnClickOutside={true}\n      /> */}\n      {elements.length > 0 && (\n        <button\n          ref={buttonRef}\n          className={`excalidraw-button ${isSelected ? 'selected' : ''}`}>\n          <ExcalidrawImage\n            imageContainerRef={imageContainerRef}\n            className=\"image\"\n            elements={elements}\n          />\n          {(isSelected || isResizing) && (\n            <ImageResizer\n              showCaption={true}\n              setShowCaption={() => null}\n              imageRef={imageContainerRef}\n              editor={editor}\n              onResizeStart={onResizeStart}\n              onResizeEnd={onResizeEnd}\n            />\n          )}\n        </button>\n      )}\n    </>\n  );\n}\n\nexport type SerializedExcalidrawNode = Spread<\n  {\n    data: string;\n    type: 'excalidraw';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertExcalidrawElement(\n  domNode: HTMLElement,\n): DOMConversionOutput | null {\n  const excalidrawData = domNode.getAttribute('data-lexical-excalidraw-json');\n  if (excalidrawData) {\n    const node = $createExcalidrawNode();\n    node.__data = excalidrawData;\n    return {\n      node,\n    };\n  }\n  return null;\n}\n\nexport class ExcalidrawNode extends DecoratorNode<JSX.Element> {\n  __data: string;\n\n  static getType(): string {\n    return 'excalidraw';\n  }\n\n  static clone(node: ExcalidrawNode): ExcalidrawNode {\n    return new ExcalidrawNode(node.__data, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedExcalidrawNode): ExcalidrawNode {\n    return new ExcalidrawNode(serializedNode.data);\n  }\n\n  exportJSON(): SerializedExcalidrawNode {\n    return {\n      data: this.__data,\n      type: 'excalidraw',\n      version: 1,\n    };\n  }\n\n  constructor(data = '[]', key?: NodeKey) {\n    super(key);\n    this.__data = data;\n  }\n\n  // View\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  static importDOM(): DOMConversionMap<HTMLSpanElement> | null {\n    return {\n      span: (domNode: HTMLSpanElement) => {\n        if (!domNode.hasAttribute('data-lexical-excalidraw-json')) {\n          return null;\n        }\n        return {\n          conversion: convertExcalidrawElement,\n          priority: 1,\n        };\n      },\n    };\n  }\n\n  exportDOM(editor: LexicalEditor): DOMExportOutput {\n    const element = document.createElement('span');\n    const content = editor.getElementByKey(this.getKey());\n    if (content !== null) {\n      const svg = content.querySelector('svg');\n      if (svg !== null) {\n        element.innerHTML = svg.outerHTML;\n      }\n    }\n    element.setAttribute('data-lexical-excalidraw-json', this.__data);\n    return {element};\n  }\n\n  setData(data: string): void {\n    const self = this.getWritable();\n    self.__data = data;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    return <ExcalidrawComponent nodeKey={this.getKey()} data={this.__data} />;\n  }\n}\n\nexport function $createExcalidrawNode(): ExcalidrawNode {\n  return new ExcalidrawNode();\n}\n\nexport function $isExcalidrawNode(\n  node: LexicalNode | null,\n): node is ExcalidrawNode {\n  return node instanceof ExcalidrawNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type {LexicalCommand} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createExcalidrawNode, ExcalidrawNode} from '../nodes/ExcalidrawNode';\n\nexport const INSERT_EXCALIDRAW_COMMAND: LexicalCommand<void> = createCommand();\nexport default function ExcalidrawPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([ExcalidrawNode])) {\n      throw new Error(\n        'ExcalidrawPlugin: ExcalidrawNode not registered on editor',\n      );\n    }\n\n    return editor.registerCommand(\n      INSERT_EXCALIDRAW_COMMAND,\n      () => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const excalidrawNode = $createExcalidrawNode();\n          selection.insertNodes([excalidrawNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $createHorizontalRuleNode,\n  INSERT_HORIZONTAL_RULE_COMMAND,\n} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nexport default function HorizontalRulePlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INSERT_HORIZONTAL_RULE_COMMAND,\n      (type) => {\n        const selection = $getSelection();\n\n        if (!$isRangeSelection(selection)) {\n          return false;\n        }\n\n        const focusNode = selection.focus.getNode();\n\n        if (focusNode !== null) {\n          const horizontalRuleNode = $createHorizontalRuleNode();\n          selection.insertParagraph();\n          selection.focus\n            .getNode()\n            .getTopLevelElementOrThrow()\n            .insertBefore(horizontalRuleNode);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nconst getSelection = (): Selection | null => window.getSelection();\n\nexport default getSelection;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalNode,\n  SerializedTextNode,\n  Spread,\n} from 'lexical';\n\nimport {TextNode} from 'lexical';\n\nexport type SerializedKeywordNode = Spread<\n  {\n    type: 'keyword';\n    version: 1;\n  },\n  SerializedTextNode\n>;\n\nexport class KeywordNode extends TextNode {\n  static getType(): string {\n    return 'keyword';\n  }\n\n  static clone(node: KeywordNode): KeywordNode {\n    return new KeywordNode(node.__text, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedKeywordNode): KeywordNode {\n    const node = $createKeywordNode(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  exportJSON(): SerializedKeywordNode {\n    return {\n      ...super.exportJSON(),\n      type: 'keyword',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cursor = 'default';\n    dom.className = 'keyword';\n    return dom;\n  }\n\n  canInsertTextBefore(): boolean {\n    return false;\n  }\n\n  canInsertTextAfter(): boolean {\n    return false;\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createKeywordNode(keyword: string): KeywordNode {\n  return new KeywordNode(keyword);\n}\n\nexport function $isKeywordNode(\n  node: LexicalNode | null | undefined | undefined,\n): boolean {\n  return node instanceof KeywordNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {TextNode} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {useLexicalTextEntity} from '@lexical/react/useLexicalTextEntity';\nimport {useCallback, useEffect} from 'react';\n\nimport {$createKeywordNode, KeywordNode} from '../nodes/KeywordNode';\n\nconst KEYWORDS_REGEX =\n  /(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])(congrats|congratulations|gratuluju|gratuluji|gratulujeme|blahopřeju|blahopřeji|blahopřejeme|Til lykke|Tillykke|Glückwunsch|Gratuliere|felicitaciones|enhorabuena|paljon onnea|onnittelut|Félicitations|gratula|gratulálok|gratulálunk|congratulazioni|complimenti|おめでとう|おめでとうございます|축하해|축하해요|gratulerer|Gefeliciteerd|gratulacje|Parabéns|parabéns|felicitações|felicitări|мои поздравления|поздравляем|поздравляю|gratulujem|blahoželám|ยินดีด้วย|ขอแสดงความยินดี|tebrikler|tebrik ederim|恭喜|祝贺你|恭喜你|恭喜|恭喜|baie geluk|veels geluk|অভিনন্দন|Čestitam|Čestitke|Čestitamo|Συγχαρητήρια|Μπράβο|અભિનંદન|badhai|बधाई|अभिनंदन|Честитам|Свака част|hongera|வாழ்த்துகள்|வாழ்த்துக்கள்|అభినందనలు|അഭിനന്ദനങ്ങൾ|Chúc mừng|מזל טוב|mazel tov|mazal tov)(^|$|[^A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ])/i;\n\nexport default function KeywordsPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([KeywordNode])) {\n      throw new Error('KeywordsPlugin: KeywordNode not registered on editor');\n    }\n  }, [editor]);\n\n  const createKeywordNode = useCallback((textNode: TextNode): KeywordNode => {\n    return $createKeywordNode(textNode.getTextContent());\n  }, []);\n\n  const getKeywordMatch = useCallback((text: string) => {\n    const matchArr = KEYWORDS_REGEX.exec(text);\n\n    if (matchArr === null) {\n      return null;\n    }\n\n    const hashtagLength = matchArr[2].length;\n    const startOffset = matchArr.index + matchArr[1].length;\n    const endOffset = startOffset + hashtagLength;\n    return {\n      end: endOffset,\n      start: startOffset,\n    };\n  }, []);\n\n  useLexicalTextEntity<KeywordNode>(\n    getKeywordMatch,\n    KeywordNode,\n    createKeywordNode,\n  );\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useEffect, useLayoutEffect} from 'react';\nimport {CAN_USE_DOM} from '../../shared/src/canUseDOM';\n\nconst useLayoutEffectImpl: typeof useLayoutEffect = CAN_USE_DOM\n  ? useLayoutEffect\n  : useEffect;\n\nexport default useLayoutEffectImpl;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {Spread} from 'lexical';\n\nimport {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  LexicalNode,\n  NodeKey,\n  SerializedTextNode,\n  TextNode,\n} from 'lexical';\n\nexport type SerializedMentionNode = Spread<\n  {\n    mentionName: string;\n    type: 'mention';\n    version: 1;\n  },\n  SerializedTextNode\n>;\n\nfunction convertMentionElement(\n  domNode: HTMLElement,\n): DOMConversionOutput | null {\n  const textContent = domNode.textContent;\n\n  if (textContent !== null) {\n    const node = $createMentionNode(textContent);\n    return {\n      node,\n    };\n  }\n\n  return null;\n}\n\nconst mentionStyle = 'background-color: rgba(24, 119, 232, 0.2)';\nexport class MentionNode extends TextNode {\n  __mention: string;\n\n  static getType(): string {\n    return 'mention';\n  }\n\n  static clone(node: MentionNode): MentionNode {\n    return new MentionNode(node.__mention, node.__text, node.__key);\n  }\n  static importJSON(serializedNode: SerializedMentionNode): MentionNode {\n    const node = $createMentionNode(serializedNode.mentionName);\n    node.setTextContent(serializedNode.text);\n    node.setFormat(serializedNode.format);\n    node.setDetail(serializedNode.detail);\n    node.setMode(serializedNode.mode);\n    node.setStyle(serializedNode.style);\n    return node;\n  }\n\n  constructor(mentionName: string, text?: string, key?: NodeKey) {\n    super(text ?? mentionName, key);\n    this.__mention = mentionName;\n  }\n\n  exportJSON(): SerializedMentionNode {\n    return {\n      ...super.exportJSON(),\n      mentionName: this.__mention,\n      type: 'mention',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = mentionStyle;\n    dom.className = 'mention';\n    return dom;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-mention', 'true');\n    element.textContent = this.__text;\n    return {element};\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-mention')) {\n          return null;\n        }\n        return {\n          conversion: convertMentionElement,\n          priority: 1,\n        };\n      },\n    };\n  }\n\n  isTextEntity(): true {\n    return true;\n  }\n}\n\nexport function $createMentionNode(mentionName: string): MentionNode {\n  const mentionNode = new MentionNode(mentionName);\n  mentionNode.setMode('segmented').toggleDirectionless();\n  return mentionNode;\n}\n\nexport function $isMentionNode(\n  node: LexicalNode | null | undefined,\n): node is MentionNode {\n  return node instanceof MentionNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalEditor, RangeSelection} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  KEY_ARROW_DOWN_COMMAND,\n  KEY_ARROW_UP_COMMAND,\n  KEY_ENTER_COMMAND,\n  KEY_ESCAPE_COMMAND,\n  KEY_TAB_COMMAND,\n} from 'lexical';\nimport {\n  ReactPortal,\n  startTransition,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport * as React from 'react';\nimport {createPortal} from 'react-dom';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nimport {$createMentionNode, MentionNode} from '../nodes/MentionNode';\n\ntype MentionMatch = {\n  leadOffset: number;\n  matchingString: string;\n  replaceableString: string;\n};\n\ntype Resolution = {\n  match: MentionMatch;\n  range: Range;\n};\n\nconst PUNCTUATION =\n  '\\\\.,\\\\+\\\\*\\\\?\\\\$\\\\@\\\\|#{}\\\\(\\\\)\\\\^\\\\-\\\\[\\\\]\\\\\\\\/!%\\'\"~=<>_:;';\nconst NAME = '\\\\b[A-Z][^\\\\s' + PUNCTUATION + ']';\n\nconst DocumentMentionsRegex = {\n  NAME,\n  PUNCTUATION,\n};\n\nconst CapitalizedNameMentionsRegex = new RegExp(\n  '(^|[^#])((?:' + DocumentMentionsRegex.NAME + '{' + 1 + ',})$)',\n);\n\nconst PUNC = DocumentMentionsRegex.PUNCTUATION;\n\nconst TRIGGERS = ['@', '\\\\uff20'].join('');\n\n// Chars we expect to see in a mention (non-space, non-punctuation).\nconst VALID_CHARS = '[^' + TRIGGERS + PUNC + '\\\\s]';\n\n// Non-standard series of chars. Each series must be preceded and followed by\n// a valid char.\nconst VALID_JOINS =\n  '(?:' +\n  '\\\\.[ |$]|' + // E.g. \"r. \" in \"Mr. Smith\"\n  ' |' + // E.g. \" \" in \"Josh Duck\"\n  '[' +\n  PUNC +\n  ']|' + // E.g. \"-' in \"Salier-Hellendag\"\n  ')';\n\nconst LENGTH_LIMIT = 75;\n\nconst AtSignMentionsRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    VALID_JOINS +\n    '){0,' +\n    LENGTH_LIMIT +\n    '})' +\n    ')$',\n);\n\n// 50 is the longest alias length limit.\nconst ALIAS_LENGTH_LIMIT = 50;\n\n// Regex used to match alias.\nconst AtSignMentionsRegexAliasRegex = new RegExp(\n  '(^|\\\\s|\\\\()(' +\n    '[' +\n    TRIGGERS +\n    ']' +\n    '((?:' +\n    VALID_CHARS +\n    '){0,' +\n    ALIAS_LENGTH_LIMIT +\n    '})' +\n    ')$',\n);\n\n// At most, 5 suggestions are shown in the popup.\nconst SUGGESTION_LIST_LENGTH_LIMIT = 5;\n\nconst mentionsCache = new Map();\n\nconst dummyMentionsData = [\n  'Aayla Secura',\n  'Adi Gallia',\n  'Admiral Dodd Rancit',\n  'Admiral Firmus Piett',\n  'Admiral Gial Ackbar',\n  'Admiral Ozzel',\n  'Admiral Raddus',\n  'Admiral Terrinald Screed',\n  'Admiral Trench',\n  'Admiral U.O. Statura',\n  'Agen Kolar',\n  'Agent Kallus',\n  'Aiolin and Morit Astarte',\n  'Aks Moe',\n  'Almec',\n  'Alton Kastle',\n  'Amee',\n  'AP-5',\n  'Armitage Hux',\n  'Artoo',\n  'Arvel Crynyd',\n  'Asajj Ventress',\n  'Aurra Sing',\n  'AZI-3',\n  'Bala-Tik',\n  'Barada',\n  'Bargwill Tomder',\n  'Baron Papanoida',\n  'Barriss Offee',\n  'Baze Malbus',\n  'Bazine Netal',\n  'BB-8',\n  'BB-9E',\n  'Ben Quadinaros',\n  'Berch Teller',\n  'Beru Lars',\n  'Bib Fortuna',\n  'Biggs Darklighter',\n  'Black Krrsantan',\n  'Bo-Katan Kryze',\n  'Boba Fett',\n  'Bobbajo',\n  'Bodhi Rook',\n  'Borvo the Hutt',\n  'Boss Nass',\n  'Bossk',\n  'Breha Antilles-Organa',\n  'Bren Derlin',\n  'Brendol Hux',\n  'BT-1',\n  'C-3PO',\n  'C1-10P',\n  'Cad Bane',\n  'Caluan Ematt',\n  'Captain Gregor',\n  'Captain Phasma',\n  'Captain Quarsh Panaka',\n  'Captain Rex',\n  'Carlist Rieekan',\n  'Casca Panzoro',\n  'Cassian Andor',\n  'Cassio Tagge',\n  'Cham Syndulla',\n  'Che Amanwe Papanoida',\n  'Chewbacca',\n  'Chi Eekway Papanoida',\n  'Chief Chirpa',\n  'Chirrut Îmwe',\n  'Ciena Ree',\n  'Cin Drallig',\n  'Clegg Holdfast',\n  'Cliegg Lars',\n  'Coleman Kcaj',\n  'Coleman Trebor',\n  'Colonel Kaplan',\n  'Commander Bly',\n  'Commander Cody (CC-2224)',\n  'Commander Fil (CC-3714)',\n  'Commander Fox',\n  'Commander Gree',\n  'Commander Jet',\n  'Commander Wolffe',\n  'Conan Antonio Motti',\n  'Conder Kyl',\n  'Constable Zuvio',\n  'Cordé',\n  'Cpatain Typho',\n  'Crix Madine',\n  'Cut Lawquane',\n  'Dak Ralter',\n  'Dapp',\n  'Darth Bane',\n  'Darth Maul',\n  'Darth Tyranus',\n  'Daultay Dofine',\n  'Del Meeko',\n  'Delian Mors',\n  'Dengar',\n  'Depa Billaba',\n  'Derek Klivian',\n  'Dexter Jettster',\n  'Dineé Ellberger',\n  'DJ',\n  'Doctor Aphra',\n  'Doctor Evazan',\n  'Dogma',\n  'Dormé',\n  'Dr. Cylo',\n  'Droidbait',\n  'Droopy McCool',\n  'Dryden Vos',\n  'Dud Bolt',\n  'Ebe E. Endocott',\n  'Echuu Shen-Jon',\n  'Eeth Koth',\n  'Eighth Brother',\n  'Eirtaé',\n  'Eli Vanto',\n  'Ellé',\n  'Ello Asty',\n  'Embo',\n  'Eneb Ray',\n  'Enfys Nest',\n  'EV-9D9',\n  'Evaan Verlaine',\n  'Even Piell',\n  'Ezra Bridger',\n  'Faro Argyus',\n  'Feral',\n  'Fifth Brother',\n  'Finis Valorum',\n  'Finn',\n  'Fives',\n  'FN-1824',\n  'FN-2003',\n  'Fodesinbeed Annodue',\n  'Fulcrum',\n  'FX-7',\n  'GA-97',\n  'Galen Erso',\n  'Gallius Rax',\n  'Garazeb \"Zeb\" Orrelios',\n  'Gardulla the Hutt',\n  'Garrick Versio',\n  'Garven Dreis',\n  'Gavyn Sykes',\n  'Gideon Hask',\n  'Gizor Dellso',\n  'Gonk droid',\n  'Grand Inquisitor',\n  'Greeata Jendowanian',\n  'Greedo',\n  'Greer Sonnel',\n  'Grievous',\n  'Grummgar',\n  'Gungi',\n  'Hammerhead',\n  'Han Solo',\n  'Harter Kalonia',\n  'Has Obbit',\n  'Hera Syndulla',\n  'Hevy',\n  'Hondo Ohnaka',\n  'Huyang',\n  'Iden Versio',\n  'IG-88',\n  'Ima-Gun Di',\n  'Inquisitors',\n  'Inspector Thanoth',\n  'Jabba',\n  'Jacen Syndulla',\n  'Jan Dodonna',\n  'Jango Fett',\n  'Janus Greejatus',\n  'Jar Jar Binks',\n  'Jas Emari',\n  'Jaxxon',\n  'Jek Tono Porkins',\n  'Jeremoch Colton',\n  'Jira',\n  'Jobal Naberrie',\n  'Jocasta Nu',\n  'Joclad Danva',\n  'Joh Yowza',\n  'Jom Barell',\n  'Joph Seastriker',\n  'Jova Tarkin',\n  'Jubnuk',\n  'Jyn Erso',\n  'K-2SO',\n  'Kanan Jarrus',\n  'Karbin',\n  'Karina the Great',\n  'Kes Dameron',\n  'Ketsu Onyo',\n  'Ki-Adi-Mundi',\n  'King Katuunko',\n  'Kit Fisto',\n  'Kitster Banai',\n  'Klaatu',\n  'Klik-Klak',\n  'Korr Sella',\n  'Kylo Ren',\n  'L3-37',\n  'Lama Su',\n  'Lando Calrissian',\n  'Lanever Villecham',\n  'Leia Organa',\n  'Letta Turmond',\n  'Lieutenant Kaydel Ko Connix',\n  'Lieutenant Thire',\n  'Lobot',\n  'Logray',\n  'Lok Durd',\n  'Longo Two-Guns',\n  'Lor San Tekka',\n  'Lorth Needa',\n  'Lott Dod',\n  'Luke Skywalker',\n  'Lumat',\n  'Luminara Unduli',\n  'Lux Bonteri',\n  'Lyn Me',\n  'Lyra Erso',\n  'Mace Windu',\n  'Malakili',\n  'Mama the Hutt',\n  'Mars Guo',\n  'Mas Amedda',\n  'Mawhonic',\n  'Max Rebo',\n  'Maximilian Veers',\n  'Maz Kanata',\n  'ME-8D9',\n  'Meena Tills',\n  'Mercurial Swift',\n  'Mina Bonteri',\n  'Miraj Scintel',\n  'Mister Bones',\n  'Mod Terrik',\n  'Moden Canady',\n  'Mon Mothma',\n  'Moradmin Bast',\n  'Moralo Eval',\n  'Morley',\n  'Mother Talzin',\n  'Nahdar Vebb',\n  'Nahdonnis Praji',\n  'Nien Nunb',\n  'Niima the Hutt',\n  'Nines',\n  'Norra Wexley',\n  'Nute Gunray',\n  'Nuvo Vindi',\n  'Obi-Wan Kenobi',\n  'Odd Ball',\n  'Ody Mandrell',\n  'Omi',\n  'Onaconda Farr',\n  'Oola',\n  'OOM-9',\n  'Oppo Rancisis',\n  'Orn Free Taa',\n  'Oro Dassyne',\n  'Orrimarko',\n  'Osi Sobeck',\n  'Owen Lars',\n  'Pablo-Jill',\n  'Padmé Amidala',\n  'Pagetti Rook',\n  'Paige Tico',\n  'Paploo',\n  'Petty Officer Thanisson',\n  'Pharl McQuarrie',\n  'Plo Koon',\n  'Po Nudo',\n  'Poe Dameron',\n  'Poggle the Lesser',\n  'Pong Krell',\n  'Pooja Naberrie',\n  'PZ-4CO',\n  'Quarrie',\n  'Quay Tolsite',\n  'Queen Apailana',\n  'Queen Jamillia',\n  'Queen Neeyutnee',\n  'Qui-Gon Jinn',\n  'Quiggold',\n  'Quinlan Vos',\n  'R2-D2',\n  'R2-KT',\n  'R3-S6',\n  'R4-P17',\n  'R5-D4',\n  'RA-7',\n  'Rabé',\n  'Rako Hardeen',\n  'Ransolm Casterfo',\n  'Rappertunie',\n  'Ratts Tyerell',\n  'Raymus Antilles',\n  'Ree-Yees',\n  'Reeve Panzoro',\n  'Rey',\n  'Ric Olié',\n  'Riff Tamson',\n  'Riley',\n  'Rinnriyin Di',\n  'Rio Durant',\n  'Rogue Squadron',\n  'Romba',\n  'Roos Tarpals',\n  'Rose Tico',\n  'Rotta the Hutt',\n  'Rukh',\n  'Rune Haako',\n  'Rush Clovis',\n  'Ruwee Naberrie',\n  'Ryoo Naberrie',\n  'Sabé',\n  'Sabine Wren',\n  'Saché',\n  'Saelt-Marae',\n  'Saesee Tiin',\n  'Salacious B. Crumb',\n  'San Hill',\n  'Sana Starros',\n  'Sarco Plank',\n  'Sarkli',\n  'Satine Kryze',\n  'Savage Opress',\n  'Sebulba',\n  'Senator Organa',\n  'Sergeant Kreel',\n  'Seventh Sister',\n  'Shaak Ti',\n  'Shara Bey',\n  'Shmi Skywalker',\n  'Shu Mai',\n  'Sidon Ithano',\n  'Sifo-Dyas',\n  'Sim Aloo',\n  'Siniir Rath Velus',\n  'Sio Bibble',\n  'Sixth Brother',\n  'Slowen Lo',\n  'Sly Moore',\n  'Snaggletooth',\n  'Snap Wexley',\n  'Snoke',\n  'Sola Naberrie',\n  'Sora Bulq',\n  'Strono Tuggs',\n  'Sy Snootles',\n  'Tallissan Lintra',\n  'Tarfful',\n  'Tasu Leech',\n  'Taun We',\n  'TC-14',\n  'Tee Watt Kaa',\n  'Teebo',\n  'Teedo',\n  'Teemto Pagalies',\n  'Temiri Blagg',\n  'Tessek',\n  'Tey How',\n  'Thane Kyrell',\n  'The Bendu',\n  'The Smuggler',\n  'Thrawn',\n  'Tiaan Jerjerrod',\n  'Tion Medon',\n  'Tobias Beckett',\n  'Tulon Voidgazer',\n  'Tup',\n  'U9-C4',\n  'Unkar Plutt',\n  'Val Beckett',\n  'Vanden Willard',\n  'Vice Admiral Amilyn Holdo',\n  'Vober Dand',\n  'WAC-47',\n  'Wag Too',\n  'Wald',\n  'Walrus Man',\n  'Warok',\n  'Wat Tambor',\n  'Watto',\n  'Wedge Antilles',\n  'Wes Janson',\n  'Wicket W. Warrick',\n  'Wilhuff Tarkin',\n  'Wollivan',\n  'Wuher',\n  'Wullf Yularen',\n  'Xamuel Lennox',\n  'Yaddle',\n  'Yarael Poof',\n  'Yoda',\n  'Zam Wesell',\n  'Zev Senesca',\n  'Ziro the Hutt',\n  'Zuckuss',\n];\n\nconst dummyLookupService = {\n  search(\n    string: string,\n    callback: (results: Array<string> | null) => void,\n  ): void {\n    setTimeout(() => {\n      const results = dummyMentionsData.filter((mention) =>\n        mention.toLowerCase().includes(string.toLowerCase()),\n      );\n      if (results.length === 0) {\n        callback(null);\n      } else {\n        callback(results);\n      }\n    }, 500);\n  },\n};\n\nfunction useMentionLookupService(mentionString: string) {\n  const [results, setResults] = useState<Array<string> | null>(null);\n\n  useEffect(() => {\n    const cachedResults = mentionsCache.get(mentionString);\n\n    if (cachedResults === null) {\n      return;\n    } else if (cachedResults !== undefined) {\n      setResults(cachedResults);\n      return;\n    }\n\n    mentionsCache.set(mentionString, null);\n    dummyLookupService.search(mentionString, (newResults) => {\n      mentionsCache.set(mentionString, newResults);\n      setResults(newResults);\n    });\n  }, [mentionString]);\n\n  return results;\n}\n\nfunction MentionsTypeaheadItem({\n  index,\n  isSelected,\n  onClick,\n  onMouseEnter,\n  result,\n}: {\n  index: number;\n  isSelected: boolean;\n  onClick: () => void;\n  onMouseEnter: () => void;\n  result: string;\n}) {\n  const liRef = useRef(null);\n\n  let className = 'item';\n  if (isSelected) {\n    className += ' selected';\n  }\n\n  return (\n    <li\n      key={result}\n      tabIndex={-1}\n      className={className}\n      ref={liRef}\n      role=\"option\"\n      aria-selected={isSelected}\n      id={'typeahead-item-' + index}\n      onMouseEnter={onMouseEnter}\n      onClick={onClick}>\n      {result}\n    </li>\n  );\n}\n\nfunction MentionsTypeahead({\n  close,\n  editor,\n  resolution,\n}: {\n  close: () => void;\n  editor: LexicalEditor;\n  resolution: Resolution;\n}): JSX.Element | null {\n  const divRef = useRef<HTMLDivElement>(null);\n  const match = resolution.match;\n  const results = useMentionLookupService(match.matchingString);\n  const [selectedIndex, setSelectedIndex] = useState<null | number>(null);\n\n  useEffect(() => {\n    const div = divRef.current;\n    const rootElement = editor.getRootElement();\n    if (results !== null && div !== null && rootElement !== null) {\n      const range = resolution.range;\n      const {left, top, height} = range.getBoundingClientRect();\n      div.style.top = `${top + height + 2}px`;\n      div.style.left = `${left - 14}px`;\n      div.style.display = 'block';\n      rootElement.setAttribute('aria-controls', 'mentions-typeahead');\n\n      return () => {\n        div.style.display = 'none';\n        rootElement.removeAttribute('aria-controls');\n      };\n    }\n  }, [editor, resolution, results]);\n\n  const applyCurrentSelected = useCallback(() => {\n    if (results === null || selectedIndex === null) {\n      return;\n    }\n    const selectedEntry = results[selectedIndex];\n\n    close();\n\n    createMentionNodeFromSearchResult(editor, selectedEntry, match);\n  }, [close, match, editor, results, selectedIndex]);\n\n  const updateSelectedIndex = useCallback(\n    (index: number) => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.setAttribute(\n          'aria-activedescendant',\n          'typeahead-item-' + index,\n        );\n        setSelectedIndex(index);\n      }\n    },\n    [editor],\n  );\n\n  useEffect(() => {\n    return () => {\n      const rootElem = editor.getRootElement();\n      if (rootElem !== null) {\n        rootElem.removeAttribute('aria-activedescendant');\n      }\n    };\n  }, [editor]);\n\n  useLayoutEffect(() => {\n    if (results === null) {\n      setSelectedIndex(null);\n    } else if (selectedIndex === null) {\n      updateSelectedIndex(0);\n    }\n  }, [results, selectedIndex, updateSelectedIndex]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_DOWN_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results !== null && selectedIndex !== null) {\n            if (\n              selectedIndex < SUGGESTION_LIST_LENGTH_LIMIT - 1 &&\n              selectedIndex !== results.length - 1\n            ) {\n              updateSelectedIndex(selectedIndex + 1);\n            }\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ARROW_UP_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results !== null && selectedIndex !== null) {\n            if (selectedIndex !== 0) {\n              updateSelectedIndex(selectedIndex - 1);\n            }\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_ESCAPE_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          close();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<KeyboardEvent>(\n        KEY_TAB_COMMAND,\n        (payload) => {\n          const event = payload;\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          event.preventDefault();\n          event.stopImmediatePropagation();\n          applyCurrentSelected();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_ENTER_COMMAND,\n        (event: KeyboardEvent | null) => {\n          if (results === null || selectedIndex === null) {\n            return false;\n          }\n          if (event !== null) {\n            event.preventDefault();\n            event.stopImmediatePropagation();\n          }\n          applyCurrentSelected();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [\n    applyCurrentSelected,\n    close,\n    editor,\n    results,\n    selectedIndex,\n    updateSelectedIndex,\n  ]);\n\n  if (results === null) {\n    return null;\n  }\n\n  return (\n    <div\n      aria-label=\"Suggested mentions\"\n      id=\"mentions-typeahead\"\n      ref={divRef}\n      role=\"listbox\">\n      <ul>\n        {results.slice(0, SUGGESTION_LIST_LENGTH_LIMIT).map((result, i) => (\n          <MentionsTypeaheadItem\n            index={i}\n            isSelected={i === selectedIndex}\n            onClick={() => {\n              setSelectedIndex(i);\n              applyCurrentSelected();\n            }}\n            onMouseEnter={() => {\n              setSelectedIndex(i);\n            }}\n            key={result}\n            result={result}\n          />\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nfunction checkForCapitalizedNameMentions(\n  text: string,\n  minMatchLength: number,\n): MentionMatch | null {\n  const match = CapitalizedNameMentionsRegex.exec(text);\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[2];\n    if (matchingString != null && matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: matchingString,\n      };\n    }\n  }\n  return null;\n}\n\nfunction checkForAtSignMentions(\n  text: string,\n  minMatchLength: number,\n): MentionMatch | null {\n  let match = AtSignMentionsRegex.exec(text);\n\n  if (match === null) {\n    match = AtSignMentionsRegexAliasRegex.exec(text);\n  }\n  if (match !== null) {\n    // The strategy ignores leading whitespace but we need to know it's\n    // length to add it to the leadOffset\n    const maybeLeadingWhitespace = match[1];\n\n    const matchingString = match[3];\n    if (matchingString.length >= minMatchLength) {\n      return {\n        leadOffset: match.index + maybeLeadingWhitespace.length,\n        matchingString,\n        replaceableString: match[2],\n      };\n    }\n  }\n  return null;\n}\n\nfunction getPossibleMentionMatch(text: string): MentionMatch | null {\n  const match = checkForAtSignMentions(text, 1);\n  return match === null ? checkForCapitalizedNameMentions(text, 3) : match;\n}\n\nfunction getTextUpToAnchor(selection: RangeSelection): string | null {\n  const anchor = selection.anchor;\n  if (anchor.type !== 'text') {\n    return null;\n  }\n  const anchorNode = anchor.getNode();\n  // We should not be attempting to extract mentions out of nodes\n  // that are already being used for other core things. This is\n  // especially true for token nodes, which can't be mutated at all.\n  if (!anchorNode.isSimpleText()) {\n    return null;\n  }\n  const anchorOffset = anchor.offset;\n  return anchorNode.getTextContent().slice(0, anchorOffset);\n}\n\nfunction tryToPositionRange(match: MentionMatch, range: Range): boolean {\n  const domSelection = window.getSelection();\n  if (domSelection === null || !domSelection.isCollapsed) {\n    return false;\n  }\n  const anchorNode = domSelection.anchorNode;\n  const startOffset = match.leadOffset;\n  const endOffset = domSelection.anchorOffset;\n  try {\n    if (anchorNode) {\n      range.setStart(anchorNode, startOffset);\n      range.setEnd(anchorNode, endOffset);\n    }\n  } catch (error) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction getMentionsTextToSearch(editor: LexicalEditor): string | null {\n  let text = null;\n  editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection)) {\n      return;\n    }\n    text = getTextUpToAnchor(selection);\n  });\n  return text;\n}\n\n/**\n * Walk backwards along user input and forward through entity title to try\n * and replace more of the user's text with entity.\n *\n * E.g. User types \"Hello Sarah Smit\" and we match \"Smit\" to \"Sarah Smith\".\n * Replacing just the match would give us \"Hello Sarah Sarah Smith\".\n * Instead we find the string \"Sarah Smit\" and replace all of it.\n */\nfunction getMentionOffset(\n  documentText: string,\n  entryText: string,\n  offset: number,\n): number {\n  let triggerOffset = offset;\n  for (let ii = triggerOffset; ii <= entryText.length; ii++) {\n    if (documentText.substr(-ii) === entryText.substr(0, ii)) {\n      triggerOffset = ii;\n    }\n  }\n\n  return triggerOffset;\n}\n\n/**\n * From a Typeahead Search Result, replace plain text from search offset and\n * render a newly created MentionNode.\n */\nfunction createMentionNodeFromSearchResult(\n  editor: LexicalEditor,\n  entryText: string,\n  match: MentionMatch,\n): void {\n  editor.update(() => {\n    const selection = $getSelection();\n    if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n      return;\n    }\n    const anchor = selection.anchor;\n    if (anchor.type !== 'text') {\n      return;\n    }\n    const anchorNode = anchor.getNode();\n    // We should not be attempting to extract mentions out of nodes\n    // that are already being used for other core things. This is\n    // especially true for token nodes, which can't be mutated at all.\n    if (!anchorNode.isSimpleText()) {\n      return;\n    }\n    const selectionOffset = anchor.offset;\n    const textContent = anchorNode.getTextContent().slice(0, selectionOffset);\n    const characterOffset = match.replaceableString.length;\n\n    // Given a known offset for the mention match, look backward in the\n    // text to see if there's a longer match to replace.\n    const mentionOffset = getMentionOffset(\n      textContent,\n      entryText,\n      characterOffset,\n    );\n    const startOffset = selectionOffset - mentionOffset;\n    if (startOffset < 0) {\n      return;\n    }\n\n    let nodeToReplace;\n    if (startOffset === 0) {\n      [nodeToReplace] = anchorNode.splitText(selectionOffset);\n    } else {\n      [, nodeToReplace] = anchorNode.splitText(startOffset, selectionOffset);\n    }\n\n    const mentionNode = $createMentionNode(entryText);\n    nodeToReplace.replace(mentionNode);\n    mentionNode.select();\n  });\n}\n\nfunction isSelectionOnEntityBoundary(\n  editor: LexicalEditor,\n  offset: number,\n): boolean {\n  if (offset !== 0) {\n    return false;\n  }\n  return editor.getEditorState().read(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchor = selection.anchor;\n      const anchorNode = anchor.getNode();\n      const prevSibling = anchorNode.getPreviousSibling();\n      return $isTextNode(prevSibling) && prevSibling.isTextEntity();\n    }\n    return false;\n  });\n}\n\nfunction useMentions(editor: LexicalEditor): ReactPortal | null {\n  const [resolution, setResolution] = useState<Resolution | null>(null);\n\n  useEffect(() => {\n    if (!editor.hasNodes([MentionNode])) {\n      throw new Error('MentionsPlugin: MentionNode not registered on editor');\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    let activeRange: Range | null = document.createRange();\n    let previousText: string | null = null;\n\n    const updateListener = () => {\n      const range = activeRange;\n      const text = getMentionsTextToSearch(editor);\n\n      if (text === previousText || range === null) {\n        return;\n      }\n      previousText = text;\n\n      if (text === null) {\n        return;\n      }\n      const match = getPossibleMentionMatch(text);\n      if (\n        match !== null &&\n        !isSelectionOnEntityBoundary(editor, match.leadOffset)\n      ) {\n        const isRangePositioned = tryToPositionRange(match, range);\n        if (isRangePositioned !== null) {\n          startTransition(() =>\n            setResolution({\n              match,\n              range,\n            }),\n          );\n          return;\n        }\n      }\n      startTransition(() => setResolution(null));\n    };\n\n    const removeUpdateListener = editor.registerUpdateListener(updateListener);\n\n    return () => {\n      activeRange = null;\n      removeUpdateListener();\n    };\n  }, [editor]);\n\n  const closeTypeahead = useCallback(() => {\n    setResolution(null);\n  }, []);\n\n  return resolution === null || editor === null\n    ? null\n    : createPortal(\n        <MentionsTypeahead\n          close={closeTypeahead}\n          resolution={resolution}\n          editor={editor}\n        />,\n        document.body,\n      );\n}\n\nexport default function MentionsPlugin(): ReactPortal | null {\n  const [editor] = useLexicalComposerContext();\n  return useMentions(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $deleteTableColumn,\n  $getElementGridForTableNode,\n  $getTableCellNodeFromLexicalNode,\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  $removeTableRowAtIndex,\n  getTableSelectionFromTableElement,\n  HTMLTableElementWithWithTableSelectionState,\n  TableCellHeaderStates,\n  TableCellNode,\n} from '@lexical/table';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n} from 'lexical';\nimport * as React from 'react';\nimport {ReactPortal, useCallback, useEffect, useRef, useState} from 'react';\nimport {createPortal} from 'react-dom';\n\ntype TableCellActionMenuProps = Readonly<{\n  contextRef: {current: null | HTMLElement};\n  onClose: () => void;\n  setIsMenuOpen: (isOpen: boolean) => void;\n  tableCellNode: TableCellNode;\n}>;\n\nfunction TableActionMenu({\n  onClose,\n  tableCellNode: _tableCellNode,\n  setIsMenuOpen,\n  contextRef,\n}: TableCellActionMenuProps) {\n  const [editor] = useLexicalComposerContext();\n  const dropDownRef = useRef<HTMLDivElement | null>(null);\n  const [tableCellNode, updateTableCellNode] = useState(_tableCellNode);\n  const [selectionCounts, updateSelectionCounts] = useState({\n    columns: 1,\n    rows: 1,\n  });\n\n  useEffect(() => {\n    return editor.registerMutationListener(TableCellNode, (nodeMutations) => {\n      const nodeUpdated =\n        nodeMutations.get(tableCellNode.getKey()) === 'updated';\n\n      if (nodeUpdated) {\n        editor.getEditorState().read(() => {\n          updateTableCellNode(tableCellNode.getLatest());\n        });\n      }\n    });\n  }, [editor, tableCellNode]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      const selection = $getSelection();\n\n\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    const menuButtonElement = contextRef.current;\n    const dropDownElement = dropDownRef.current;\n\n    if (menuButtonElement != null && dropDownElement != null) {\n      const menuButtonRect = menuButtonElement.getBoundingClientRect();\n\n      dropDownElement.style.opacity = '1';\n\n      dropDownElement.style.left = `${\n        menuButtonRect.left + menuButtonRect.width + window.pageXOffset + 5\n      }px`;\n\n      dropDownElement.style.top = `${\n        menuButtonRect.top + window.pageYOffset\n      }px`;\n    }\n  }, [contextRef, dropDownRef]);\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        dropDownRef.current != null &&\n        contextRef.current != null &&\n        !dropDownRef.current.contains(event.target as Node) &&\n        !contextRef.current.contains(event.target as Node)\n      ) {\n        setIsMenuOpen(false);\n      }\n    }\n\n    window.addEventListener('click', handleClickOutside);\n\n    return () => window.removeEventListener('click', handleClickOutside);\n  }, [setIsMenuOpen, contextRef]);\n\n  const clearTableSelection = useCallback(() => {\n    editor.update(() => {\n      if (tableCellNode.isAttached()) {\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n        const tableElement = editor.getElementByKey(\n          tableNode.getKey(),\n        ) as HTMLTableElementWithWithTableSelectionState;\n\n        if (!tableElement) {\n          throw new Error('Expected to find tableElement in DOM');\n        }\n\n        const tableSelection = getTableSelectionFromTableElement(tableElement);\n        if (tableSelection !== null) {\n          tableSelection.clearHighlight();\n        }\n\n        tableNode.markDirty();\n        updateTableCellNode(tableCellNode.getLatest());\n      }\n\n      $setSelection(null);\n    });\n  }, [editor, tableCellNode]);\n\n  const insertTableRowAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableRowIndex;\n\n \n\n        const grid = $getElementGridForTableNode(editor, tableNode);\n\n      \n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [editor, tableCellNode, selectionCounts.rows, clearTableSelection, onClose],\n  );\n\n  const insertTableColumnAtSelection = useCallback(\n    (shouldInsertAfter: boolean) => {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        let tableColumnIndex;\n\n    \n        clearTableSelection();\n\n        onClose();\n      });\n    },\n    [\n      editor,\n      tableCellNode,\n      selectionCounts.columns,\n      clearTableSelection,\n      onClose,\n    ],\n  );\n\n  const deleteTableRowAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      $removeTableRowAtIndex(tableNode, tableRowIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n      tableNode.remove();\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const deleteTableColumnAtSelection = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      $deleteTableColumn(tableNode, tableColumnIndex);\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableRowIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n        throw new Error('Expected table cell to be inside of table row.');\n      }\n\n      const tableRow = tableRows[tableRowIndex];\n\n      if (!$isTableRowNode(tableRow)) {\n        throw new Error('Expected table row');\n      }\n\n      tableRow.getChildren().forEach((tableCell) => {\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.ROW);\n      });\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  const toggleTableColumnIsHeader = useCallback(() => {\n    editor.update(() => {\n      const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n      const tableColumnIndex =\n        $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n      const tableRows = tableNode.getChildren();\n\n      for (let r = 0; r < tableRows.length; r++) {\n        const tableRow = tableRows[r];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        const tableCells = tableRow.getChildren();\n\n        if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableCell = tableCells[tableColumnIndex];\n\n        if (!$isTableCellNode(tableCell)) {\n          throw new Error('Expected table cell');\n        }\n\n        tableCell.toggleHeaderStyle(TableCellHeaderStates.COLUMN);\n      }\n\n      clearTableSelection();\n      onClose();\n    });\n  }, [editor, tableCellNode, clearTableSelection, onClose]);\n\n  return createPortal(\n    <div\n      className=\"dropdown\"\n      ref={dropDownRef}\n      onClick={(e) => {\n        e.stopPropagation();\n      }}>\n      <button className=\"item\" onClick={() => insertTableRowAtSelection(false)}>\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.rows === 1 ? 'row' : `${selectionCounts.rows} rows`}{' '}\n          above\n        </span>\n      </button>\n      <button className=\"item\" onClick={() => insertTableRowAtSelection(true)}>\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.rows === 1 ? 'row' : `${selectionCounts.rows} rows`}{' '}\n          below\n        </span>\n      </button>\n      <hr />\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(false)}>\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.columns === 1\n            ? 'column'\n            : `${selectionCounts.columns} columns`}{' '}\n          left\n        </span>\n      </button>\n      <button\n        className=\"item\"\n        onClick={() => insertTableColumnAtSelection(true)}>\n        <span className=\"text\">\n          Insert{' '}\n          {selectionCounts.columns === 1\n            ? 'column'\n            : `${selectionCounts.columns} columns`}{' '}\n          right\n        </span>\n      </button>\n      <hr />\n      <button className=\"item\" onClick={() => deleteTableColumnAtSelection()}>\n        <span className=\"text\">Delete column</span>\n      </button>\n      <button className=\"item\" onClick={() => deleteTableRowAtSelection()}>\n        <span className=\"text\">Delete row</span>\n      </button>\n      <button className=\"item\" onClick={() => deleteTableAtSelection()}>\n        <span className=\"text\">Delete table</span>\n      </button>\n      <hr />\n      <button className=\"item\" onClick={() => toggleTableRowIsHeader()}>\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.ROW) ===\n          TableCellHeaderStates.ROW\n            ? 'Remove'\n            : 'Add'}{' '}\n          row header\n        </span>\n      </button>\n      <button className=\"item\" onClick={() => toggleTableColumnIsHeader()}>\n        <span className=\"text\">\n          {(tableCellNode.__headerState & TableCellHeaderStates.COLUMN) ===\n          TableCellHeaderStates.COLUMN\n            ? 'Remove'\n            : 'Add'}{' '}\n          column header\n        </span>\n      </button>\n    </div>,\n    document.body,\n  );\n}\n\nfunction TableCellActionMenuContainer(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n\n  const menuButtonRef = useRef(null);\n  const menuRootRef = useRef(null);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const [tableCellNode, setTableMenuCellNode] = useState<TableCellNode | null>(\n    null,\n  );\n\n  const moveMenu = useCallback(() => {\n    const menu = menuButtonRef.current;\n    const selection = $getSelection();\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (selection == null || menu == null) {\n      setTableMenuCellNode(null);\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n\n    if (\n      $isRangeSelection(selection) &&\n      rootElement !== null &&\n      nativeSelection !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const tableCellNodeFromSelection = $getTableCellNodeFromLexicalNode(\n        selection.anchor.getNode(),\n      );\n\n      if (tableCellNodeFromSelection == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      const tableCellParentNodeDOM = editor.getElementByKey(\n        tableCellNodeFromSelection.getKey(),\n      );\n\n      if (tableCellParentNodeDOM == null) {\n        setTableMenuCellNode(null);\n        return;\n      }\n\n      setTableMenuCellNode(tableCellNodeFromSelection);\n    } else if (!activeElement) {\n      setTableMenuCellNode(null);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      editor.getEditorState().read(() => {\n        moveMenu();\n      });\n    });\n  });\n\n  useEffect(() => {\n    const menuButtonDOM = menuButtonRef.current as HTMLButtonElement | null;\n\n    if (menuButtonDOM != null && tableCellNode != null) {\n      const tableCellNodeDOM = editor.getElementByKey(tableCellNode.getKey());\n\n      if (tableCellNodeDOM != null) {\n        const tableCellRect = tableCellNodeDOM.getBoundingClientRect();\n        const menuRect = menuButtonDOM.getBoundingClientRect();\n\n        menuButtonDOM.style.opacity = '1';\n\n        menuButtonDOM.style.left = `${\n          tableCellRect.left +\n          window.pageXOffset -\n          menuRect.width +\n          tableCellRect.width -\n          10\n        }px`;\n\n        menuButtonDOM.style.top = `${\n          tableCellRect.top + window.pageYOffset + 5\n        }px`;\n      } else {\n        menuButtonDOM.style.opacity = '0';\n      }\n    }\n  }, [menuButtonRef, tableCellNode, editor]);\n\n  const prevTableCellDOM = useRef(tableCellNode);\n\n  useEffect(() => {\n    if (prevTableCellDOM.current !== tableCellNode) {\n      setIsMenuOpen(false);\n    }\n\n    prevTableCellDOM.current = tableCellNode;\n  }, [prevTableCellDOM, tableCellNode]);\n\n  return (\n    <div className=\"table-cell-action-button-container\" ref={menuButtonRef}>\n      {tableCellNode != null && (\n        <>\n          <button\n            className=\"table-cell-action-button chevron-down\"\n            onClick={(e) => {\n              e.stopPropagation();\n              setIsMenuOpen(!isMenuOpen);\n            }}\n            ref={menuRootRef}>\n            <i className=\"chevron-down\" />\n          </button>\n          {isMenuOpen && (\n            <TableActionMenu\n              contextRef={menuRootRef}\n              setIsMenuOpen={setIsMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              tableCellNode={tableCellNode}\n            />\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableActionMenuPlugin(): ReactPortal {\n  return createPortal(<TableCellActionMenuContainer />, document.body);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  GridSelection,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  NodeSelection,\n  RangeSelection,\n  SerializedEditor,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\n// import './ImageNode.css';\n\nimport {\n  CollaborationPlugin,\n} from '@lexical/react/LexicalCollaborationPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {HashtagPlugin} from '@lexical/react/LexicalHashtagPlugin';\nimport {HistoryPlugin} from '@lexical/react/LexicalHistoryPlugin';\nimport {LinkPlugin} from '@lexical/react/LexicalLinkPlugin';\nimport {LexicalNestedComposer} from '@lexical/react/LexicalNestedComposer';\nimport {RichTextPlugin} from '@lexical/react/LexicalRichTextPlugin';\nimport {TablePlugin} from '@lexical/react/LexicalTablePlugin';\nimport {useLexicalNodeSelection} from '@lexical/react/useLexicalNodeSelection';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isNodeSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  createEditor,\n  DecoratorNode,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {Suspense, useCallback, useEffect, useRef, useState} from 'react';\n\nimport {createWebsocketProvider} from '../collaboration';\nimport {useSettings} from '../context/SettingsContext';\nimport {useSharedHistoryContext} from '../context/SharedHistoryContext';\nimport EmojisPlugin from '../plugins/EmojisPlugin';\nimport ImagesPlugin from '../plugins/ImagesPlugin';\nimport KeywordsPlugin from '../plugins/KeywordsPlugin';\nimport MentionsPlugin from '../plugins/MentionsPlugin';\nimport TableCellActionMenuPlugin from '../plugins/TableActionMenuPlugin';\n// import TreeViewPlugin from '../plugins/TreeViewPlugin';\nimport ContentEditable from '../ui/ContentEditable';\nimport ImageResizer from '../ui/ImageResizer';\nimport Placeholder from '../ui/Placeholder';\n\nexport interface ImagePayload {\n  altText: string;\n  caption?: LexicalEditor;\n  height?: number;\n  key?: NodeKey;\n  maxWidth?: number;\n  showCaption?: boolean;\n  src: string;\n  width?: number;\n}\n\nconst imageCache = new Set();\n\nfunction useSuspenseImage(src: string) {\n  if (!imageCache.has(src)) {\n    throw new Promise((resolve) => {\n      const img = new Image();\n      img.src = src;\n      img.onload = () => {\n        imageCache.add(src);\n        resolve(null);\n      };\n    });\n  }\n}\n\nfunction convertImageElement(domNode: Node): null | DOMConversionOutput {\n  if (domNode instanceof HTMLImageElement) {\n    const {alt: altText, src} = domNode;\n    const node = $createImageNode({altText, src});\n    return {node};\n  }\n  return null;\n}\n\nfunction LazyImage({\n  altText,\n  className,\n  imageRef,\n  src,\n  width,\n  height,\n  maxWidth,\n}: {\n  altText: string;\n  className: string | null;\n  height: 'inherit' | number;\n  imageRef: {current: null | HTMLImageElement};\n  maxWidth: number;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  useSuspenseImage(src);\n  return (\n    <img\n      className={className || undefined}\n      src={src}\n      alt={altText}\n      ref={imageRef}\n      style={{\n        height,\n        maxWidth,\n        width,\n      }}\n      draggable=\"false\"\n    />\n  );\n}\n\nfunction ImageComponent({\n  src,\n  altText,\n  nodeKey,\n  width,\n  height,\n  maxWidth,\n  resizable,\n  showCaption,\n  caption,\n}: {\n  altText: string;\n  caption: LexicalEditor;\n  height: 'inherit' | number;\n  maxWidth: number;\n  nodeKey: NodeKey;\n  resizable: boolean;\n  showCaption: boolean;\n  src: string;\n  width: 'inherit' | number;\n}): JSX.Element {\n  const ref = useRef(null);\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey);\n  const [isResizing, setIsResizing] = useState<boolean>(false);\n  // const {yjsDocMap} = useCollaborationContext();\n  const [editor] = useLexicalComposerContext();\n  // const isCollab = yjsDocMap.get('main') !== undefined;\n  const [selection, setSelection] = useState<\n    RangeSelection | NodeSelection | GridSelection | null\n  >(null);\n\n  const onDelete = useCallback(\n    (payload: KeyboardEvent) => {\n      if (isSelected && $isNodeSelection($getSelection())) {\n        const event: KeyboardEvent = payload;\n        event.preventDefault();\n        const node = $getNodeByKey(nodeKey);\n        if ($isImageNode(node)) {\n          node.remove();\n        }\n        setSelected(false);\n      }\n      return false;\n    },\n    [isSelected, nodeKey, setSelected],\n  );\n\n  useEffect(() => {\n    return mergeRegister(\n      // editor.registerUpdateListener(({editorState}) => {\n      //   setSelection(editorState.read(() => $getSelection()));\n      // }),\n      editor.registerCommand<MouseEvent>(\n        CLICK_COMMAND,\n        (payload) => {\n          const event = payload;\n\n          if (isResizing) {\n            return true;\n          }\n          if (event.target === ref.current) {\n            if (!event.shiftKey) {\n              clearSelection();\n            }\n            setSelected(!isSelected);\n            return true;\n          }\n\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [\n    clearSelection,\n    editor,\n    isResizing,\n    isSelected,\n    nodeKey,\n    onDelete,\n    setSelected,\n  ]);\n\n  const setShowCaption = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isImageNode(node)) {\n        node.setShowCaption(true);\n      }\n    });\n  };\n\n  const onResizeEnd = (\n    nextWidth: 'inherit' | number,\n    nextHeight: 'inherit' | number,\n  ) => {\n    // Delay hiding the resize bars for click case\n    setTimeout(() => {\n      setIsResizing(false);\n    }, 200);\n\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isImageNode(node)) {\n        node.setWidthAndHeight(nextWidth, nextHeight);\n      }\n    });\n  };\n\n  const onResizeStart = () => {\n    setIsResizing(true);\n  };\n\n  const {historyState} = useSharedHistoryContext();\n  const {\n    settings: {showNestedEditorTreeView},\n  } = useSettings();\n\n  const draggable = isSelected && $isNodeSelection(selection);\n  const isFocused = $isNodeSelection(selection) && (isSelected || isResizing);\n\n  return (\n    <Suspense fallback={null}>\n      <>\n        <div draggable={draggable}>\n          <LazyImage\n            className={isFocused ? 'focused' : null}\n            src={src}\n            altText={altText}\n            imageRef={ref}\n            width={width}\n            height={height}\n            maxWidth={maxWidth}\n          />\n        </div>\n        {showCaption && (\n          <div className=\"image-caption-container\">\n            <LexicalNestedComposer initialEditor={caption}>\n              <MentionsPlugin />\n              <TablePlugin />\n              <TableCellActionMenuPlugin />\n              <ImagesPlugin />\n              <LinkPlugin />\n              <EmojisPlugin />\n              <HashtagPlugin />\n              <KeywordsPlugin />\n              {/* {isCollab ? (\n                <CollaborationPlugin\n                  id={caption.getKey()}\n                  providerFactory={createWebsocketProvider}\n                  shouldBootstrap={true}\n                />\n              ) : (\n                <HistoryPlugin externalHistoryState={historyState} />\n              )} */}\n              {/* <RichTextPlugin\n                contentEditable={\n                  <ContentEditable className=\"ImageNode__contentEditable\" />\n                }\n                placeholder={\n                  <Placeholder className=\"ImageNode__placeholder\">\n                    Enter a caption...\n                  </Placeholder>\n                }\n                // TODO Remove after it's inherited from the parent (LexicalComposer)\n                initialEditorState={null}\n              /> */}\n              {/* {showNestedEditorTreeView === true ? <TreeViewPlugin /> : null} */}\n            </LexicalNestedComposer>\n          </div>\n        )}\n        {resizable && isFocused && (\n          <ImageResizer\n            showCaption={showCaption}\n            setShowCaption={setShowCaption}\n            editor={editor}\n            imageRef={ref}\n            maxWidth={maxWidth}\n            onResizeStart={onResizeStart}\n            onResizeEnd={onResizeEnd}\n          />\n        )}\n      </>\n    </Suspense>\n  );\n}\n\nexport type SerializedImageNode = Spread<\n  {\n    altText: string;\n    caption: SerializedEditor;\n    height?: number;\n    maxWidth: number;\n    showCaption: boolean;\n    src: string;\n    width?: number;\n    type: 'image';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class ImageNode extends DecoratorNode<JSX.Element> {\n  __src: string;\n  __altText: string;\n  __width: 'inherit' | number;\n  __height: 'inherit' | number;\n  __maxWidth: number;\n  __showCaption: boolean;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'image';\n  }\n\n  static clone(node: ImageNode): ImageNode {\n    return new ImageNode(\n      node.__src,\n      node.__altText,\n      node.__maxWidth,\n      node.__width,\n      node.__height,\n      node.__showCaption,\n      node.__caption,\n      node.__key,\n    );\n  }\n\n  static importJSON(serializedNode: SerializedImageNode): ImageNode {\n    const {altText, height, width, maxWidth, caption, src, showCaption} =\n      serializedNode;\n    const node = $createImageNode({\n      altText,\n      height,\n      maxWidth,\n      showCaption,\n      src,\n      width,\n    });\n    const nestedEditor = node.__caption;\n    const editorState = nestedEditor.parseEditorState(caption.editorState);\n    if (!editorState.isEmpty()) {\n      nestedEditor.setEditorState(editorState);\n    }\n    return node;\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('img');\n    element.setAttribute('src', this.__src);\n    element.setAttribute('alt', this.__altText);\n    return {element};\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      img: (node: Node) => ({\n        conversion: convertImageElement,\n        priority: 0,\n      }),\n    };\n  }\n\n  constructor(\n    src: string,\n    altText: string,\n    maxWidth: number,\n    width?: 'inherit' | number,\n    height?: 'inherit' | number,\n    showCaption?: boolean,\n    caption?: LexicalEditor,\n    key?: NodeKey,\n  ) {\n    super(key);\n    this.__src = src;\n    this.__altText = altText;\n    this.__maxWidth = maxWidth;\n    this.__width = width || 'inherit';\n    this.__height = height || 'inherit';\n    this.__showCaption = showCaption || false;\n    this.__caption = caption || createEditor();\n  }\n\n  exportJSON(): SerializedImageNode {\n    return {\n      altText: this.getAltText(),\n      caption: this.__caption.toJSON(),\n      height: this.__height === 'inherit' ? 0 : this.__height,\n      maxWidth: this.__maxWidth,\n      showCaption: this.__showCaption,\n      src: this.getSrc(),\n      type: 'image',\n      version: 1,\n      width: this.__width === 'inherit' ? 0 : this.__width,\n    };\n  }\n\n  setWidthAndHeight(\n    width: 'inherit' | number,\n    height: 'inherit' | number,\n  ): void {\n    const writable = this.getWritable();\n    writable.__width = width;\n    writable.__height = height;\n  }\n\n  setShowCaption(showCaption: boolean): void {\n    const writable = this.getWritable();\n    writable.__showCaption = showCaption;\n  }\n\n  // View\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const span = document.createElement('span');\n    const theme = config.theme;\n    const className = theme.image;\n    if (className !== undefined) {\n      span.className = className;\n    }\n    return span;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  getSrc(): string {\n    return this.__src;\n  }\n\n  getAltText(): string {\n    return this.__altText;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <ImageComponent\n        src={this.__src}\n        altText={this.__altText}\n        width={this.__width}\n        height={this.__height}\n        maxWidth={this.__maxWidth}\n        nodeKey={this.getKey()}\n        showCaption={this.__showCaption}\n        caption={this.__caption}\n        resizable={true}\n      />\n    );\n  }\n}\n\nexport function $createImageNode({\n  altText,\n  height,\n  maxWidth = 500,\n  src,\n  width,\n  showCaption,\n  caption,\n  key,\n}: ImagePayload): ImageNode {\n  return new ImageNode(\n    src,\n    altText,\n    maxWidth,\n    width,\n    height,\n    showCaption,\n    caption,\n    key,\n  );\n}\n\nexport function $isImageNode(\n  node: LexicalNode | null | undefined,\n): node is ImageNode {\n  return node instanceof ImageNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type {LexicalCommand, LexicalEditor} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $createRangeSelection,\n  $getSelection,\n  $isNodeSelection,\n  $isRangeSelection,\n  $isRootNode,\n  $setSelection,\n  COMMAND_PRIORITY_EDITOR,\n  COMMAND_PRIORITY_HIGH,\n  COMMAND_PRIORITY_LOW,\n  createCommand,\n  DRAGOVER_COMMAND,\n  DRAGSTART_COMMAND,\n  DROP_COMMAND,\n} from 'lexical';\nimport {useEffect} from 'react';\nimport getSelection from '../shared/src/getDOMSelection';\n\nimport {\n  $createImageNode,\n  $isImageNode,\n  ImageNode,\n  ImagePayload,\n} from '../nodes/ImageNode';\n\nexport type InsertImagePayload = Readonly<ImagePayload>;\n\nexport const INSERT_IMAGE_COMMAND: LexicalCommand<InsertImagePayload> =\n  createCommand();\nexport default function ImagesPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([ImageNode])) {\n      throw new Error('ImagesPlugin: ImageNode not registered on editor');\n    }\n\n    return mergeRegister(\n      editor.registerCommand<InsertImagePayload>(\n        INSERT_IMAGE_COMMAND,\n        (payload) => {\n          const selection = $getSelection();\n          if ($isRangeSelection(selection)) {\n            if ($isRootNode(selection.anchor.getNode())) {\n              selection.insertParagraph();\n            }\n            const imageNode = $createImageNode(payload);\n            selection.insertNodes([imageNode]);\n          }\n          return true;\n        },\n        COMMAND_PRIORITY_EDITOR,\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGSTART_COMMAND,\n        (event) => {\n          return onDragStart(event);\n        },\n        COMMAND_PRIORITY_HIGH,\n      ),\n      editor.registerCommand<DragEvent>(\n        DRAGOVER_COMMAND,\n        (event) => {\n          return onDragover(event);\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand<DragEvent>(\n        DROP_COMMAND,\n        (event) => {\n          return onDrop(event, editor);\n        },\n        COMMAND_PRIORITY_HIGH,\n      ),\n    );\n  }, [editor]);\n\n  return null;\n}\n\nconst TRANSPARENT_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\nconst img = document.createElement('img');\nimg.src = TRANSPARENT_IMAGE;\n\nfunction onDragStart(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const dataTransfer = event.dataTransfer;\n  if (!dataTransfer) {\n    return false;\n  }\n  dataTransfer.setData('text/plain', '_');\n  dataTransfer.setDragImage(img, 0, 0);\n  dataTransfer.setData(\n    'application/x-lexical-drag',\n    JSON.stringify({\n      data: {\n        altText: node.__altText,\n        caption: node.__caption,\n        height: node.__height,\n        key: node.getKey(),\n        maxWidth: node.__maxWidth,\n        showCaption: node.__showCaption,\n        src: node.__src,\n        width: node.__width,\n      },\n      type: 'image',\n    }),\n  );\n\n  return true;\n}\n\nfunction onDragover(event: DragEvent): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  if (!canDropImage(event)) {\n    event.preventDefault();\n  }\n  return true;\n}\n\nfunction onDrop(event: DragEvent, editor: LexicalEditor): boolean {\n  const node = getImageNodeInSelection();\n  if (!node) {\n    return false;\n  }\n  const data = getDragImageData(event);\n  if (!data) {\n    return false;\n  }\n  event.preventDefault();\n  if (canDropImage(event)) {\n    const range = getDragSelection(event);\n    node.remove();\n    const rangeSelection = $createRangeSelection();\n    if (range !== null && range !== undefined) {\n      rangeSelection.applyDOMRange(range);\n    }\n    $setSelection(rangeSelection);\n    editor.dispatchCommand(INSERT_IMAGE_COMMAND, data);\n  }\n  return true;\n}\n\nfunction getImageNodeInSelection(): ImageNode | null {\n  const selection = $getSelection();\n  if (!$isNodeSelection(selection)) {\n    return null;\n  }\n  const nodes = selection.getNodes();\n  const node = nodes[0];\n  return $isImageNode(node) ? node : null;\n}\n\nfunction getDragImageData(event: DragEvent): null | InsertImagePayload {\n  const dragData = event.dataTransfer?.getData('application/x-lexical-drag');\n  if (!dragData) {\n    return null;\n  }\n  const {type, data} = JSON.parse(dragData);\n  if (type !== 'image') {\n    return null;\n  }\n\n  return data;\n}\n\ndeclare global {\n  interface DragEvent {\n    rangeOffset?: number;\n    rangeParent?: Node;\n  }\n}\n\nfunction canDropImage(event: DragEvent): boolean {\n  const target = event.target;\n  return !!(\n    target &&\n    target instanceof HTMLElement &&\n    !target.closest('code, span.editor-image') &&\n    target.parentElement &&\n    target.parentElement.closest('div.ContentEditable__root')\n  );\n}\n\nfunction getDragSelection(event: DragEvent): Range | null | undefined {\n  let range;\n  const domSelection = getSelection();\n  if (document.caretRangeFromPoint) {\n    range = document.caretRangeFromPoint(event.clientX, event.clientY);\n  } else if (event.rangeParent && domSelection !== null) {\n    domSelection.collapse(event.rangeParent, event.rangeOffset || 0);\n    range = domSelection.getRangeAt(0);\n  } else {\n    throw Error(`Cannot get the selection when dragging`);\n  }\n\n  return range;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {RangeSelection} from 'lexical';\n\nimport {$getListDepth, $isListItemNode, $isListNode} from '@lexical/list';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isElementNode,\n  $isRangeSelection,\n  COMMAND_PRIORITY_CRITICAL,\n  ElementNode,\n  INDENT_CONTENT_COMMAND,\n} from 'lexical';\nimport {useEffect} from 'react';\n\ntype Props = Readonly<{\n  maxDepth: number | null | undefined;\n}>;\n\nfunction getElementNodesInSelection(\n  selection: RangeSelection,\n): Set<ElementNode> {\n  const nodesInSelection = selection.getNodes();\n\n  if (nodesInSelection.length === 0) {\n    return new Set([\n      selection.anchor.getNode().getParentOrThrow(),\n      selection.focus.getNode().getParentOrThrow(),\n    ]);\n  }\n\n  return new Set(\n    nodesInSelection.map((n) => ($isElementNode(n) ? n : n.getParentOrThrow())),\n  );\n}\n\nfunction isIndentPermitted(maxDepth: number): boolean {\n  const selection = $getSelection();\n\n  if (!$isRangeSelection(selection)) {\n    return false;\n  }\n\n  const elementNodesInSelection: Set<ElementNode> =\n    getElementNodesInSelection(selection);\n\n  let totalDepth = 0;\n\n  for (const elementNode of elementNodesInSelection) {\n    if ($isListNode(elementNode)) {\n      totalDepth = Math.max($getListDepth(elementNode) + 1, totalDepth);\n    } else if ($isListItemNode(elementNode)) {\n      const parent = elementNode.getParent();\n\n      if (!$isListNode(parent)) {\n        throw new Error(\n          'ListMaxIndentLevelPlugin: A ListItemNode must have a ListNode for a parent.',\n        );\n      }\n\n      totalDepth = Math.max($getListDepth(parent) + 1, totalDepth);\n    }\n  }\n\n  return totalDepth <= maxDepth;\n}\n\nexport default function ListMaxIndentLevelPlugin({maxDepth}: Props): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    return editor.registerCommand(\n      INDENT_CONTENT_COMMAND,\n      () => !isIndentPermitted(maxDepth ?? 7),\n      COMMAND_PRIORITY_CRITICAL,\n    );\n  }, [editor, maxDepth]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {trimTextContentFromAnchor} from '@lexical/selection';\nimport {$restoreEditorState} from '@lexical/utils';\nimport {$getSelection, $isRangeSelection, EditorState, RootNode} from 'lexical';\nimport {useEffect} from 'react';\n\nexport function MaxLengthPlugin({maxLength}: {maxLength: number}): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    let lastRestoredEditorState: EditorState | null = null;\n\n    return editor.registerNodeTransform(RootNode, (rootNode: RootNode) => {\n      const selection = $getSelection();\n      if (!$isRangeSelection(selection) || !selection.isCollapsed()) {\n        return;\n      }\n      const prevEditorState = editor.getEditorState();\n      const prevTextContent = prevEditorState.read(() =>\n        rootNode.getTextContent(),\n      );\n      const textContent = rootNode.getTextContent();\n      if (prevTextContent !== textContent) {\n        const textLength = textContent.length;\n        const delCount = textLength - maxLength;\n        const anchor = selection.anchor;\n\n        if (delCount > 0) {\n          // Restore the old editor state instead if the last\n          // text content was already at the limit.\n          if (\n            prevTextContent.length === maxLength &&\n            lastRestoredEditorState !== prevEditorState\n          ) {\n            lastRestoredEditorState = prevEditorState;\n            $restoreEditorState(editor, prevEditorState);\n          } else {\n            trimTextContentFromAnchor(editor, anchor, delCount);\n          }\n        }\n      }\n    });\n  }, [editor, maxLength]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './PollNode.css';\n\n// import {useCollaborationContext} from '@lexical/react/LexicalCollaborationPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {useLexicalNodeSelection} from '@lexical/react/useLexicalNodeSelection';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getNodeByKey,\n  $getSelection,\n  $isNodeSelection,\n  CLICK_COMMAND,\n  COMMAND_PRIORITY_LOW,\n  DecoratorNode,\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  GridSelection,\n  KEY_BACKSPACE_COMMAND,\n  KEY_DELETE_COMMAND,\n  LexicalNode,\n  NodeKey,\n  NodeSelection,\n  RangeSelection,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useEffect, useMemo, useRef, useState} from 'react';\n\nimport Button from '../ui/Button';\nimport joinClasses from '../utils/join-classes';\n\ntype Options = ReadonlyArray<Option>;\n\ntype Option = Readonly<{\n  text: string;\n  uid: string;\n  votes: Array<number>;\n}>;\n\nfunction createUID(): string {\n  return Math.random()\n    .toString(36)\n    .replace(/[^a-z]+/g, '')\n    .substr(0, 5);\n}\n\nfunction createPollOption(text = ''): Option {\n  return {\n    text,\n    uid: createUID(),\n    votes: [],\n  };\n}\n\nfunction cloneOption(\n  option: Option,\n  text: string,\n  votes?: Array<number>,\n): Option {\n  return {\n    text,\n    uid: option.uid,\n    votes: votes || Array.from(option.votes),\n  };\n}\n\nfunction getTotalVotes(options: Options): number {\n  return options.reduce((totalVotes, next) => {\n    return totalVotes + next.votes.length;\n  }, 0);\n}\n\nfunction PollOptionComponent({\n  option,\n  index,\n  options,\n  totalVotes,\n  withPollNode,\n}: {\n  index: number;\n  option: Option;\n  options: Options;\n  totalVotes: number;\n  withPollNode: (cb: (pollNode: PollNode) => void) => void;\n}): JSX.Element {\n  // const {clientID} = useCollaborationContext();\n  const checkboxRef = useRef(null);\n  const votesArray = option.votes;\n  // const checkedIndex = votesArray.indexOf(clientID);\n  // const checked = checkedIndex !== -1;\n  const votes = votesArray.length;\n  const text = option.text;\n\n  return (\n    <div className=\"PollNode__optionContainer\">\n      {/* <div\n        className={joinClasses(\n          'PollNode__optionCheckboxWrapper',\n          checked && 'PollNode__optionCheckboxChecked',\n        )}>\n        <input\n          ref={checkboxRef}\n          className=\"PollNode__optionCheckbox\"\n          type=\"checkbox\"\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.toggleVote(option, clientID);\n            });\n          }}\n          checked={checked}\n        />\n      </div> */}\n      <div className=\"PollNode__optionInputWrapper\">\n        <div\n          className=\"PollNode__optionInputVotes\"\n          style={{width: `${votes === 0 ? 0 : (votes / totalVotes) * 100}%`}}\n        />\n        <span className=\"PollNode__optionInputVotesCount\">\n          {votes > 0 && (votes === 1 ? '1 vote' : `${votes} votes`)}\n        </span>\n        <input\n          className=\"PollNode__optionInput\"\n          type=\"text\"\n          value={text}\n          onChange={(e) => {\n            withPollNode((node) => {\n              node.setOptionText(option, e.target.value);\n            });\n          }}\n          placeholder={`Option ${index + 1}`}\n        />\n      </div>\n      <button\n        disabled={options.length < 3}\n        className={joinClasses(\n          'PollNode__optionDelete',\n          options.length < 3 && 'PollNode__optionDeleteDisabled',\n        )}\n        arial-label=\"Remove\"\n        onClick={() => {\n          withPollNode((node) => {\n            node.deleteOption(option);\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nfunction PollComponent({\n  question,\n  options,\n  nodeKey,\n}: {\n  nodeKey: NodeKey;\n  options: Options;\n  question: string;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const totalVotes = useMemo(() => getTotalVotes(options), [options]);\n  const [isSelected, setSelected, clearSelection] =\n    useLexicalNodeSelection(nodeKey);\n  const [selection, setSelection] = useState<\n    RangeSelection | NodeSelection | GridSelection | null\n  >(null);\n  const ref = useRef(null);\n\n  const onDelete = useCallback(\n    (payload: KeyboardEvent) => {\n      if (isSelected && $isNodeSelection($getSelection())) {\n        const event: KeyboardEvent = payload;\n        event.preventDefault();\n        const node = $getNodeByKey(nodeKey);\n        if ($isPollNode(node)) {\n          node.remove();\n        }\n        setSelected(false);\n      }\n      return false;\n    },\n    [isSelected, nodeKey, setSelected],\n  );\n\n  useEffect(() => {\n    return mergeRegister(\n      // editor.registerUpdateListener(({editorState}) => {\n      //   setSelection(editorState.read(() => $getSelection()));\n      // }),\n      editor.registerCommand<MouseEvent>(\n        CLICK_COMMAND,\n        (payload) => {\n          const event = payload;\n\n          if (event.target === ref.current) {\n            if (!event.shiftKey) {\n              clearSelection();\n            }\n            setSelected(!isSelected);\n            return true;\n          }\n\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_DELETE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n      editor.registerCommand(\n        KEY_BACKSPACE_COMMAND,\n        onDelete,\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [clearSelection, editor, isSelected, nodeKey, onDelete, setSelected]);\n\n  const withPollNode = (cb: (node: PollNode) => void): void => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isPollNode(node)) {\n        cb(node);\n      }\n    });\n  };\n\n  const addOption = () => {\n    withPollNode((node) => {\n      node.addOption(createPollOption());\n    });\n  };\n\n  const isFocused = $isNodeSelection(selection) && isSelected;\n\n  return (\n    <div\n      className={`PollNode__container ${isFocused ? 'focused' : ''}`}\n      ref={ref}>\n      <div className=\"PollNode__inner\">\n        <h2 className=\"PollNode__heading\">{question}</h2>\n        {options.map((option, index) => {\n          const key = option.uid;\n          return (\n            <PollOptionComponent\n              key={key}\n              withPollNode={withPollNode}\n              option={option}\n              index={index}\n              options={options}\n              totalVotes={totalVotes}\n            />\n          );\n        })}\n        <div className=\"PollNode__footer\">\n          <Button onClick={addOption} small={true}>\n            Add Option\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport type SerializedPollNode = Spread<\n  {\n    question: string;\n    options: Options;\n    type: 'poll';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nfunction convertPollElement(domNode: HTMLElement): DOMConversionOutput | null {\n  const question = domNode.getAttribute('data-lexical-poll-question');\n  if (question !== null) {\n    const node = $createPollNode(question);\n    return {node};\n  }\n  return null;\n}\n\nexport class PollNode extends DecoratorNode<JSX.Element> {\n  __question: string;\n  __options: Options;\n\n  static getType(): string {\n    return 'poll';\n  }\n\n  static clone(node: PollNode): PollNode {\n    return new PollNode(node.__question, node.__options, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedPollNode): PollNode {\n    const node = $createPollNode(serializedNode.question);\n    serializedNode.options.forEach(node.addOption);\n    return node;\n  }\n\n  constructor(question: string, options?: Options, key?: NodeKey) {\n    super(key);\n    this.__question = question;\n    this.__options = options || [createPollOption(), createPollOption()];\n  }\n\n  exportJSON(): SerializedPollNode {\n    return {\n      options: this.__options,\n      question: this.__question,\n      type: 'poll',\n      version: 1,\n    };\n  }\n\n  addOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    options.push(option);\n    self.__options = options;\n  }\n\n  deleteOption(option: Option): void {\n    const self = this.getWritable();\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options.splice(index, 1);\n    self.__options = options;\n  }\n\n  setOptionText(option: Option, text: string): void {\n    const self = this.getWritable();\n    const clonedOption = cloneOption(option, text);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  toggleVote(option: Option, clientID: number): void {\n    const self = this.getWritable();\n    const votes = option.votes;\n    const votesClone = Array.from(votes);\n    const voteIndex = votes.indexOf(clientID);\n    if (voteIndex === -1) {\n      votesClone.push(clientID);\n    } else {\n      votesClone.splice(voteIndex, 1);\n    }\n    const clonedOption = cloneOption(option, option.text, votesClone);\n    const options = Array.from(self.__options);\n    const index = options.indexOf(option);\n    options[index] = clonedOption;\n    self.__options = options;\n  }\n\n  static importDOM(): DOMConversionMap | null {\n    return {\n      span: (domNode: HTMLElement) => {\n        if (!domNode.hasAttribute('data-lexical-poll-question')) {\n          return null;\n        }\n        return {\n          conversion: convertPollElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('span');\n    element.setAttribute('data-lexical-poll-question', this.__question);\n    return {element};\n  }\n\n  createDOM(): HTMLElement {\n    const elem = document.createElement('span');\n    elem.style.display = 'inline-block';\n    return elem;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(): JSX.Element {\n    return (\n      <PollComponent\n        question={this.__question}\n        options={this.__options}\n        nodeKey={this.__key}\n      />\n    );\n  }\n}\n\nexport function $createPollNode(question: string): PollNode {\n  return new PollNode(question);\n}\n\nexport function $isPollNode(\n  node: LexicalNode | null | undefined,\n): node is PollNode {\n  return node instanceof PollNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalCommand} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isRootNode,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createPollNode, PollNode} from '../nodes/PollNode';\n\nexport const INSERT_POLL_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function PollPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  useEffect(() => {\n    if (!editor.hasNodes([PollNode])) {\n      throw new Error('PollPlugin: PollNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_POLL_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          const question = payload;\n          const pollNode = $createPollNode(question);\n\n          if ($isRootNode(selection.anchor.getNode())) {\n            selection.insertParagraph();\n          }\n\n          selection.insertNodes([pollNode]);\n        }\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useCallback, useEffect, useRef} from 'react';\n\nconst getElement = (): HTMLElement => {\n  let element = document.getElementById('report-container');\n\n  if (element === null) {\n    element = document.createElement('div');\n    element.id = 'report-container';\n    element.style.position = 'fixed';\n    element.style.top = '50%';\n    element.style.left = '50%';\n    element.style.fontSize = '32px';\n    element.style.transform = 'translate(-50%, -50px)';\n    element.style.padding = '20px';\n    element.style.background = 'rgba(240, 240, 240, 0.4)';\n    element.style.borderRadius = '20px';\n\n    if (document.body) {\n      document.body.appendChild(element);\n    }\n  }\n\n  return element;\n};\n\nexport default function useReport(): (arg0: string) => NodeJS.Timeout {\n  const timer = useRef<NodeJS.Timeout | null>(null);\n  const cleanup = useCallback(() => {\n    if (timer !== null) {\n      clearTimeout(timer.current as NodeJS.Timeout);\n    }\n\n    if (document.body) {\n      document.body.removeChild(getElement());\n    }\n  }, []);\n\n  useEffect(() => {\n    return cleanup;\n  }, [cleanup]);\n\n  return useCallback(\n    (content) => {\n      // eslint-disable-next-line no-console\n      console.log(content);\n      const element = getElement();\n      clearTimeout(timer.current as NodeJS.Timeout);\n      element.innerHTML = content;\n      timer.current = setTimeout(cleanup, 1000);\n      return timer.current;\n    },\n    [cleanup],\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {LexicalCommand, LexicalEditor, RangeSelection} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  REDO_COMMAND,\n  UNDO_COMMAND,\n} from 'lexical';\nimport {useEffect, useRef, useState} from 'react';\n\nimport useReport from '../hooks/useReport';\n\nexport const SPEECH_TO_TEXT_COMMAND: LexicalCommand<boolean> = createCommand();\n\nconst VOICE_COMMANDS: Readonly<\n  Record<\n    string,\n    (arg0: {editor: LexicalEditor; selection: RangeSelection}) => void\n  >\n> = {\n  '\\n': ({selection}) => {\n    selection.insertParagraph();\n  },\n  redo: ({editor}) => {\n    editor.dispatchCommand(REDO_COMMAND, undefined);\n  },\n  undo: ({editor}) => {\n    editor.dispatchCommand(UNDO_COMMAND, undefined);\n  },\n};\n\nexport const SUPPORT_SPEECH_RECOGNITION: boolean =\n  'SpeechRecognition' in window || 'webkitSpeechRecognition' in window;\n\nfunction SpeechToTextPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n  const [isEnabled, setIsEnabled] = useState<boolean>(false);\n  const SpeechRecognition =\n    // @ts-ignore\n    window.SpeechRecognition || window.webkitSpeechRecognition;\n  const recognition = useRef<typeof SpeechRecognition | null>(null);\n  const report = useReport();\n\n  useEffect(() => {\n    if (isEnabled && recognition.current === null) {\n      recognition.current = new SpeechRecognition();\n      recognition.current.continuous = true;\n      recognition.current.interimResults = true;\n      recognition.current.addEventListener(\n        'result',\n        (event: typeof SpeechRecognition) => {\n          const resultItem = event.results.item(event.resultIndex);\n          const {transcript} = resultItem.item(0);\n          report(transcript);\n\n          if (!resultItem.isFinal) {\n            return;\n          }\n\n          editor.update(() => {\n            const selection = $getSelection();\n\n            if ($isRangeSelection(selection)) {\n              const command = VOICE_COMMANDS[transcript.toLowerCase().trim()];\n\n              if (command) {\n                command({\n                  editor,\n                  selection,\n                });\n              } else if (transcript.match(/\\s*\\n\\s*/)) {\n                selection.insertParagraph();\n              } else {\n                selection.insertText(transcript);\n              }\n            }\n          });\n        },\n      );\n    }\n\n    if (recognition.current) {\n      if (isEnabled) {\n        recognition.current.start();\n      } else {\n        recognition.current.stop();\n      }\n    }\n\n    return () => {\n      if (recognition.current !== null) {\n        recognition.current.stop();\n      }\n    };\n  }, [SpeechRecognition, editor, isEnabled, report]);\n  useEffect(() => {\n    return editor.registerCommand(\n      SPEECH_TO_TEXT_COMMAND,\n      (_isEnabled: boolean) => {\n        setIsEnabled(_isEnabled);\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n\nexport default (SUPPORT_SPEECH_RECOGNITION\n  ? SpeechToTextPlugin\n  : () => null) as () => null;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $setSelection,\n  FOCUS_COMMAND,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nconst COMMAND_PRIORITY_LOW = 1;\nconst TAB_TO_FOCUS_INTERVAL = 100;\n\nlet lastTabKeyDownTimestamp = 0;\nlet hasRegisteredKeyDownListener = false;\n\nfunction registerKeyTimeStampTracker() {\n  window.addEventListener(\n    'keydown',\n    (event: KeyboardEvent) => {\n      // Tab\n      if (event.keyCode === 9) {\n        lastTabKeyDownTimestamp = event.timeStamp;\n      }\n    },\n    true,\n  );\n}\n\nexport default function TabFocusPlugin(): null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!hasRegisteredKeyDownListener) {\n      registerKeyTimeStampTracker();\n      hasRegisteredKeyDownListener = true;\n    }\n\n    return editor.registerCommand(\n      FOCUS_COMMAND,\n      (event: FocusEvent) => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          if (\n            lastTabKeyDownTimestamp + TAB_TO_FOCUS_INTERVAL >\n            event.timeStamp\n          ) {\n            $setSelection(selection.clone());\n          }\n        }\n        return false;\n      },\n      COMMAND_PRIORITY_LOW,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport type {Cell} from '@lexical/table';\nimport type {LexicalEditor} from 'lexical';\n\n// import './TableCellResizer.css';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $getTableColumnIndexFromTableCellNode,\n  $getTableNodeFromLexicalNodeOrThrow,\n  $getTableRowIndexFromTableCellNode,\n  $isTableCellNode,\n  $isTableRowNode,\n  getCellFromTarget,\n} from '@lexical/table';\nimport {\n  $getNearestNodeFromDOMNode,\n  $getSelection,\n  // $isGridSelection,\n  COMMAND_PRIORITY_HIGH,\n  SELECTION_CHANGE_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {\n  MouseEventHandler,\n  ReactPortal,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {createPortal} from 'react-dom';\n\ntype MousePosition = {\n  x: number;\n  y: number;\n};\n\ntype MouseDraggingDirection = 'right' | 'bottom';\n\nconst MIN_ROW_HEIGHT = 33;\nconst MIN_COLUMN_WIDTH = 50;\n\nfunction TableCellResizer({editor}: {editor: LexicalEditor}): JSX.Element {\n  const targetRef = useRef<HTMLElement | null>(null);\n  const resizerRef = useRef<HTMLDivElement | null>(null);\n  const tableRectRef = useRef<ClientRect | null>(null);\n\n  const mouseStartPosRef = useRef<MousePosition | null>(null);\n  const [mouseCurrentPos, updateMouseCurrentPos] =\n    useState<MousePosition | null>(null);\n\n  const [activeCell, updateActiveCell] = useState<Cell | null>(null);\n  const [isSelectingGrid, updateIsSelectingGrid] = useState<boolean>(false);\n  const [draggingDirection, updateDraggingDirection] =\n    useState<MouseDraggingDirection | null>(null);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        // const isGridSelection = $isGridSelection(selection);\n\n        // if (isSelectingGrid !== isGridSelection) {\n        //   updateIsSelectingGrid(isGridSelection);\n        // }\n\n        return false;\n      },\n      COMMAND_PRIORITY_HIGH,\n    );\n  });\n\n  const resetState = useCallback(() => {\n    updateActiveCell(null);\n    targetRef.current = null;\n    updateDraggingDirection(null);\n    mouseStartPosRef.current = null;\n    tableRectRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const onMouseMove = (event: MouseEvent) => {\n      setTimeout(() => {\n        const target = event.target;\n\n        if (draggingDirection) {\n          updateMouseCurrentPos({\n            x: event.clientX,\n            y: event.clientY,\n          });\n          return;\n        }\n\n        if (resizerRef.current && resizerRef.current.contains(target as Node)) {\n          return;\n        }\n\n        if (targetRef.current !== target) {\n          targetRef.current = target as HTMLElement;\n          const cell = getCellFromTarget(target as HTMLElement);\n\n          if (cell && activeCell !== cell) {\n            editor.update(() => {\n              const tableCellNode = $getNearestNodeFromDOMNode(cell.elem);\n              if (!tableCellNode) {\n                throw new Error('TableCellResizer: Table cell node not found.');\n              }\n\n              const tableNode =\n                $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n              const tableElement = editor.getElementByKey(tableNode.getKey());\n\n              if (!tableElement) {\n                throw new Error('TableCellResizer: Table element not found.');\n              }\n\n              targetRef.current = target as HTMLElement;\n              tableRectRef.current = tableElement.getBoundingClientRect();\n              updateActiveCell(cell);\n            });\n          } else if (cell == null) {\n            resetState();\n          }\n        }\n      }, 0);\n    };\n\n    document.addEventListener('mousemove', onMouseMove);\n\n    return () => {\n      document.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [activeCell, draggingDirection, editor, resetState]);\n\n  const isHeightChanging = (direction: MouseDraggingDirection) => {\n    if (direction === 'bottom') return true;\n    return false;\n  };\n\n  const updateRowHeight = useCallback(\n    (newHeight: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableRowIndex = $getTableRowIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        if (tableRowIndex >= tableRows.length || tableRowIndex < 0) {\n          throw new Error('Expected table cell to be inside of table row.');\n        }\n\n        const tableRow = tableRows[tableRowIndex];\n\n        if (!$isTableRowNode(tableRow)) {\n          throw new Error('Expected table row');\n        }\n\n        tableRow.setHeight(newHeight);\n      });\n    },\n    [activeCell, editor],\n  );\n\n  const updateColumnWidth = useCallback(\n    (newWidth: number) => {\n      if (!activeCell) {\n        throw new Error('TableCellResizer: Expected active cell.');\n      }\n      editor.update(() => {\n        const tableCellNode = $getNearestNodeFromDOMNode(activeCell.elem);\n        if (!$isTableCellNode(tableCellNode)) {\n          throw new Error('TableCellResizer: Table cell node not found.');\n        }\n\n        const tableNode = $getTableNodeFromLexicalNodeOrThrow(tableCellNode);\n\n        const tableColumnIndex =\n          $getTableColumnIndexFromTableCellNode(tableCellNode);\n\n        const tableRows = tableNode.getChildren();\n\n        for (let r = 0; r < tableRows.length; r++) {\n          const tableRow = tableRows[r];\n\n          if (!$isTableRowNode(tableRow)) {\n            throw new Error('Expected table row');\n          }\n\n          const tableCells = tableRow.getChildren();\n\n          if (tableColumnIndex >= tableCells.length || tableColumnIndex < 0) {\n            throw new Error('Expected table cell to be inside of table row.');\n          }\n\n          const tableCell = tableCells[tableColumnIndex];\n\n          if (!$isTableCellNode(tableCell)) {\n            throw new Error('Expected table cell');\n          }\n\n          tableCell.setWidth(newWidth);\n        }\n      });\n    },\n    [activeCell, editor],\n  );\n\n  const toggleResize = useCallback(\n    (direction: MouseDraggingDirection): MouseEventHandler<HTMLDivElement> =>\n      (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        if (!activeCell) {\n          throw new Error('TableCellResizer: Expected active cell.');\n        }\n\n        if (draggingDirection === direction && mouseStartPosRef.current) {\n          const {x, y} = mouseStartPosRef.current;\n\n          if (activeCell === null) {\n            return;\n          }\n\n          const {height, width} = activeCell.elem.getBoundingClientRect();\n\n          if (isHeightChanging(direction)) {\n            const heightChange = Math.abs(event.clientY - y);\n\n            const isShrinking = direction === 'bottom' && y > event.clientY;\n\n            updateRowHeight(\n              Math.max(\n                isShrinking ? height - heightChange : heightChange + height,\n                MIN_ROW_HEIGHT,\n              ),\n            );\n          } else {\n            const widthChange = Math.abs(event.clientX - x);\n\n            const isShrinking = direction === 'right' && x > event.clientX;\n\n            updateColumnWidth(\n              Math.max(\n                isShrinking ? width - widthChange : widthChange + width,\n                MIN_COLUMN_WIDTH,\n              ),\n            );\n          }\n\n          resetState();\n        } else {\n          mouseStartPosRef.current = {\n            x: event.clientX,\n            y: event.clientY,\n          };\n          updateMouseCurrentPos(mouseStartPosRef.current);\n          updateDraggingDirection(direction);\n        }\n      },\n    [\n      activeCell,\n      draggingDirection,\n      resetState,\n      updateColumnWidth,\n      updateRowHeight,\n    ],\n  );\n\n  const getResizers = useCallback(() => {\n    if (activeCell) {\n      const {height, width, top, left} =\n        activeCell.elem.getBoundingClientRect();\n\n      const styles = {\n        bottom: {\n          backgroundColor: 'none',\n          cursor: 'row-resize',\n          height: '10px',\n          left: `${window.pageXOffset + left}px`,\n          top: `${window.pageYOffset + top + height}px`,\n          width: `${width}px`,\n        },\n        right: {\n          backgroundColor: 'none',\n          cursor: 'col-resize',\n          height: `${height}px`,\n          left: `${window.pageXOffset + left + width}px`,\n          top: `${window.pageYOffset + top}px`,\n          width: '10px',\n        },\n      };\n\n      const tableRect = tableRectRef.current;\n\n      if (draggingDirection && mouseCurrentPos && tableRect) {\n        if (isHeightChanging(draggingDirection)) {\n          styles[draggingDirection].left = `${\n            window.pageXOffset + tableRect.left\n          }px`;\n          styles[draggingDirection].top = `${\n            window.pageYOffset + mouseCurrentPos.y\n          }px`;\n          styles[draggingDirection].height = '3px';\n          styles[draggingDirection].width = `${tableRect.width}px`;\n        } else {\n          styles[draggingDirection].top = `${\n            window.pageYOffset + tableRect.top\n          }px`;\n          styles[draggingDirection].left = `${\n            window.pageXOffset + mouseCurrentPos.x\n          }px`;\n          styles[draggingDirection].width = '3px';\n          styles[draggingDirection].height = `${tableRect.height}px`;\n        }\n\n        styles[draggingDirection].backgroundColor = '#adf';\n      }\n\n      return styles;\n    }\n\n    return {\n      bottom: null,\n      left: null,\n      right: null,\n      top: null,\n    };\n  }, [activeCell, draggingDirection, mouseCurrentPos]);\n\n  const resizerStyles = getResizers();\n\n  return (\n    <div ref={resizerRef}>\n      {activeCell != null && !isSelectingGrid && (\n        <>\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.right || undefined}\n            onMouseDown={toggleResize('right')}\n            onMouseUp={toggleResize('right')}\n          />\n          <div\n            className=\"TableCellResizer__resizer TableCellResizer__ui\"\n            style={resizerStyles.bottom || undefined}\n            onMouseDown={toggleResize('bottom')}\n            onMouseUp={toggleResize('bottom')}\n          />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default function TableCellResizerPlugin(): ReactPortal {\n  const [editor] = useLexicalComposerContext();\n\n  return useMemo(\n    () => createPortal(<TableCellResizer editor={editor} />, document.body),\n    [editor],\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {$isCodeHighlightNode} from '@lexical/code';\nimport {$isLinkNode, TOGGLE_LINK_COMMAND} from '@lexical/link';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {$isAtNodeEnd} from '@lexical/selection';\nimport {mergeRegister} from '@lexical/utils';\nimport {\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_TEXT_COMMAND,\n  LexicalEditor,\n  RangeSelection,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n} from 'lexical';\nimport {useCallback, useEffect, useRef, useState} from 'react';\nimport * as React from 'react';\nimport {createPortal} from 'react-dom';\n\n// import {INSERT_INLINE_COMMAND} from './CommentPlugin';\n\nfunction setPopupPosition(\n  editor: HTMLElement,\n  rect: ClientRect,\n  rootElementRect: ClientRect,\n): void {\n  let top = rect.top - 8 + window.pageYOffset;\n  let left =\n    rect.left + 340 + window.pageXOffset - editor.offsetWidth + rect.width;\n  if (left + editor.offsetWidth > rootElementRect.right) {\n    left = rect.right - editor.offsetWidth;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (left < 0) {\n    left = rect.left;\n    top = rect.bottom + 20;\n  }\n  if (rect.width >= rootElementRect.width - 25) {\n    left = rect.left;\n    top = rect.top - 50 + window.pageYOffset;\n  }\n  if (top < rootElementRect.top) {\n    top = rect.bottom + 20;\n  }\n  editor.style.opacity = '1';\n  editor.style.top = `${top}px`;\n  editor.style.left = `${left}px`;\n}\n\nfunction TextFormatFloatingToolbar({\n  editor,\n  isLink,\n  isBold,\n  isItalic,\n  isUnderline,\n  isCode,\n  isStrikethrough,\n  isSubscript,\n  isSuperscript,\n}: {\n  editor: LexicalEditor;\n  isBold: boolean;\n  isCode: boolean;\n  isItalic: boolean;\n  isLink: boolean;\n  isStrikethrough: boolean;\n  isSubscript: boolean;\n  isSuperscript: boolean;\n  isUnderline: boolean;\n}): JSX.Element {\n  const popupCharStylesEditorRef = useRef<HTMLDivElement | null>(null);\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  // const insertComment = () => {\n  //   editor.dispatchCommand(INSERT_INLINE_COMMAND, null);\n  // };\n\n  const updateTextFormatFloatingToolbar = useCallback(() => {\n    const selection = $getSelection();\n\n    const popupCharStylesEditorElem = popupCharStylesEditorRef.current;\n    const nativeSelection = window.getSelection();\n\n    if (popupCharStylesEditorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      const rootElementRect = rootElement.getBoundingClientRect();\n      let rect;\n\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      setPopupPosition(popupCharStylesEditorElem, rect, rootElementRect);\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateTextFormatFloatingToolbar();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateTextFormatFloatingToolbar]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateTextFormatFloatingToolbar();\n    });\n    return mergeRegister(\n      editor.registerUpdateListener(({editorState}) => {\n        editorState.read(() => {\n          updateTextFormatFloatingToolbar();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateTextFormatFloatingToolbar();\n          return false;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [editor, updateTextFormatFloatingToolbar]);\n\n  return (\n    <div ref={popupCharStylesEditorRef} className=\"floating-text-format-popup\">\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n        }}\n        className={'popup-item spaced ' + (isBold ? 'active' : '')}\n        aria-label=\"Format text as bold\">\n        <i className=\"format bold\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n        }}\n        className={'popup-item spaced ' + (isItalic ? 'active' : '')}\n        aria-label=\"Format text as italics\">\n        <i className=\"format italic\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n        }}\n        className={'popup-item spaced ' + (isUnderline ? 'active' : '')}\n        aria-label=\"Format text to underlined\">\n        <i className=\"format underline\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'strikethrough');\n        }}\n        className={'popup-item spaced ' + (isStrikethrough ? 'active' : '')}\n        aria-label=\"Format text with a strikethrough\">\n        <i className=\"format strikethrough\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n        }}\n        className={'popup-item spaced ' + (isSubscript ? 'active' : '')}\n        title=\"Subscript\"\n        aria-label=\"Format Subscript\">\n        <i className=\"format subscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'superscript');\n        }}\n        className={'popup-item spaced ' + (isSuperscript ? 'active' : '')}\n        title=\"Superscript\"\n        aria-label=\"Format Superscript\">\n        <i className=\"format superscript\" />\n      </button>\n      <button\n        onClick={() => {\n          editor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n        }}\n        className={'popup-item spaced ' + (isCode ? 'active' : '')}\n        aria-label=\"Insert code block\">\n        <i className=\"format code\" />\n      </button>\n      <button\n        onClick={insertLink}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label=\"Insert link\">\n        <i className=\"format link\" />\n      </button>\n      {/* <button\n        onClick={insertComment}\n        className={'popup-item spaced ' + (isLink ? 'active' : '')}\n        aria-label=\"Insert link\">\n        <i className=\"format add-comment\" />\n      </button> */}\n    </div>\n  );\n}\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction useTextFormatFloatingToolbar(\n  editor: LexicalEditor,\n): JSX.Element | null {\n  const [isText, setIsText] = useState(false);\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n\n  const updatePopup = useCallback(() => {\n    editor.getEditorState().read(() => {\n      // Should not to pop up the floating toolbar when using IME input\n      if (editor.isComposing()) {\n        return;\n      }\n      const selection = $getSelection();\n      const nativeSelection = window.getSelection();\n      const rootElement = editor.getRootElement();\n\n      if (\n        nativeSelection !== null &&\n        (!$isRangeSelection(selection) ||\n          rootElement === null ||\n          !rootElement.contains(nativeSelection.anchorNode))\n      ) {\n        setIsText(false);\n        return;\n      }\n\n      if (!$isRangeSelection(selection)) {\n        return;\n      }\n\n      const node = getSelectedNode(selection);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n\n      // Update links\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (\n        !$isCodeHighlightNode(selection.anchor.getNode()) &&\n        selection.getTextContent() !== ''\n      ) {\n        setIsText($isTextNode(node));\n      } else {\n        setIsText(false);\n      }\n    });\n  }, [editor]);\n\n  useEffect(() => {\n    document.addEventListener('selectionchange', updatePopup);\n    return () => {\n      document.removeEventListener('selectionchange', updatePopup);\n    };\n  }, [updatePopup]);\n\n  useEffect(() => {\n    return editor.registerUpdateListener(() => {\n      updatePopup();\n    });\n  }, [editor, updatePopup]);\n\n  if (!isText || isLink) {\n    return null;\n  }\n\n  return createPortal(\n    <TextFormatFloatingToolbar\n      editor={editor}\n      isLink={isLink}\n      isBold={isBold}\n      isItalic={isItalic}\n      isStrikethrough={isStrikethrough}\n      isSubscript={isSubscript}\n      isSuperscript={isSuperscript}\n      isUnderline={isUnderline}\n      isCode={isCode}\n    />,\n    document.body,\n  );\n}\n\nexport default function TextFormatFloatingToolbarPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n  return useTextFormatFloatingToolbar(editor);\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nexport const CAN_USE_DOM: boolean =\n  typeof window !== 'undefined' &&\n  typeof window.document !== 'undefined' &&\n  typeof window.document.createElement !== 'undefined';\n\nconst documentMode =\n  // @ts-ignore\n  CAN_USE_DOM && 'documentMode' in document ? document.documentMode : null;\n\nexport const IS_APPLE: boolean =\n  CAN_USE_DOM && /Mac|iPod|iPhone|iPad/.test(navigator.platform);\n\nexport const IS_FIREFOX: boolean =\n  CAN_USE_DOM && /^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent);\n\nexport const CAN_USE_BEFORE_INPUT: boolean =\n  CAN_USE_DOM && 'InputEvent' in window && !documentMode\n    ? 'getTargetRanges' in new window.InputEvent('input')\n    : false;\n\nexport const IS_SAFARI: boolean =\n  CAN_USE_DOM && /Version\\/[\\d.]+.*Safari/.test(navigator.userAgent);\n\nexport const IS_IOS: boolean =\n  CAN_USE_DOM &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent) &&\n  // @ts-ignore\n  !window.MSStream;\n\n// Keep these in case we need to use them in the future.\n// export const IS_WINDOWS: boolean = CAN_USE_DOM && /Win/.test(navigator.platform);\n// export const IS_CHROME: boolean = CAN_USE_DOM && /^(?=.*Chrome).*/i.test(navigator.userAgent);\n// export const canUseTextInputEvent: boolean = CAN_USE_DOM && 'TextEvent' in window && !documentMode;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  SerializedLexicalNode,\n  Spread,\n} from 'lexical';\n\n// import './StickyNode.css';\n\nimport {\n  CollaborationPlugin,\n} from '@lexical/react/LexicalCollaborationPlugin';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {HistoryPlugin} from '@lexical/react/LexicalHistoryPlugin';\nimport {LexicalNestedComposer} from '@lexical/react/LexicalNestedComposer';\nimport {PlainTextPlugin} from '@lexical/react/LexicalPlainTextPlugin';\nimport {\n  $getNodeByKey,\n  $setSelection,\n  createEditor,\n  DecoratorNode,\n} from 'lexical';\nimport * as React from 'react';\nimport {useEffect, useRef} from 'react';\nimport {createPortal} from 'react-dom';\nimport useLayoutEffect from '../shared/src/getDOMSelection';\n\nimport {createWebsocketProvider} from '../collaboration';\nimport {useSharedHistoryContext} from '../context/SharedHistoryContext';\nimport StickyEditorTheme from '../themes/StickyEditorTheme';\nimport ContentEditable from '../ui/ContentEditable';\nimport Placeholder from '../ui/Placeholder';\n\ntype Positioning = {\n  isDragging: boolean;\n  offsetX: number;\n  offsetY: number;\n  rootElementRect: null | ClientRect;\n  x: number;\n  y: number;\n};\n\nfunction positionSticky(\n  stickyElem: HTMLElement,\n  positioning: Positioning,\n): void {\n  const style = stickyElem.style;\n  const rootElementRect = positioning.rootElementRect;\n  const rectLeft = rootElementRect !== null ? rootElementRect.left : 0;\n  const rectTop = rootElementRect !== null ? rootElementRect.top : 0;\n  style.top = rectTop + positioning.y + 'px';\n  style.left = rectLeft + positioning.x + 'px';\n}\n\nfunction StickyComponent({\n  x,\n  y,\n  nodeKey,\n  color,\n  caption,\n}: {\n  caption: LexicalEditor;\n  color: 'pink' | 'yellow';\n  nodeKey: NodeKey;\n  x: number;\n  y: number;\n}): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const stickyContainerRef = useRef<null | HTMLDivElement>(null);\n  const positioningRef = useRef<Positioning>({\n    isDragging: false,\n    offsetX: 0,\n    offsetY: 0,\n    rootElementRect: null,\n    x: 0,\n    y: 0,\n  });\n  // const {yjsDocMap} = useCollaborationContext();\n  // const isCollab = yjsDocMap.get('main') !== undefined;\n\n  useEffect(() => {\n    const position = positioningRef.current;\n    position.x = x;\n    position.y = y;\n\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      positionSticky(stickyContainer, position);\n    }\n  }, [x, y]);\n\n  // useLayoutEffect(() => {\n  //   const position = positioningRef.current;\n  //   const resizeObserver = new ResizeObserver((entries) => {\n  //     for (let i = 0; i < entries.length; i++) {\n  //       const entry = entries[i];\n  //       const {target} = entry;\n  //       position.rootElementRect = target.getBoundingClientRect();\n  //       const stickyContainer = stickyContainerRef.current;\n  //       if (stickyContainer !== null) {\n  //         positionSticky(stickyContainer, position);\n  //       }\n  //     }\n  //   });\n\n    // const removeRootListener = editor.registerRootListener(\n    //   (nextRootElem, prevRootElem) => {\n    //     if (prevRootElem !== null) {\n    //       resizeObserver.unobserve(prevRootElem);\n    //     }\n    //     if (nextRootElem !== null) {\n    //       resizeObserver.observe(nextRootElem);\n    //     }\n    //   },\n    // );\n\n    // const handleWindowResize = () => {\n    //   const rootElement = editor.getRootElement();\n    //   const stickyContainer = stickyContainerRef.current;\n    //   if (rootElement !== null && stickyContainer !== null) {\n    //     position.rootElementRect = rootElement.getBoundingClientRect();\n    //     positionSticky(stickyContainer, position);\n    //   }\n    // };\n\n    // window.addEventListener('resize', handleWindowResize);\n\n  //   return () => {\n  //     window.removeEventListener('resize', handleWindowResize);\n  //     removeRootListener();\n  //   };\n  // }, [editor]);\n\n  useEffect(() => {\n    const stickyContainer = stickyContainerRef.current;\n    if (stickyContainer !== null) {\n      // Delay adding transition so we don't trigger the\n      // transition on load of the sticky.\n      setTimeout(() => {\n        stickyContainer.style.setProperty(\n          'transition',\n          'top 0.3s ease 0s, left 0.3s ease 0s',\n        );\n      }, 500);\n    }\n  }, []);\n\n  const handlePointerMove = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    const rootElementRect = positioning.rootElementRect;\n    if (\n      stickyContainer !== null &&\n      positioning.isDragging &&\n      rootElementRect !== null\n    ) {\n      positioning.x = event.pageX - positioning.offsetX - rootElementRect.left;\n      positioning.y = event.pageY - positioning.offsetY - rootElementRect.top;\n      positionSticky(stickyContainer, positioning);\n    }\n  };\n\n  const handlePointerUp = (event: PointerEvent) => {\n    const stickyContainer = stickyContainerRef.current;\n    const positioning = positioningRef.current;\n    if (stickyContainer !== null) {\n      positioning.isDragging = false;\n      stickyContainer.classList.remove('dragging');\n      editor.update(() => {\n        const node = $getNodeByKey(nodeKey);\n        if ($isStickyNode(node)) {\n          node.setPosition(positioning.x, positioning.y);\n        }\n      });\n    }\n    document.removeEventListener('pointermove', handlePointerMove);\n    document.removeEventListener('pointerup', handlePointerUp);\n  };\n\n  const handleDelete = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.remove();\n      }\n    });\n  };\n\n  const handleColorChange = () => {\n    editor.update(() => {\n      const node = $getNodeByKey(nodeKey);\n      if ($isStickyNode(node)) {\n        node.toggleColor();\n      }\n    });\n  };\n\n  const {historyState} = useSharedHistoryContext();\n\n  return (\n    <div ref={stickyContainerRef} className=\"sticky-note-container\">\n      <div\n        className={`sticky-note ${color}`}\n        onPointerDown={(event) => {\n          const stickyContainer = stickyContainerRef.current;\n          if (\n            stickyContainer == null ||\n            event.button === 2 ||\n            event.target !== stickyContainer.firstChild\n          ) {\n            // Right click or click on editor should not work\n            return;\n          }\n          const stickContainer = stickyContainer;\n          const positioning = positioningRef.current;\n          if (stickContainer !== null) {\n            const {top, left} = stickContainer.getBoundingClientRect();\n            positioning.offsetX = event.clientX - left;\n            positioning.offsetY = event.clientY - top;\n            positioning.isDragging = true;\n            stickContainer.classList.add('dragging');\n            document.addEventListener('pointermove', handlePointerMove);\n            document.addEventListener('pointerup', handlePointerUp);\n            event.preventDefault();\n          }\n        }}>\n        <button\n          onClick={handleDelete}\n          className=\"delete\"\n          aria-label=\"Delete sticky note\"\n          title=\"Delete\">\n          X\n        </button>\n        <button\n          onClick={handleColorChange}\n          className=\"color\"\n          aria-label=\"Change sticky note color\"\n          title=\"Color\">\n          <i className=\"bucket\" />\n        </button>\n        {/* <LexicalNestedComposer\n          initialEditor={caption}\n          initialTheme={StickyEditorTheme}>\n          {isCollab ? (\n            <CollaborationPlugin\n              id={caption.getKey()}\n              providerFactory={createWebsocketProvider}\n              shouldBootstrap={true}\n            />\n          ) : (\n            <HistoryPlugin externalHistoryState={historyState} />\n          )}\n          <PlainTextPlugin\n            contentEditable={\n              <ContentEditable className=\"StickyNode__contentEditable\" />\n            }\n            placeholder={\n              <Placeholder className=\"StickyNode__placeholder\">\n                What's up?\n              </Placeholder>\n            }\n            // TODO Remove after it's inherited from the parent (LexicalComposer)\n            initialEditorState={null}\n          />\n        </LexicalNestedComposer> */}\n      </div>\n    </div>\n  );\n}\n\ntype StickyNoteColor = 'pink' | 'yellow';\n\nexport type SerializedStickyNode = Spread<\n  {\n    xOffset: number;\n    yOffset: number;\n    color: StickyNoteColor;\n    caption: LexicalEditor;\n    type: 'sticky';\n    version: 1;\n  },\n  SerializedLexicalNode\n>;\n\nexport class StickyNode extends DecoratorNode<JSX.Element> {\n  __x: number;\n  __y: number;\n  __color: StickyNoteColor;\n  __caption: LexicalEditor;\n\n  static getType(): string {\n    return 'sticky';\n  }\n\n  static clone(node: StickyNode): StickyNode {\n    return new StickyNode(\n      node.__x,\n      node.__y,\n      node.__color,\n      node.__caption,\n      node.__key,\n    );\n  }\n  static importJSON(serializedNode: SerializedStickyNode): StickyNode {\n    return new StickyNode(\n      serializedNode.xOffset,\n      serializedNode.yOffset,\n      serializedNode.color,\n      serializedNode.caption,\n    );\n  }\n\n  constructor(\n    x: number,\n    y: number,\n    color: 'pink' | 'yellow',\n    caption?: LexicalEditor,\n    key?: NodeKey,\n  ) {\n    super(key);\n    this.__x = x;\n    this.__y = y;\n    this.__caption = caption || createEditor();\n    this.__color = color;\n  }\n\n  exportJSON(): SerializedStickyNode {\n    return {\n      caption: this.__caption,\n      color: this.__color,\n      type: 'sticky',\n      version: 1,\n      xOffset: this.__x,\n      yOffset: this.__y,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const div = document.createElement('div');\n    div.style.display = 'contents';\n    return div;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  setPosition(x: number, y: number): void {\n    const writable = this.getWritable();\n    writable.__x = x;\n    writable.__y = y;\n    $setSelection(null);\n  }\n\n  toggleColor(): void {\n    const writable = this.getWritable();\n    writable.__color = writable.__color === 'pink' ? 'yellow' : 'pink';\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    return createPortal(\n      <StickyComponent\n        color={this.__color}\n        x={this.__x}\n        y={this.__y}\n        nodeKey={this.getKey()}\n        caption={this.__caption}\n      />,\n      document.body,\n    );\n  }\n\n  isIsolated(): true {\n    return true;\n  }\n}\n\nexport function $isStickyNode(\n  node: LexicalNode | null | undefined,\n): node is StickyNode {\n  return node instanceof StickyNode;\n}\n\nexport function $createStickyNode(\n  xOffset: number,\n  yOffset: number,\n): StickyNode {\n  return new StickyNode(xOffset, yOffset, 'yellow');\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  ReactNode,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport * as React from 'react';\nimport {createPortal} from 'react-dom';\n\ntype DropDownContextType = {\n  registerItem: (ref: React.RefObject<HTMLButtonElement>) => void;\n};\n\nconst DropDownContext = React.createContext<DropDownContextType | null>(null);\n\nexport function DropDownItem({\n  children,\n  className,\n  onClick,\n  title,\n}: {\n  children: React.ReactNode;\n  className: string;\n  onClick: (event: React.MouseEvent<HTMLButtonElement>) => void;\n  title?: string;\n}) {\n  const ref = useRef<HTMLButtonElement>(null);\n\n  const dropDownContext = React.useContext(DropDownContext);\n\n  if (dropDownContext === null) {\n    throw new Error('DropDownItem must be used within a DropDown');\n  }\n\n  const {registerItem} = dropDownContext;\n\n  useEffect(() => {\n    if (ref && ref.current) {\n      registerItem(ref);\n    }\n  }, [ref, registerItem]);\n\n  return (\n    <button className={className} onClick={onClick} ref={ref} title={title}>\n      {children}\n    </button>\n  );\n}\n\nfunction DropDownItems({\n  children,\n  dropDownRef,\n  onClose,\n}: {\n  children: React.ReactNode;\n  dropDownRef: React.Ref<HTMLDivElement>;\n  onClose: () => void;\n}) {\n  const [items, setItems] = useState<React.RefObject<HTMLButtonElement>[]>();\n  const [highlightedItem, setHighlightedItem] =\n    useState<React.RefObject<HTMLButtonElement>>();\n\n  const registerItem = useCallback(\n    (itemRef: React.RefObject<HTMLButtonElement>) => {\n      setItems((prev) => (prev ? [...prev, itemRef] : [itemRef]));\n    },\n    [setItems],\n  );\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLDivElement>) => {\n    if (!items) return;\n\n    const key = event.key;\n\n    if (['Escape', 'ArrowUp', 'ArrowDown', 'Tab'].includes(key)) {\n      event.preventDefault();\n    }\n\n    if (key === 'Escape' || key === 'Tab') {\n      onClose();\n    } else if (key === 'ArrowUp') {\n      setHighlightedItem((prev) => {\n        if (!prev) return items[0];\n        const index = items.indexOf(prev) - 1;\n        return items[index === -1 ? items.length - 1 : index];\n      });\n    } else if (key === 'ArrowDown') {\n      setHighlightedItem((prev) => {\n        if (!prev) return items[0];\n        return items[items.indexOf(prev) + 1];\n      });\n    }\n  };\n\n  const contextValue = useMemo(\n    () => ({\n      registerItem,\n    }),\n    [registerItem],\n  );\n\n  useEffect(() => {\n    if (items && !highlightedItem) {\n      setHighlightedItem(items[0]);\n    }\n\n    if (highlightedItem && highlightedItem.current) {\n      highlightedItem.current.focus();\n    }\n  }, [items, highlightedItem]);\n\n  return (\n    <DropDownContext.Provider value={contextValue}>\n      <div className=\"dropdown\" ref={dropDownRef} onKeyDown={handleKeyDown}>\n        {children}\n      </div>\n    </DropDownContext.Provider>\n  );\n}\n\nexport default function DropDown({\n  buttonLabel,\n  buttonAriaLabel,\n  buttonClassName,\n  buttonIconClassName,\n  children,\n  stopCloseOnClickSelf,\n}: {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  children: ReactNode;\n  stopCloseOnClickSelf?: boolean;\n}): JSX.Element {\n  const dropDownRef = useRef<HTMLDivElement>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const [showDropDown, setShowDropDown] = useState(false);\n\n  const handleClose = () => {\n    setShowDropDown(false);\n    if (buttonRef && buttonRef.current) {\n      buttonRef.current.focus();\n    }\n  };\n\n  useEffect(() => {\n    const button = buttonRef.current;\n    const dropDown = dropDownRef.current;\n\n    if (showDropDown && button !== null && dropDown !== null) {\n      const {top, left} = button.getBoundingClientRect();\n      dropDown.style.top = `${top + 40}px`;\n      dropDown.style.left = `${Math.min(\n        left,\n        window.innerWidth - dropDown.offsetWidth - 20,\n      )}px`;\n    }\n  }, [dropDownRef, buttonRef, showDropDown]);\n\n  useEffect(() => {\n    const button = buttonRef.current;\n\n    if (button !== null && showDropDown) {\n      const handle = (event: MouseEvent) => {\n        const target = event.target;\n        if (stopCloseOnClickSelf) {\n          if (\n            dropDownRef.current &&\n            dropDownRef.current.contains(target as Node)\n          )\n            return;\n        }\n        if (!button.contains(target as Node)) {\n          setShowDropDown(false);\n        }\n      };\n      document.addEventListener('click', handle);\n\n      return () => {\n        document.removeEventListener('click', handle);\n      };\n    }\n  }, [dropDownRef, buttonRef, showDropDown, stopCloseOnClickSelf]);\n\n  return (\n    <>\n      <button\n        aria-label={buttonAriaLabel || buttonLabel}\n        className={buttonClassName}\n        onClick={() => setShowDropDown(!showDropDown)}\n        ref={buttonRef}>\n        {buttonIconClassName && <span className={buttonIconClassName} />}\n        {buttonLabel && (\n          <span className=\"text dropdown-button-text\">{buttonLabel}</span>\n        )}\n        <i className=\"chevron-down\" />\n      </button>\n\n      {showDropDown &&\n        createPortal(\n          <DropDownItems dropDownRef={dropDownRef} onClose={handleClose}>\n            {children}\n          </DropDownItems>,\n          document.body,\n        )}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  label: string;\n  onChange: (val: string) => void;\n  placeholder?: string;\n  value: string;\n}>;\n\nexport default function TextInput({\n  label,\n  value,\n  onChange,\n  placeholder = '',\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"text\"\n        className=\"Input__input\"\n        placeholder={placeholder}\n        value={value}\n        onChange={(e) => {\n          onChange(e.target.value);\n        }}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './ColorPicker.css';\n\nimport {ReactNode, useEffect, useMemo, useRef, useState} from 'react';\nimport * as React from 'react';\n\nimport DropDown from './DropDown';\nimport TextInput from './TextInput';\n\ninterface ColorPickerProps {\n  buttonAriaLabel?: string;\n  buttonClassName: string;\n  buttonIconClassName?: string;\n  buttonLabel?: string;\n  color: string;\n  children?: ReactNode;\n  onChange?: (color: string) => void;\n  title?: string;\n}\n\nconst basicColors = [\n  '#d0021b',\n  '#f5a623',\n  '#f8e71c',\n  '#8b572a',\n  '#7ed321',\n  '#417505',\n  '#bd10e0',\n  '#9013fe',\n  '#4a90e2',\n  '#50e3c2',\n  '#b8e986',\n  '#000000',\n  '#4a4a4a',\n  '#9b9b9b',\n  '#ffffff',\n];\n\nconst WIDTH = 214;\nconst HEIGHT = 150;\n\nexport default function ColorPicker({\n  color,\n  children,\n  onChange,\n  ...rest\n}: Readonly<ColorPickerProps>): JSX.Element {\n  const [selfColor, setSelfColor] = useState(transformColor('hex', color));\n  const [inputColor, setInputColor] = useState(color);\n  const innerDivRef = useRef(null);\n\n  const saturationPosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.s / 100) * WIDTH,\n      y: ((100 - selfColor.hsv.v) / 100) * HEIGHT,\n    }),\n    [selfColor.hsv.s, selfColor.hsv.v],\n  );\n\n  const huePosition = useMemo(\n    () => ({\n      x: (selfColor.hsv.h / 360) * WIDTH,\n    }),\n    [selfColor.hsv],\n  );\n\n  const onSetHex = (hex: string) => {\n    setInputColor(hex);\n    if (/^#[0-9A-Fa-f]{6}$/i.test(hex)) {\n      const newColor = transformColor('hex', hex);\n      setSelfColor(newColor);\n    }\n  };\n\n  const onMoveSaturation = ({x, y}: Position) => {\n    const newHsv = {\n      ...selfColor.hsv,\n      s: (x / WIDTH) * 100,\n      v: 100 - (y / HEIGHT) * 100,\n    };\n    const newColor = transformColor('hsv', newHsv);\n    setSelfColor(newColor);\n    setInputColor(newColor.hex);\n  };\n\n  const onMoveHue = ({x}: Position) => {\n    const newHsv = {...selfColor.hsv, h: (x / WIDTH) * 360};\n    const newColor = transformColor('hsv', newHsv);\n\n    setSelfColor(newColor);\n    setInputColor(newColor.hex);\n  };\n\n  useEffect(() => {\n    // Check if the dropdown is actually active\n    if (innerDivRef.current !== null && onChange) {\n      onChange(selfColor.hex);\n      setInputColor(selfColor.hex);\n    }\n  }, [selfColor, onChange]);\n\n  useEffect(() => {\n    if (color === undefined) return;\n    const newColor = transformColor('hex', color);\n    setSelfColor(newColor);\n    setInputColor(newColor.hex);\n  }, [color]);\n\n  return (\n    <DropDown {...rest} stopCloseOnClickSelf={true}>\n      <div\n        className=\"color-picker-wrapper\"\n        style={{width: WIDTH}}\n        ref={innerDivRef}>\n        <TextInput label=\"Hex\" onChange={onSetHex} value={inputColor} />\n        <div className=\"color-picker-basic-color\">\n          {basicColors.map((basicColor) => (\n            <button\n              className={basicColor === selfColor.hex ? ' active' : ''}\n              key={basicColor}\n              style={{backgroundColor: basicColor}}\n              onClick={() => {\n                setInputColor(basicColor);\n                setSelfColor(transformColor('hex', basicColor));\n              }}\n            />\n          ))}\n        </div>\n        <MoveWrapper\n          className=\"color-picker-saturation\"\n          style={{backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`}}\n          onChange={onMoveSaturation}>\n          <div\n            className=\"color-picker-saturation_cursor\"\n            style={{\n              backgroundColor: selfColor.hex,\n              left: saturationPosition.x,\n              top: saturationPosition.y,\n            }}\n          />\n        </MoveWrapper>\n        <MoveWrapper className=\"color-picker-hue\" onChange={onMoveHue}>\n          <div\n            className=\"color-picker-hue_cursor\"\n            style={{\n              backgroundColor: `hsl(${selfColor.hsv.h}, 100%, 50%)`,\n              left: huePosition.x,\n            }}\n          />\n        </MoveWrapper>\n        <div\n          className=\"color-picker-color\"\n          style={{backgroundColor: selfColor.hex}}\n        />\n      </div>\n      {children}\n    </DropDown>\n  );\n}\n\nexport interface Position {\n  x: number;\n  y: number;\n}\n\ninterface MoveWrapperProps {\n  className?: string;\n  style?: React.CSSProperties;\n  onChange: (position: Position) => void;\n  children: JSX.Element;\n}\n\nfunction MoveWrapper({className, style, onChange, children}: MoveWrapperProps) {\n  const divRef = useRef<HTMLDivElement>(null);\n\n  const move = (e: React.MouseEvent | MouseEvent): void => {\n    if (divRef.current) {\n      const {current: div} = divRef;\n      const {width, height, left, top} = div.getBoundingClientRect();\n\n      const x = clamp(e.clientX - left, width, 0);\n      const y = clamp(e.clientY - top, height, 0);\n\n      onChange({x, y});\n    }\n  };\n\n  const onMouseDown = (e: React.MouseEvent): void => {\n    if (e.button !== 0) return;\n\n    move(e);\n\n    const onMouseMove = (_e: MouseEvent): void => {\n      move(_e);\n    };\n\n    const onMouseUp = (_e: MouseEvent): void => {\n      document.removeEventListener('mousemove', onMouseMove, false);\n      document.removeEventListener('mouseup', onMouseUp, false);\n\n      move(_e);\n    };\n\n    document.addEventListener('mousemove', onMouseMove, false);\n    document.addEventListener('mouseup', onMouseUp, false);\n  };\n\n  return (\n    <div\n      ref={divRef}\n      className={className}\n      style={style}\n      onMouseDown={onMouseDown}>\n      {children}\n    </div>\n  );\n}\n\nfunction clamp(value: number, max: number, min: number) {\n  return value > max ? max : value < min ? min : value;\n}\n\ninterface RGB {\n  b: number;\n  g: number;\n  r: number;\n}\ninterface HSV {\n  h: number;\n  s: number;\n  v: number;\n}\ninterface Color {\n  hex: string;\n  hsv: HSV;\n  rgb: RGB;\n}\n\nexport function toHex(value: string): string {\n  if (!value.startsWith('#')) {\n    const ctx = document.createElement('canvas').getContext('2d');\n\n    if (!ctx) {\n      throw new Error('2d context not supported or canvas already initialized');\n    }\n\n    ctx.fillStyle = value;\n\n    return ctx.fillStyle;\n  } else if (value.length === 4 || value.length === 5) {\n    value = value\n      .split('')\n      .map((v, i) => (i ? v + v : '#'))\n      .join('');\n\n    return value;\n  } else if (value.length === 7 || value.length === 9) {\n    return value;\n  }\n\n  return '#000000';\n}\n\nfunction hex2rgb(hex: string): RGB {\n  const rbgArr = (\n    hex\n      .replace(\n        /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,\n        (m, r, g, b) => '#' + r + r + g + g + b + b,\n      )\n      .substring(1)\n      .match(/.{2}/g) || []\n  ).map((x) => parseInt(x, 16));\n\n  return {\n    b: rbgArr[2],\n    g: rbgArr[1],\n    r: rbgArr[0],\n  };\n}\n\nfunction rgb2hsv({r, g, b}: RGB): HSV {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  const max = Math.max(r, g, b);\n  const d = max - Math.min(r, g, b);\n\n  const h = d\n    ? (max === r\n        ? (g - b) / d + (g < b ? 6 : 0)\n        : max === g\n        ? 2 + (b - r) / d\n        : 4 + (r - g) / d) * 60\n    : 0;\n  const s = max ? (d / max) * 100 : 0;\n  const v = max * 100;\n\n  return {h, s, v};\n}\n\nfunction hsv2rgb({h, s, v}: HSV): RGB {\n  s /= 100;\n  v /= 100;\n\n  const i = ~~(h / 60);\n  const f = h / 60 - i;\n  const p = v * (1 - s);\n  const q = v * (1 - s * f);\n  const t = v * (1 - s * (1 - f));\n  const index = i % 6;\n\n  const r = Math.round([v, q, p, p, t, v][index] * 255);\n  const g = Math.round([t, v, v, q, p, p][index] * 255);\n  const b = Math.round([p, p, t, v, v, q][index] * 255);\n\n  return {b, g, r};\n}\n\nfunction rgb2hex({b, g, r}: RGB): string {\n  return '#' + [r, g, b].map((x) => x.toString(16).padStart(2, '0')).join('');\n}\n\nfunction transformColor<M extends keyof Color, C extends Color[M]>(\n  format: M,\n  color: C,\n): Color {\n  let hex: Color['hex'] = toHex('#121212');\n  let rgb: Color['rgb'] = hex2rgb(hex);\n  let hsv: Color['hsv'] = rgb2hsv(rgb);\n\n  if (format === 'hex') {\n    const value = color as Color['hex'];\n\n    hex = toHex(value);\n    rgb = hex2rgb(hex);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'rgb') {\n    const value = color as Color['rgb'];\n\n    rgb = value;\n    hex = rgb2hex(rgb);\n    hsv = rgb2hsv(rgb);\n  } else if (format === 'hsv') {\n    const value = color as Color['hsv'];\n\n    hsv = value;\n    rgb = hsv2rgb(hsv);\n    hex = rgb2hex(rgb);\n  }\n\n  return {hex, hsv, rgb};\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './Input.css';\n\nimport * as React from 'react';\n\ntype Props = Readonly<{\n  'data-test-id'?: string;\n  accept?: string;\n  label: string;\n  onChange: (files: FileList | null) => void;\n}>;\n\nexport default function FileInput({\n  accept,\n  label,\n  onChange,\n  'data-test-id': dataTestId,\n}: Props): JSX.Element {\n  return (\n    <div className=\"Input__wrapper\">\n      <label className=\"Input__label\">{label}</label>\n      <input\n        type=\"file\"\n        accept={accept}\n        className=\"Input__input\"\n        onChange={(e) => onChange(e.target.files)}\n        data-test-id={dataTestId}\n      />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './KatexEquationAlterer.css';\n\nimport * as React from 'react';\nimport {useCallback, useState} from 'react';\n\nimport Button from '../ui/Button';\nimport KatexRenderer from './KatexRenderer';\n\ntype Props = {\n  initialEquation?: string;\n  onConfirm: (equation: string, inline: boolean) => void;\n};\n\nexport default function KatexEquationAlterer({\n  onConfirm,\n  initialEquation = '',\n}: Props): JSX.Element {\n  const [equation, setEquation] = useState<string>(initialEquation);\n  const [inline, setInline] = useState<boolean>(true);\n\n  const onClick = useCallback(() => {\n    onConfirm(equation, inline);\n  }, [onConfirm, equation, inline]);\n\n  const onCheckboxChange = useCallback(() => {\n    setInline(!inline);\n  }, [setInline, inline]);\n\n  return (\n    <>\n      <div className=\"KatexEquationAlterer_defaultRow\">\n        Inline\n        <input type=\"checkbox\" checked={inline} onChange={onCheckboxChange} />\n      </div>\n      <div className=\"KatexEquationAlterer_defaultRow\">Equation </div>\n      <div className=\"KatexEquationAlterer_centerRow\">\n        {inline ? (\n          <input\n            onChange={(event) => {\n              setEquation(event.target.value);\n            }}\n            value={equation}\n            className=\"KatexEquationAlterer_textArea\"\n          />\n        ) : (\n          <textarea\n            onChange={(event) => {\n              setEquation(event.target.value);\n            }}\n            value={equation}\n            className=\"KatexEquationAlterer_textArea\"\n          />\n        )}\n      </div>\n      <div className=\"KatexEquationAlterer_defaultRow\">Visualization </div>\n      <div className=\"KatexEquationAlterer_centerRow\">\n        <KatexRenderer\n          equation={equation}\n          inline={false}\n          onClick={() => null}\n        />\n      </div>\n      <div className=\"KatexEquationAlterer_dialogActions\">\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './LinkPreview.css';\n\nimport * as React from 'react';\nimport {CSSProperties, Suspense} from 'react';\n\ntype Preview = {\n  title: string;\n  description: string;\n  img: string;\n  domain: string;\n} | null;\n\n// Cached responses or running request promises\nconst PREVIEW_CACHE: Record<string, Promise<Preview> | {preview: Preview}> = {};\n\nconst URL_MATCHER =\n  /((https?:\\/\\/(www\\.)?)|(www\\.))[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/;\n\nfunction useSuspenseRequest(url: string) {\n  let cached = PREVIEW_CACHE[url];\n\n  if (!url.match(URL_MATCHER)) {\n    return {preview: null};\n  }\n\n  if (!cached) {\n    cached = PREVIEW_CACHE[url] = fetch(\n      `/api/link-preview?url=${encodeURI(url)}`,\n    )\n      .then((response) => response.json())\n      .then((preview) => {\n        PREVIEW_CACHE[url] = preview;\n        return preview;\n      })\n      .catch(() => {\n        PREVIEW_CACHE[url] = {preview: null};\n      });\n  }\n\n  if (cached instanceof Promise) {\n    throw cached;\n  }\n\n  return cached;\n}\n\nfunction LinkPreviewContent({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element | null {\n  const {preview} = useSuspenseRequest(url);\n  if (preview === null) {\n    return null;\n  }\n  return (\n    <div className=\"LinkPreview__container\">\n      {preview.img && (\n        <div className=\"LinkPreview__imageWrapper\">\n          <img\n            src={preview.img}\n            alt={preview.title}\n            className=\"LinkPreview__image\"\n          />\n        </div>\n      )}\n      {preview.domain && (\n        <div className=\"LinkPreview__domain\">{preview.domain}</div>\n      )}\n      {preview.title && (\n        <div className=\"LinkPreview__title\">{preview.title}</div>\n      )}\n      {preview.description && (\n        <div className=\"LinkPreview__description\">{preview.description}</div>\n      )}\n    </div>\n  );\n}\n\nfunction Glimmer(props: {style: CSSProperties; index: number}): JSX.Element {\n  return (\n    <div\n      className=\"LinkPreview__glimmer\"\n      {...props}\n      style={{\n        animationDelay: String((props.index || 0) * 300),\n        ...(props.style || {}),\n      }}\n    />\n  );\n}\n\nexport default function LinkPreview({\n  url,\n}: Readonly<{\n  url: string;\n}>): JSX.Element {\n  return (\n    <Suspense\n      fallback={\n        <>\n          <Glimmer style={{height: '80px'}} index={0} />\n          <Glimmer style={{width: '60%'}} index={1} />\n          <Glimmer style={{width: '80%'}} index={2} />\n        </>\n      }>\n      <LinkPreviewContent url={url} />\n    </Suspense>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  DOMConversionMap,\n  DOMConversionOutput,\n  DOMExportOutput,\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport {BlockWithAlignableContents} from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\nimport {useCallback, useEffect, useRef, useState} from 'react';\n\nconst WIDGET_SCRIPT_URL = 'https://platform.twitter.com/widgets.js';\n\nconst getHasScriptCached = () =>\n  document.querySelector(`script[src=\"${WIDGET_SCRIPT_URL}\"]`);\n\ntype TweetComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  loadingComponent?: JSX.Element | string;\n  nodeKey: NodeKey;\n  onError?: (error: string) => void;\n  onLoad?: () => void;\n  tweetID: string;\n}>;\n\nfunction convertTweetElement(\n  domNode: HTMLDivElement,\n): DOMConversionOutput | null {\n  const id = domNode.getAttribute('data-lexical-tweet-id');\n  if (id) {\n    const node = $createTweetNode(id);\n    return {node};\n  }\n  return null;\n}\n\nfunction TweetComponent({\n  className,\n  format,\n  loadingComponent,\n  nodeKey,\n  onError,\n  onLoad,\n  tweetID,\n}: TweetComponentProps) {\n  const containerRef = useRef<HTMLDivElement | null>(null);\n\n  const previousTweetIDRef = useRef<string>('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const createTweet = useCallback(async () => {\n    try {\n      // @ts-expect-error Twitter is attached to the window.\n      await window.twttr.widgets.createTweet(tweetID, containerRef.current);\n\n      setIsLoading(false);\n\n      if (onLoad) {\n        onLoad();\n      }\n    } catch (error) {\n      if (onError) {\n        onError(String(error));\n      }\n    }\n  }, [onError, onLoad, tweetID]);\n\n  useEffect(() => {\n    if (tweetID !== previousTweetIDRef.current) {\n      setIsLoading(true);\n\n      if (!getHasScriptCached()) {\n        const script = document.createElement('script');\n        script.src = WIDGET_SCRIPT_URL;\n        script.async = true;\n        document.body?.appendChild(script);\n        script.onload = createTweet;\n        if (onError) {\n          script.onerror = onError as OnErrorEventHandler;\n        }\n      } else {\n        createTweet();\n      }\n\n      if (previousTweetIDRef) {\n        previousTweetIDRef.current = tweetID;\n      }\n    }\n  }, [createTweet, onError, tweetID]);\n\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}>\n      {isLoading ? loadingComponent : null}\n      <div\n        style={{display: 'inline-block', width: '550px'}}\n        ref={containerRef}\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedTweetNode = Spread<\n  {\n    id: string;\n    type: 'tweet';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class TweetNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'tweet';\n  }\n\n  static clone(node: TweetNode): TweetNode {\n    return new TweetNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedTweetNode): TweetNode {\n    const node = $createTweetNode(serializedNode.id);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedTweetNode {\n    return {\n      ...super.exportJSON(),\n      id: this.getId(),\n      type: 'tweet',\n      version: 1,\n    };\n  }\n\n  static importDOM(): DOMConversionMap<HTMLDivElement> | null {\n    return {\n      div: (domNode: HTMLDivElement) => {\n        if (!domNode.hasAttribute('data-lexical-tweet-id')) {\n          return null;\n        }\n        return {\n          conversion: convertTweetElement,\n          priority: 2,\n        };\n      },\n    };\n  }\n\n  exportDOM(): DOMExportOutput {\n    const element = document.createElement('div');\n    element.setAttribute('data-lexical-tweet-id', this.__id);\n    return {element};\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  getId(): string {\n    return this.__id;\n  }\n\n  decorate(editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <TweetComponent\n        className={className}\n        format={this.__format}\n        loadingComponent=\"Loading...\"\n        nodeKey={this.getKey()}\n        tweetID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createTweetNode(tweetID: string): TweetNode {\n  return new TweetNode(tweetID);\n}\n\nexport function $isTweetNode(\n  node: TweetNode | LexicalNode | null | undefined,\n): node is TweetNode {\n  return node instanceof TweetNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getRoot,\n  $getSelection,\n  // $isGridSelection,\n  $isNodeSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  LexicalCommand,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createTweetNode, TweetNode} from '../nodes/TweetNode';\n\nexport const INSERT_TWEET_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function TwitterPlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([TweetNode])) {\n      throw new Error('TwitterPlugin: TweetNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_TWEET_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const tweetNode = $createTweetNode(payload);\n        // if ($isRangeSelection(selection)) {\n        //   const focusNode = selection.focus.getNode();\n        //   focusNode.getTopLevelElementOrThrow().insertAfter(tweetNode);\n        // } else if ($isNodeSelection(selection) || $isGridSelection(selection)) {\n        //   const nodes = selection.getNodes();\n        //   nodes[nodes.length - 1]\n        //     .getTopLevelElementOrThrow()\n        //     .insertAfter(tweetNode);\n        // } else {\n        //   const root = $getRoot();\n        //   root.append(tweetNode);\n        // }\n        const paragraphNode = $createParagraphNode();\n        tweetNode.insertAfter(paragraphNode);\n        paragraphNode.select();\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  EditorConfig,\n  ElementFormatType,\n  LexicalEditor,\n  LexicalNode,\n  NodeKey,\n  Spread,\n} from 'lexical';\n\nimport {BlockWithAlignableContents} from '@lexical/react/LexicalBlockWithAlignableContents';\nimport {\n  DecoratorBlockNode,\n  SerializedDecoratorBlockNode,\n} from '@lexical/react/LexicalDecoratorBlockNode';\nimport * as React from 'react';\n\ntype YouTubeComponentProps = Readonly<{\n  className: Readonly<{\n    base: string;\n    focus: string;\n  }>;\n  format: ElementFormatType | null;\n  nodeKey: NodeKey;\n  videoID: string;\n}>;\n\nfunction YouTubeComponent({\n  className,\n  format,\n  nodeKey,\n  videoID,\n}: YouTubeComponentProps) {\n  return (\n    <BlockWithAlignableContents\n      className={className}\n      format={format}\n      nodeKey={nodeKey}>\n      <iframe\n        width=\"560\"\n        height=\"315\"\n        src={`https://www.youtube.com/embed/${videoID}`}\n        frameBorder=\"0\"\n        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n        allowFullScreen={true}\n        title=\"YouTube video\"\n      />\n    </BlockWithAlignableContents>\n  );\n}\n\nexport type SerializedYouTubeNode = Spread<\n  {\n    videoID: string;\n    type: 'youtube';\n    version: 1;\n  },\n  SerializedDecoratorBlockNode\n>;\n\nexport class YouTubeNode extends DecoratorBlockNode {\n  __id: string;\n\n  static getType(): string {\n    return 'youtube';\n  }\n\n  static clone(node: YouTubeNode): YouTubeNode {\n    return new YouTubeNode(node.__id, node.__format, node.__key);\n  }\n\n  static importJSON(serializedNode: SerializedYouTubeNode): YouTubeNode {\n    const node = $createYouTubeNode(serializedNode.videoID);\n    node.setFormat(serializedNode.format);\n    return node;\n  }\n\n  exportJSON(): SerializedYouTubeNode {\n    return {\n      ...super.exportJSON(),\n      type: 'youtube',\n      version: 1,\n      videoID: this.__id,\n    };\n  }\n\n  constructor(id: string, format?: ElementFormatType, key?: NodeKey) {\n    super(format, key);\n    this.__id = id;\n  }\n\n  updateDOM(): false {\n    return false;\n  }\n\n  decorate(_editor: LexicalEditor, config: EditorConfig): JSX.Element {\n    const embedBlockTheme = config.theme.embedBlock || {};\n    const className = {\n      base: embedBlockTheme.base || '',\n      focus: embedBlockTheme.focus || '',\n    };\n    return (\n      <YouTubeComponent\n        className={className}\n        format={this.__format}\n        nodeKey={this.getKey()}\n        videoID={this.__id}\n      />\n    );\n  }\n\n  isTopLevel(): true {\n    return true;\n  }\n}\n\nexport function $createYouTubeNode(videoID: string): YouTubeNode {\n  return new YouTubeNode(videoID);\n}\n\nexport function $isYouTubeNode(\n  node: YouTubeNode | LexicalNode | null | undefined,\n): node is YouTubeNode {\n  return node instanceof YouTubeNode;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {\n  $createParagraphNode,\n  $getRoot,\n  $getSelection,\n  // $isGridSelection,\n  $isNodeSelection,\n  $isRangeSelection,\n  COMMAND_PRIORITY_EDITOR,\n  createCommand,\n  LexicalCommand,\n} from 'lexical';\nimport {useEffect} from 'react';\n\nimport {$createYouTubeNode, YouTubeNode} from '../nodes/YouTubeNode';\n\nexport const INSERT_YOUTUBE_COMMAND: LexicalCommand<string> = createCommand();\n\nexport default function YouTubePlugin(): JSX.Element | null {\n  const [editor] = useLexicalComposerContext();\n\n  useEffect(() => {\n    if (!editor.hasNodes([YouTubeNode])) {\n      throw new Error('YouTubePlugin: YouTubeNode not registered on editor');\n    }\n\n    return editor.registerCommand<string>(\n      INSERT_YOUTUBE_COMMAND,\n      (payload) => {\n        const selection = $getSelection();\n        const youTubeNode = $createYouTubeNode(payload);\n        // if ($isRangeSelection(selection)) {\n        //   const focusNode = selection.focus.getNode();\n        //   focusNode.getTopLevelElementOrThrow().insertAfter(youTubeNode);\n        // } else if ($isNodeSelection(selection) || $isGridSelection(selection)) {\n        //   const nodes = selection.getNodes();\n        //   nodes[nodes.length - 1]\n        //     .getTopLevelElementOrThrow()\n        //     .insertAfter(youTubeNode);\n        // } else {\n        //   const root = $getRoot();\n        //   root.append(youTubeNode);\n        // }\n        const paragraphNode = $createParagraphNode();\n        youTubeNode.insertAfter(paragraphNode);\n        paragraphNode.select();\n\n        return true;\n      },\n      COMMAND_PRIORITY_EDITOR,\n    );\n  }, [editor]);\n\n  return null;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {InsertImagePayload} from './ImagesPlugin';\nimport type {\n  GridSelection,\n  LexicalEditor,\n  NodeSelection,\n  RangeSelection,\n} from 'lexical';\n\n// import './ToolbarPlugin.css';\n\nimport {$createCodeNode, $isCodeNode} from '@lexical/code';\nimport {$isLinkNode, TOGGLE_LINK_COMMAND} from '@lexical/link';\nimport {\n  $isListNode,\n  INSERT_CHECK_LIST_COMMAND,\n  INSERT_ORDERED_LIST_COMMAND,\n  INSERT_UNORDERED_LIST_COMMAND,\n  ListNode,\n  REMOVE_LIST_COMMAND,\n} from '@lexical/list';\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {$isDecoratorBlockNode} from '@lexical/react/LexicalDecoratorBlockNode';\nimport {INSERT_HORIZONTAL_RULE_COMMAND} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {\n  $createHeadingNode,\n  $createQuoteNode,\n  $isHeadingNode,\n  HeadingTagType,\n} from '@lexical/rich-text';\nimport {\n  $getSelectionStyleValueForProperty,\n  $isAtNodeEnd,\n  $isParentElementRTL,\n  $patchStyleText,\n  $selectAll,\n  // $wrapLeafNodesInElements,\n} from '@lexical/selection';\nimport {INSERT_TABLE_COMMAND} from '@lexical/table';\nimport {\n  $getNearestBlockElementAncestorOrThrow,\n  $getNearestNodeOfType,\n  mergeRegister,\n} from '@lexical/utils';\nimport {\n  $createParagraphNode,\n  $getNodeByKey,\n  $getRoot,\n  $getSelection,\n  $isRangeSelection,\n  $isTextNode,\n  CAN_REDO_COMMAND,\n  CAN_UNDO_COMMAND,\n  COMMAND_PRIORITY_CRITICAL,\n  COMMAND_PRIORITY_LOW,\n  ElementNode,\n  FORMAT_ELEMENT_COMMAND,\n  FORMAT_TEXT_COMMAND,\n  INDENT_CONTENT_COMMAND,\n  NodeKey,\n  OUTDENT_CONTENT_COMMAND,\n  REDO_COMMAND,\n  SELECTION_CHANGE_COMMAND,\n  TextNode,\n  UNDO_COMMAND,\n} from 'lexical';\nimport * as React from 'react';\nimport {ChangeEvent, useCallback, useEffect, useRef, useState} from 'react';\nimport {createPortal} from 'react-dom';\nimport {IS_APPLE} from '../shared/src/environment';\n\nimport useModal from '../hooks/useModal';\nimport {$createStickyNode} from '../nodes/StickyNode';\nimport Button from '../ui/Button';\nimport ColorPicker from '../ui/ColorPicker';\nimport DropDown, {DropDownItem} from '../ui/DropDown';\nimport FileInput from '../ui/FileInput';\nimport KatexEquationAlterer from '../ui/KatexEquationAlterer';\nimport LinkPreview from '../ui/LinkPreview';\nimport TextInput from '../ui/TextInput';\nimport {INSERT_EQUATION_COMMAND} from './EquationsPlugin';\nimport {INSERT_EXCALIDRAW_COMMAND} from './ExcalidrawPlugin';\nimport {INSERT_IMAGE_COMMAND} from './ImagesPlugin';\nimport {INSERT_POLL_COMMAND} from './PollPlugin';\nimport {INSERT_TWEET_COMMAND} from './TwitterPlugin';\nimport {INSERT_YOUTUBE_COMMAND} from './YouTubePlugin';\n\nconst blockTypeToBlockName = {\n  bullet: 'Bulleted List',\n  check: 'Check List',\n  code: 'Code Block',\n  h1: 'Heading 1',\n  h2: 'Heading 2',\n  h3: 'Heading 3',\n  h4: 'Heading 4',\n  h5: 'Heading 5',\n  h6: 'Heading 6',\n  number: 'Numbered List',\n  paragraph: 'Normal',\n  quote: 'Quote',\n};\n\nconst CODE_LANGUAGE_OPTIONS: [string, string][] = [\n  ['', '- Select language -'],\n  ['c', 'C'],\n  ['clike', 'C-like'],\n  ['css', 'CSS'],\n  ['html', 'HTML'],\n  ['js', 'JavaScript'],\n  ['markdown', 'Markdown'],\n  ['objc', 'Objective-C'],\n  ['plain', 'Plain Text'],\n  ['py', 'Python'],\n  ['rust', 'Rust'],\n  ['sql', 'SQL'],\n  ['swift', 'Swift'],\n  ['xml', 'XML'],\n];\n\nconst CODE_LANGUAGE_MAP = {\n  javascript: 'js',\n  md: 'markdown',\n  plaintext: 'plain',\n  python: 'py',\n  text: 'plain',\n};\n\nfunction getSelectedNode(selection: RangeSelection): TextNode | ElementNode {\n  const anchor = selection.anchor;\n  const focus = selection.focus;\n  const anchorNode = selection.anchor.getNode();\n  const focusNode = selection.focus.getNode();\n  if (anchorNode === focusNode) {\n    return anchorNode;\n  }\n  const isBackward = selection.isBackward();\n  if (isBackward) {\n    return $isAtNodeEnd(focus) ? anchorNode : focusNode;\n  } else {\n    return $isAtNodeEnd(anchor) ? focusNode : anchorNode;\n  }\n}\n\nfunction positionEditorElement(\n  editor: HTMLElement,\n  rect: ClientRect | null,\n  rootElement: HTMLElement,\n): void {\n  if (rect === null) {\n    editor.style.opacity = '0';\n    editor.style.top = '-1000px';\n    editor.style.left = '-1000px';\n  } else {\n    editor.style.opacity = '1';\n    editor.style.top = `${rect.top + rect.height + window.pageYOffset + 10}px`;\n    const left = rect.left - editor.offsetWidth / 2 + rect.width / 2;\n    const rootElementRect = rootElement.getBoundingClientRect();\n    if (rootElementRect.left > left) {\n      editor.style.left = `${rect.left + window.pageXOffset}px`;\n    } else if (left + editor.offsetWidth > rootElementRect.right) {\n      editor.style.left = `${\n        rect.right + window.pageXOffset - editor.offsetWidth\n      }px`;\n    }\n  }\n}\n\nfunction FloatingLinkEditor({editor}: {editor: LexicalEditor}): JSX.Element {\n  const editorRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditMode, setEditMode] = useState(false);\n  const [lastSelection, setLastSelection] = useState<\n    RangeSelection | GridSelection | NodeSelection | null\n  >(null);\n\n  const updateLinkEditor = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent)) {\n        setLinkUrl(parent.getURL());\n      } else if ($isLinkNode(node)) {\n        setLinkUrl(node.getURL());\n      } else {\n        setLinkUrl('');\n      }\n    }\n    const editorElem = editorRef.current;\n    const nativeSelection = window.getSelection();\n    const activeElement = document.activeElement;\n\n    if (editorElem === null) {\n      return;\n    }\n\n    const rootElement = editor.getRootElement();\n    if (\n      selection !== null &&\n      nativeSelection !== null &&\n      !nativeSelection.isCollapsed &&\n      rootElement !== null &&\n      rootElement.contains(nativeSelection.anchorNode)\n    ) {\n      const domRange = nativeSelection.getRangeAt(0);\n      let rect;\n      if (nativeSelection.anchorNode === rootElement) {\n        let inner = rootElement;\n        while (inner.firstElementChild != null) {\n          inner = inner.firstElementChild as HTMLElement;\n        }\n        rect = inner.getBoundingClientRect();\n      } else {\n        rect = domRange.getBoundingClientRect();\n      }\n\n      positionEditorElement(editorElem, rect, rootElement);\n      // setLastSelection(selection);\n    } else if (!activeElement || activeElement.className !== 'link-input') {\n      if (rootElement !== null) {\n        positionEditorElement(editorElem, null, rootElement);\n      }\n      setLastSelection(null);\n      setEditMode(false);\n      setLinkUrl('');\n    }\n\n    return true;\n  }, [editor]);\n\n  useEffect(() => {\n    const onResize = () => {\n      editor.getEditorState().read(() => {\n        updateLinkEditor();\n      });\n    };\n    window.addEventListener('resize', onResize);\n\n    return () => {\n      window.removeEventListener('resize', onResize);\n    };\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    return mergeRegister(\n      editor.registerUpdateListener(({editorState}) => {\n        editorState.read(() => {\n          updateLinkEditor();\n        });\n      }),\n\n      editor.registerCommand(\n        SELECTION_CHANGE_COMMAND,\n        () => {\n          updateLinkEditor();\n          return true;\n        },\n        COMMAND_PRIORITY_LOW,\n      ),\n    );\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    editor.getEditorState().read(() => {\n      updateLinkEditor();\n    });\n  }, [editor, updateLinkEditor]);\n\n  useEffect(() => {\n    if (isEditMode && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditMode]);\n\n  return (\n    <div ref={editorRef} className=\"link-editor\">\n      {isEditMode ? (\n        <input\n          ref={inputRef}\n          className=\"link-input\"\n          value={linkUrl}\n          onChange={(event) => {\n            setLinkUrl(event.target.value);\n          }}\n          onKeyDown={(event) => {\n            if (event.key === 'Enter') {\n              event.preventDefault();\n              if (lastSelection !== null) {\n                if (linkUrl !== '') {\n                  editor.dispatchCommand(TOGGLE_LINK_COMMAND, linkUrl);\n                }\n                setEditMode(false);\n              }\n            } else if (event.key === 'Escape') {\n              event.preventDefault();\n              setEditMode(false);\n            }\n          }}\n        />\n      ) : (\n        <>\n          <div className=\"link-input\">\n            <a href={linkUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n              {linkUrl}\n            </a>\n            <div\n              className=\"link-edit\"\n              role=\"button\"\n              tabIndex={0}\n              onMouseDown={(event) => event.preventDefault()}\n              onClick={() => {\n                setEditMode(true);\n              }}\n            />\n          </div>\n          <LinkPreview url={linkUrl} />\n        </>\n      )}\n    </div>\n  );\n}\n\nfunction InsertImageUriDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  return (\n    <>\n      <TextInput\n        label=\"Image URL\"\n        placeholder=\"i.e. https://source.unsplash.com/random\"\n        onChange={setSrc}\n        value={src}\n        data-test-id=\"image-modal-url-input\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Random unsplash image\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-confirm-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({altText, src})}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageUploadedDialogBody({\n  onClick,\n}: {\n  onClick: (payload: InsertImagePayload) => void;\n}) {\n  const [src, setSrc] = useState('');\n  const [altText, setAltText] = useState('');\n\n  const isDisabled = src === '';\n\n  const loadImage = (files: FileList | null) => {\n    const reader = new FileReader();\n    reader.onload = function () {\n      if (typeof reader.result === 'string') {\n        setSrc(reader.result);\n      }\n      return '';\n    };\n    if (files !== null) {\n      reader.readAsDataURL(files[0]);\n    }\n  };\n\n  return (\n    <>\n      <FileInput\n        label=\"Image Upload\"\n        onChange={loadImage}\n        accept=\"image/*\"\n        data-test-id=\"image-modal-file-upload\"\n      />\n      <TextInput\n        label=\"Alt Text\"\n        placeholder=\"Descriptive alternative text\"\n        onChange={setAltText}\n        value={altText}\n        data-test-id=\"image-modal-alt-text-input\"\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"image-modal-file-upload-btn\"\n          disabled={isDisabled}\n          onClick={() => onClick({altText, src})}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertImageDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [mode, setMode] = useState<null | 'url' | 'file'>(null);\n\n  const onClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n    onClose();\n  };\n\n  return (\n    <>\n      {!mode && (\n        <div className=\"ToolbarPlugin__dialogButtonsList\">\n          {/* <Button\n            data-test-id=\"image-modal-option-sample\"\n            onClick={() =>\n              onClick({\n                altText: 'Yellow flower in tilt shift lens',\n                src: yellowFlowerImage,\n              })\n            }>\n            Sample\n          </Button> */}\n          <Button\n            data-test-id=\"image-modal-option-url\"\n            onClick={() => setMode('url')}>\n            URL\n          </Button>\n          <Button\n            data-test-id=\"image-modal-option-file\"\n            onClick={() => setMode('file')}>\n            File\n          </Button>\n        </div>\n      )}\n      {mode === 'url' && <InsertImageUriDialogBody onClick={onClick} />}\n      {mode === 'file' && <InsertImageUploadedDialogBody onClick={onClick} />}\n    </>\n  );\n}\n\nfunction InsertTableDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [rows, setRows] = useState('5');\n  const [columns, setColumns] = useState('5');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_TABLE_COMMAND, {columns, rows});\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"No of rows\" onChange={setRows} value={rows} />\n      <TextInput label=\"No of columns\" onChange={setColumns} value={columns} />\n      <div\n        className=\"ToolbarPlugin__dialogActions\"\n        data-test-id=\"table-model-confirm-insert\">\n        <Button onClick={onClick}>Confirm</Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertPollDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [question, setQuestion] = useState('');\n\n  const onClick = () => {\n    activeEditor.dispatchCommand(INSERT_POLL_COMMAND, question);\n    onClose();\n  };\n\n  return (\n    <>\n      <TextInput label=\"Question\" onChange={setQuestion} value={question} />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={question.trim() === ''} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nconst VALID_TWITTER_URL = /twitter.com\\/[0-9a-zA-Z]{1,20}\\/status\\/([0-9]*)/g;\n\nfunction InsertTweetDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const tweetID = text.split('status/')?.[1]?.split('?')?.[0];\n    activeEditor.dispatchCommand(INSERT_TWEET_COMMAND, tweetID);\n    onClose();\n  };\n\n  const isDisabled = text === '' || !text.match(VALID_TWITTER_URL);\n\n  return (\n    <>\n      <TextInput\n        label=\"Tweet URL\"\n        placeholder=\"i.e. https://twitter.com/jack/status/20\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button disabled={isDisabled} onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\n// Taken from https://stackoverflow.com/a/9102270\nconst YOUTUBE_ID_PARSER =\n  /^.*(youtu\\.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;\n\nconst parseYouTubeVideoID = (url: string) => {\n  const urlMatches = url.match(YOUTUBE_ID_PARSER);\n\n  return urlMatches?.[2].length === 11 ? urlMatches[2] : null;\n};\n\nfunction InsertYouTubeDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const [text, setText] = useState('');\n\n  const onClick = () => {\n    const videoID = parseYouTubeVideoID(text);\n    if (videoID) {\n      activeEditor.dispatchCommand(INSERT_YOUTUBE_COMMAND, videoID);\n    }\n    onClose();\n  };\n\n  const isDisabled = text === '' || !parseYouTubeVideoID(text);\n\n  return (\n    <>\n      <TextInput\n        data-test-id=\"youtube-embed-modal-url\"\n        label=\"YouTube URL\"\n        placeholder=\"i.e. https://www.youtube.com/watch?v=jNQXAC9IVRw\"\n        onChange={setText}\n        value={text}\n      />\n      <div className=\"ToolbarPlugin__dialogActions\">\n        <Button\n          data-test-id=\"youtube-embed-modal-submit-btn\"\n          disabled={isDisabled}\n          onClick={onClick}>\n          Confirm\n        </Button>\n      </div>\n    </>\n  );\n}\n\nfunction InsertEquationDialog({\n  activeEditor,\n  onClose,\n}: {\n  activeEditor: LexicalEditor;\n  onClose: () => void;\n}): JSX.Element {\n  const onEquationConfirm = useCallback(\n    (equation: string, inline: boolean) => {\n      activeEditor.dispatchCommand(INSERT_EQUATION_COMMAND, {equation, inline});\n      onClose();\n    },\n    [activeEditor, onClose],\n  );\n\n  return <KatexEquationAlterer onConfirm={onEquationConfirm} />;\n}\n\nfunction dropDownActiveClass(active: boolean) {\n  if (active) return 'active dropdown-item-active';\n  else return '';\n}\n\nfunction BlockFormatDropDown({\n  editor,\n  blockType,\n}: {\n  blockType: keyof typeof blockTypeToBlockName;\n  editor: LexicalEditor;\n}): JSX.Element {\n  const formatParagraph = () => {\n    if (blockType !== 'paragraph') {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          // $wrapLeafNodesInElements(selection, () => $createParagraphNode());\n        }\n      });\n    }\n  };\n\n  const formatHeading = (headingSize: HeadingTagType) => {\n    if (blockType !== headingSize) {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          // $wrapLeafNodesInElements(selection, () =>\n          //   $createHeadingNode(headingSize),\n          // );\n        }\n      });\n    }\n  };\n\n  const formatBulletList = () => {\n    if (blockType !== 'bullet') {\n      editor.dispatchCommand(INSERT_UNORDERED_LIST_COMMAND, undefined);\n    } else {\n      editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatCheckList = () => {\n    if (blockType !== 'check') {\n      editor.dispatchCommand(INSERT_CHECK_LIST_COMMAND, undefined);\n    } else {\n      editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatNumberedList = () => {\n    if (blockType !== 'number') {\n      editor.dispatchCommand(INSERT_ORDERED_LIST_COMMAND, undefined);\n    } else {\n      editor.dispatchCommand(REMOVE_LIST_COMMAND, undefined);\n    }\n  };\n\n  const formatQuote = () => {\n    if (blockType !== 'quote') {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          // $wrapLeafNodesInElements(selection, () => $createQuoteNode());\n        }\n      });\n    }\n  };\n\n  const formatCode = () => {\n    if (blockType !== 'code') {\n      editor.update(() => {\n        const selection = $getSelection();\n\n        if ($isRangeSelection(selection)) {\n          if (selection.isCollapsed()) {\n            // $wrapLeafNodesInElements(selection, () => $createCodeNode());\n          } else {\n            const textContent = selection.getTextContent();\n            const codeNode = $createCodeNode();\n            selection.insertNodes([codeNode]);\n            selection.insertRawText(textContent);\n          }\n        }\n      });\n    }\n  };\n\n  return (\n    <DropDown\n      buttonClassName=\"toolbar-item block-controls\"\n      buttonIconClassName={'icon block-type ' + blockType}\n      buttonLabel={blockTypeToBlockName[blockType]}\n      buttonAriaLabel=\"Formatting options for text style\">\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'paragraph')}\n        onClick={formatParagraph}>\n        <i className=\"icon paragraph\" />\n        <span className=\"text\">Normal</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'h1')}\n        onClick={() => formatHeading('h1')}>\n        <i className=\"icon h1\" />\n        <span className=\"text\">Heading 1</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'h2')}\n        onClick={() => formatHeading('h2')}>\n        <i className=\"icon h2\" />\n        <span className=\"text\">Heading 2</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'h3')}\n        onClick={() => formatHeading('h3')}>\n        <i className=\"icon h3\" />\n        <span className=\"text\">Heading 3</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'bullet')}\n        onClick={formatBulletList}>\n        <i className=\"icon bullet-list\" />\n        <span className=\"text\">Bullet List</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'number')}\n        onClick={formatNumberedList}>\n        <i className=\"icon numbered-list\" />\n        <span className=\"text\">Numbered List</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'check')}\n        onClick={formatCheckList}>\n        <i className=\"icon check-list\" />\n        <span className=\"text\">Check List</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'quote')}\n        onClick={formatQuote}>\n        <i className=\"icon quote\" />\n        <span className=\"text\">Quote</span>\n      </DropDownItem>\n      <DropDownItem\n        className={'item ' + dropDownActiveClass(blockType === 'code')}\n        onClick={formatCode}>\n        <i className=\"icon code\" />\n        <span className=\"text\">Code Block</span>\n      </DropDownItem>\n    </DropDown>\n  );\n}\n\nfunction Divider(): JSX.Element {\n  return <div className=\"divider\" />;\n}\n\nfunction Select({\n  onChange,\n  className,\n  options,\n  value,\n}: {\n  className: string;\n  onChange: (e: ChangeEvent) => void;\n  options: [string, string][];\n  value: string;\n}): JSX.Element {\n  return (\n    <select className={className} onChange={onChange} value={value}>\n      {options.map(([option, text]) => (\n        <option key={option} value={option}>\n          {text}\n        </option>\n      ))}\n    </select>\n  );\n}\n\nexport default function ToolbarPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [activeEditor, setActiveEditor] = useState(editor);\n  const [blockType, setBlockType] =\n    useState<keyof typeof blockTypeToBlockName>('paragraph');\n  const [selectedElementKey, setSelectedElementKey] = useState<NodeKey | null>(\n    null,\n  );\n  const [fontSize, setFontSize] = useState<string>('15px');\n  const [fontColor, setFontColor] = useState<string>('#000');\n  const [bgColor, setBgColor] = useState<string>('#fff');\n  const [fontFamily, setFontFamily] = useState<string>('Arial');\n  const [isLink, setIsLink] = useState(false);\n  const [isBold, setIsBold] = useState(false);\n  const [isItalic, setIsItalic] = useState(false);\n  const [isUnderline, setIsUnderline] = useState(false);\n  const [isStrikethrough, setIsStrikethrough] = useState(false);\n  const [isSubscript, setIsSubscript] = useState(false);\n  const [isSuperscript, setIsSuperscript] = useState(false);\n  const [isCode, setIsCode] = useState(false);\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n  const [modal, showModal] = useModal();\n  const [isRTL, setIsRTL] = useState(false);\n  const [codeLanguage, setCodeLanguage] = useState<string>('');\n\n  const updateToolbar = useCallback(() => {\n    const selection = $getSelection();\n    if ($isRangeSelection(selection)) {\n      const anchorNode = selection.anchor.getNode();\n      const element =\n        anchorNode.getKey() === 'root'\n          ? anchorNode\n          : anchorNode.getTopLevelElementOrThrow();\n      const elementKey = element.getKey();\n      const elementDOM = activeEditor.getElementByKey(elementKey);\n\n      // Update text format\n      setIsBold(selection.hasFormat('bold'));\n      setIsItalic(selection.hasFormat('italic'));\n      setIsUnderline(selection.hasFormat('underline'));\n      setIsStrikethrough(selection.hasFormat('strikethrough'));\n      setIsSubscript(selection.hasFormat('subscript'));\n      setIsSuperscript(selection.hasFormat('superscript'));\n      setIsCode(selection.hasFormat('code'));\n      setIsRTL($isParentElementRTL(selection));\n\n      // Update links\n      const node = getSelectedNode(selection);\n      const parent = node.getParent();\n      if ($isLinkNode(parent) || $isLinkNode(node)) {\n        setIsLink(true);\n      } else {\n        setIsLink(false);\n      }\n\n      if (elementDOM !== null) {\n        setSelectedElementKey(elementKey);\n        if ($isListNode(element)) {\n          const parentList = $getNearestNodeOfType<ListNode>(\n            anchorNode,\n            ListNode,\n          );\n          const type = parentList\n            ? parentList.getListType()\n            : element.getListType();\n          setBlockType(type);\n        } else {\n          const type = $isHeadingNode(element)\n            ? element.getTag()\n            : element.getType();\n          if (type in blockTypeToBlockName) {\n            setBlockType(type as keyof typeof blockTypeToBlockName);\n          }\n          if ($isCodeNode(element)) {\n            const language =\n              element.getLanguage() as keyof typeof CODE_LANGUAGE_MAP;\n            setCodeLanguage(\n              language ? CODE_LANGUAGE_MAP[language] || language : '',\n            );\n            return;\n          }\n        }\n      }\n      // Handle buttons\n      setFontSize(\n        $getSelectionStyleValueForProperty(selection, 'font-size', '15px'),\n      );\n      setFontColor(\n        $getSelectionStyleValueForProperty(selection, 'color', '#000'),\n      );\n      setBgColor(\n        $getSelectionStyleValueForProperty(\n          selection,\n          'background-color',\n          '#fff',\n        ),\n      );\n      setFontFamily(\n        $getSelectionStyleValueForProperty(selection, 'font-family', 'Arial'),\n      );\n    }\n  }, [activeEditor]);\n\n  useEffect(() => {\n    return editor.registerCommand(\n      SELECTION_CHANGE_COMMAND,\n      (_payload, newEditor) => {\n        updateToolbar();\n        setActiveEditor(newEditor);\n        return false;\n      },\n      COMMAND_PRIORITY_CRITICAL,\n    );\n  }, [editor, updateToolbar]);\n\n  useEffect(() => {\n    return mergeRegister(\n      activeEditor.registerUpdateListener(({editorState}) => {\n        editorState.read(() => {\n          updateToolbar();\n        });\n      }),\n      activeEditor.registerCommand<boolean>(\n        CAN_UNDO_COMMAND,\n        (payload) => {\n          setCanUndo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL,\n      ),\n      activeEditor.registerCommand<boolean>(\n        CAN_REDO_COMMAND,\n        (payload) => {\n          setCanRedo(payload);\n          return false;\n        },\n        COMMAND_PRIORITY_CRITICAL,\n      ),\n    );\n  }, [activeEditor, updateToolbar]);\n\n  const applyStyleText = useCallback(\n    (styles: Record<string, string>) => {\n      activeEditor.update(() => {\n        const selection = $getSelection();\n        if ($isRangeSelection(selection)) {\n          $patchStyleText(selection, styles);\n        }\n      });\n    },\n    [activeEditor],\n  );\n\n  const clearFormatting = useCallback(() => {\n    activeEditor.update(() => {\n      const selection = $getSelection();\n      if ($isRangeSelection(selection)) {\n        $selectAll(selection);\n        selection.getNodes().forEach((node) => {\n          if ($isTextNode(node)) {\n            node.setFormat(0);\n            node.setStyle('');\n            $getNearestBlockElementAncestorOrThrow(node).setFormat('');\n          }\n          if ($isDecoratorBlockNode(node)) {\n            node.setFormat('');\n          }\n        });\n      }\n    });\n  }, [activeEditor]);\n\n  const onFontSizeSelect = useCallback(\n    (e: ChangeEvent) => {\n      applyStyleText({'font-size': (e.target as HTMLSelectElement).value});\n    },\n    [applyStyleText],\n  );\n\n  const onFontColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({color: value});\n    },\n    [applyStyleText],\n  );\n\n  const onBgColorSelect = useCallback(\n    (value: string) => {\n      applyStyleText({'background-color': value});\n    },\n    [applyStyleText],\n  );\n\n  const onFontFamilySelect = useCallback(\n    (e: ChangeEvent) => {\n      applyStyleText({'font-family': (e.target as HTMLSelectElement).value});\n    },\n    [applyStyleText],\n  );\n\n  const insertLink = useCallback(() => {\n    if (!isLink) {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, 'https://');\n    } else {\n      editor.dispatchCommand(TOGGLE_LINK_COMMAND, null);\n    }\n  }, [editor, isLink]);\n\n  const onCodeLanguageSelect = useCallback(\n    (e: ChangeEvent) => {\n      activeEditor.update(() => {\n        if (selectedElementKey !== null) {\n          const node = $getNodeByKey(selectedElementKey);\n          if ($isCodeNode(node)) {\n            node.setLanguage((e.target as HTMLSelectElement).value);\n          }\n        }\n      });\n    },\n    [activeEditor, selectedElementKey],\n  );\n  const insertGifOnClick = (payload: InsertImagePayload) => {\n    activeEditor.dispatchCommand(INSERT_IMAGE_COMMAND, payload);\n  };\n\n  return (\n    <div className=\"toolbar\">\n      <button\n        disabled={!canUndo}\n        onClick={() => {\n          activeEditor.dispatchCommand(UNDO_COMMAND, undefined);\n        }}\n        title={IS_APPLE ? 'Undo (⌘Z)' : 'Undo (Ctrl+Z)'}\n        className=\"toolbar-item spaced\"\n        aria-label=\"Undo\">\n        <i className=\"format undo\" />\n      </button>\n      <button\n        disabled={!canRedo}\n        onClick={() => {\n          activeEditor.dispatchCommand(REDO_COMMAND, undefined);\n        }}\n        title={IS_APPLE ? 'Redo (⌘Y)' : 'Undo (Ctrl+Y)'}\n        className=\"toolbar-item\"\n        aria-label=\"Redo\">\n        <i className=\"format redo\" />\n      </button>\n      <Divider />\n      {blockType in blockTypeToBlockName && activeEditor === editor && (\n        <>\n          <BlockFormatDropDown blockType={blockType} editor={editor} />\n          <Divider />\n        </>\n      )}\n      {blockType === 'code' ? (\n        <>\n          <Select\n            className=\"toolbar-item code-language\"\n            onChange={onCodeLanguageSelect}\n            options={CODE_LANGUAGE_OPTIONS}\n            value={codeLanguage}\n          />\n          <i className=\"chevron-down inside\" />\n        </>\n      ) : (\n        <>\n          <>\n            <Select\n              className=\"toolbar-item font-family\"\n              onChange={onFontFamilySelect}\n              options={[\n                ['Arial', 'Arial'],\n                ['Courier New', 'Courier New'],\n                ['Georgia', 'Georgia'],\n                ['Times New Roman', 'Times New Roman'],\n                ['Trebuchet MS', 'Trebuchet MS'],\n                ['Verdana', 'Verdana'],\n              ]}\n              value={fontFamily}\n            />\n            <i className=\"chevron-down inside\" />\n          </>\n          <>\n            <Select\n              className=\"toolbar-item font-size\"\n              onChange={onFontSizeSelect}\n              options={[\n                ['10px', '10px'],\n                ['11px', '11px'],\n                ['12px', '12px'],\n                ['13px', '13px'],\n                ['14px', '14px'],\n                ['15px', '15px'],\n                ['16px', '16px'],\n                ['17px', '17px'],\n                ['18px', '18px'],\n                ['19px', '19px'],\n                ['20px', '20px'],\n              ]}\n              value={fontSize}\n            />\n            <i className=\"chevron-down inside\" />\n          </>\n          <Divider />\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'bold');\n            }}\n            className={'toolbar-item spaced ' + (isBold ? 'active' : '')}\n            title={IS_APPLE ? 'Bold (⌘B)' : 'Bold (Ctrl+B)'}\n            aria-label={`Format text as bold. Shortcut: ${\n              IS_APPLE ? '⌘B' : 'Ctrl+B'\n            }`}>\n            <i className=\"format bold\" />\n          </button>\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'italic');\n            }}\n            className={'toolbar-item spaced ' + (isItalic ? 'active' : '')}\n            title={IS_APPLE ? 'Italic (⌘I)' : 'Italic (Ctrl+I)'}\n            aria-label={`Format text as italics. Shortcut: ${\n              IS_APPLE ? '⌘I' : 'Ctrl+I'\n            }`}>\n            <i className=\"format italic\" />\n          </button>\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'underline');\n            }}\n            className={'toolbar-item spaced ' + (isUnderline ? 'active' : '')}\n            title={IS_APPLE ? 'Underline (⌘U)' : 'Underline (Ctrl+U)'}\n            aria-label={`Format text to underlined. Shortcut: ${\n              IS_APPLE ? '⌘U' : 'Ctrl+U'\n            }`}>\n            <i className=\"format underline\" />\n          </button>\n          <button\n            onClick={() => {\n              activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'code');\n            }}\n            className={'toolbar-item spaced ' + (isCode ? 'active' : '')}\n            title=\"Insert code block\"\n            aria-label=\"Insert code block\">\n            <i className=\"format code\" />\n          </button>\n          <button\n            onClick={insertLink}\n            className={'toolbar-item spaced ' + (isLink ? 'active' : '')}\n            aria-label=\"Insert link\"\n            title=\"Insert link\">\n            <i className=\"format link\" />\n          </button>\n          {isLink &&\n            createPortal(\n              <FloatingLinkEditor editor={activeEditor} />,\n              document.body,\n            )}\n          <ColorPicker\n            buttonClassName=\"toolbar-item color-picker\"\n            buttonAriaLabel=\"Formatting text color\"\n            buttonIconClassName=\"icon font-color\"\n            color={fontColor}\n            onChange={onFontColorSelect}\n            title=\"text color\"\n          />\n          <ColorPicker\n            buttonClassName=\"toolbar-item color-picker\"\n            buttonAriaLabel=\"Formatting background color\"\n            buttonIconClassName=\"icon bg-color\"\n            color={bgColor}\n            onChange={onBgColorSelect}\n            title=\"bg color\"\n          />\n          <DropDown\n            buttonClassName=\"toolbar-item spaced\"\n            buttonLabel=\"\"\n            buttonAriaLabel=\"Formatting options for additional text styles\"\n            buttonIconClassName=\"icon dropdown-more\">\n            <DropDownItem\n              onClick={() => {\n                activeEditor.dispatchCommand(\n                  FORMAT_TEXT_COMMAND,\n                  'strikethrough',\n                );\n              }}\n              className={'item ' + dropDownActiveClass(isStrikethrough)}\n              title=\"Strikethrough\"\n              aria-label=\"Format text with a strikethrough\">\n              <i className=\"icon strikethrough\" />\n              <span className=\"text\">Strikethrough</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                activeEditor.dispatchCommand(FORMAT_TEXT_COMMAND, 'subscript');\n              }}\n              className={'item ' + dropDownActiveClass(isSubscript)}\n              title=\"Subscript\"\n              aria-label=\"Format text with a subscript\">\n              <i className=\"icon subscript\" />\n              <span className=\"text\">Subscript</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                activeEditor.dispatchCommand(\n                  FORMAT_TEXT_COMMAND,\n                  'superscript',\n                );\n              }}\n              className={'item ' + dropDownActiveClass(isSuperscript)}\n              title=\"Superscript\"\n              aria-label=\"Format text with a superscript\">\n              <i className=\"icon superscript\" />\n              <span className=\"text\">Superscript</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={clearFormatting}\n              className=\"item\"\n              title=\"Clear text formatting\"\n              aria-label=\"Clear all text formatting\">\n              <i className=\"icon clear\" />\n              <span className=\"text\">Clear Formatting</span>\n            </DropDownItem>\n          </DropDown>\n          <Divider />\n          <DropDown\n            buttonClassName=\"toolbar-item spaced\"\n            buttonLabel=\"Insert\"\n            buttonAriaLabel=\"Insert specialized editor node\"\n            buttonIconClassName=\"icon plus\">\n            <DropDownItem\n              onClick={() => {\n                activeEditor.dispatchCommand(\n                  INSERT_HORIZONTAL_RULE_COMMAND,\n                  undefined,\n                );\n              }}\n              className=\"item\">\n              <i className=\"icon horizontal-rule\" />\n              <span className=\"text\">Horizontal Rule</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert Image', (onClose) => (\n                  <InsertImageDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon image\" />\n              <span className=\"text\">Image</span>\n            </DropDownItem>\n            {/* <DropDownItem\n              onClick={() =>\n                insertGifOnClick({\n                  altText: 'Cat typing on a laptop',\n                  src: catTypingGif,\n                })\n              }\n              className=\"item\">\n              <i className=\"icon gif\" />\n              <span className=\"text\">GIF</span>\n            </DropDownItem> */}\n            <DropDownItem\n              onClick={() => {\n                activeEditor.dispatchCommand(\n                  INSERT_EXCALIDRAW_COMMAND,\n                  undefined,\n                );\n              }}\n              className=\"item\">\n              <i className=\"icon diagram-2\" />\n              <span className=\"text\">Excalidraw</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert Table', (onClose) => (\n                  <InsertTableDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon table\" />\n              <span className=\"text\">Table</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert Poll', (onClose) => (\n                  <InsertPollDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon poll\" />\n              <span className=\"text\">Poll</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert Tweet', (onClose) => (\n                  <InsertTweetDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon tweet\" />\n              <span className=\"text\">Tweet</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert YouTube Video', (onClose) => (\n                  <InsertYouTubeDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon youtube\" />\n              <span className=\"text\">YouTube Video</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                showModal('Insert Equation', (onClose) => (\n                  <InsertEquationDialog\n                    activeEditor={activeEditor}\n                    onClose={onClose}\n                  />\n                ));\n              }}\n              className=\"item\">\n              <i className=\"icon equation\" />\n              <span className=\"text\">Equation</span>\n            </DropDownItem>\n            <DropDownItem\n              onClick={() => {\n                editor.update(() => {\n                  const root = $getRoot();\n                  const stickyNode = $createStickyNode(0, 0);\n                  root.append(stickyNode);\n                });\n              }}\n              className=\"item\">\n              <i className=\"icon sticky\" />\n              <span className=\"text\">Sticky Note</span>\n            </DropDownItem>\n          </DropDown>\n        </>\n      )}\n      <Divider />\n      <DropDown\n        buttonLabel=\"Align\"\n        buttonIconClassName=\"icon left-align\"\n        buttonClassName=\"toolbar-item spaced alignment\"\n        buttonAriaLabel=\"Formatting options for text alignment\">\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'left');\n          }}\n          className=\"item\">\n          <i className=\"icon left-align\" />\n          <span className=\"text\">Left Align</span>\n        </DropDownItem>\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'center');\n          }}\n          className=\"item\">\n          <i className=\"icon center-align\" />\n          <span className=\"text\">Center Align</span>\n        </DropDownItem>\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'right');\n          }}\n          className=\"item\">\n          <i className=\"icon right-align\" />\n          <span className=\"text\">Right Align</span>\n        </DropDownItem>\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(FORMAT_ELEMENT_COMMAND, 'justify');\n          }}\n          className=\"item\">\n          <i className=\"icon justify-align\" />\n          <span className=\"text\">Justify Align</span>\n        </DropDownItem>\n        <Divider />\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(OUTDENT_CONTENT_COMMAND, undefined);\n          }}\n          className=\"item\">\n          <i className={'icon ' + (isRTL ? 'indent' : 'outdent')} />\n          <span className=\"text\">Outdent</span>\n        </DropDownItem>\n        <DropDownItem\n          onClick={() => {\n            activeEditor.dispatchCommand(INDENT_CONTENT_COMMAND, undefined);\n          }}\n          className=\"item\">\n          <i className={'icon ' + (isRTL ? 'outdent' : 'indent')} />\n          <span className=\"text\">Indent</span>\n        </DropDownItem>\n      </DropDown>\n\n      {modal}\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\n// import './Placeholder.css';\n\nimport * as React from 'react';\nimport {ReactNode} from 'react';\n\nexport default function Placeholder({\n  children,\n  className,\n}: {\n  children: ReactNode;\n  className?: string;\n}): JSX.Element {\n  return <div className={className || 'Placeholder__root'}>{children}</div>;\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {AutoFocusPlugin} from '@lexical/react/LexicalAutoFocusPlugin';\nimport {CharacterLimitPlugin} from '@lexical/react/LexicalCharacterLimitPlugin';\nimport {CheckListPlugin} from '@lexical/react/LexicalCheckListPlugin';\nimport {ClearEditorPlugin} from '@lexical/react/LexicalClearEditorPlugin';\nimport {CollaborationPlugin} from '@lexical/react/LexicalCollaborationPlugin';\nimport {HashtagPlugin} from '@lexical/react/LexicalHashtagPlugin';\nimport {HistoryPlugin} from '@lexical/react/LexicalHistoryPlugin';\nimport {LinkPlugin} from '@lexical/react/LexicalLinkPlugin';\nimport {ListPlugin} from '@lexical/react/LexicalListPlugin';\nimport {PlainTextPlugin} from '@lexical/react/LexicalPlainTextPlugin';\nimport {RichTextPlugin} from '@lexical/react/LexicalRichTextPlugin';\nimport {TablePlugin} from '@lexical/react/LexicalTablePlugin';\nimport * as React from 'react';\nimport {useRef} from 'react';\n\nimport {createWebsocketProvider} from './collaboration';\nimport {useSettings} from './context/SettingsContext';\nimport {useSharedHistoryContext} from './context/SharedHistoryContext';\nimport ActionsPlugin from './plugins/ActionsPlugin';\nimport AutocompletePlugin from './plugins/AutocompletePlugin';\nimport AutoLinkPlugin from './plugins/AutoLinkPlugin';\nimport ClickableLinkPlugin from './plugins/ClickableLinkPlugin';\nimport CodeHighlightPlugin from './plugins/CodeHighlightPlugin';\n// import CommentPlugin from './plugins/CommentPlugin';\nimport EmojisPlugin from './plugins/EmojisPlugin';\nimport EquationsPlugin from './plugins/EquationsPlugin';\nimport ExcalidrawPlugin from './plugins/ExcalidrawPlugin';\nimport HorizontalRulePlugin from './plugins/HorizontalRulePlugin';\nimport ImagesPlugin from './plugins/ImagesPlugin';\nimport KeywordsPlugin from './plugins/KeywordsPlugin';\nimport ListMaxIndentLevelPlugin from './plugins/ListMaxIndentLevelPlugin';\n// import MarkdownShortcutPlugin from './plugins/MarkdownShortcutPlugin';\nimport {MaxLengthPlugin} from './plugins/MaxLengthPlugin';\nimport MentionsPlugin from './plugins/MentionsPlugin';\nimport PollPlugin from './plugins/PollPlugin';\nimport SpeechToTextPlugin from './plugins/SpeechToTextPlugin';\nimport TabFocusPlugin from './plugins/TabFocusPlugin';\nimport TableCellActionMenuPlugin from './plugins/TableActionMenuPlugin';\nimport TableCellResizer from './plugins/TableCellResizer';\nimport TextFormatFloatingToolbarPlugin from './plugins/TextFormatFloatingToolbarPlugin';\nimport ToolbarPlugin from './plugins/ToolbarPlugin';\n// import TreeViewPlugin from './plugins/TreeViewPlugin';\nimport TwitterPlugin from './plugins/TwitterPlugin';\nimport YouTubePlugin from './plugins/YouTubePlugin';\nimport ContentEditable from './ui/ContentEditable';\nimport Placeholder from './ui/Placeholder';\n\nconst skipCollaborationInit =\n  // @ts-ignore\n  window.parent != null && window.parent.frames.right === window;\n\nexport default function Editor(): JSX.Element {\n  const {historyState} = useSharedHistoryContext();\n  const {\n    settings: {\n      isCollab,\n      isAutocomplete,\n      isMaxLength,\n      isCharLimit,\n      isCharLimitUtf8,\n      isRichText,\n      showTreeView,\n    },\n  } = useSettings();\n  const text = isCollab\n    ? 'Enter some collaborative rich text...'\n    : isRichText\n    ? 'Enter some rich text...'\n    : 'Enter some plain text...';\n  const placeholder = <Placeholder>{text}</Placeholder>;\n  const scrollRef = useRef(null);\n\n  return (\n    <>\n      {isRichText && <ToolbarPlugin />}\n      <div\n        className={`editor-container ${showTreeView ? 'tree-view' : ''} ${\n          !isRichText ? 'plain-text' : ''\n        }`}\n        ref={scrollRef}>\n        {isMaxLength && <MaxLengthPlugin maxLength={30} />}\n        <AutoFocusPlugin />\n        <ClearEditorPlugin />\n        <MentionsPlugin />\n        <EmojisPlugin />\n        <HashtagPlugin />\n        <KeywordsPlugin />\n        <SpeechToTextPlugin />\n        <AutoLinkPlugin />\n        {/* <CommentPlugin\n          providerFactory={isCollab ? createWebsocketProvider : undefined}\n        /> */}\n        {isRichText ? (\n          <>\n   \n            {/* <MarkdownShortcutPlugin /> */}\n            <CodeHighlightPlugin />\n            <ListPlugin />\n            <CheckListPlugin />\n            <ListMaxIndentLevelPlugin maxDepth={7} />\n            <TablePlugin />\n            <TableCellActionMenuPlugin />\n            <TableCellResizer />\n            <ImagesPlugin />\n            <LinkPlugin />\n            <PollPlugin />\n            <TwitterPlugin />\n            <YouTubePlugin />\n            <ClickableLinkPlugin />\n            <HorizontalRulePlugin />\n            <TextFormatFloatingToolbarPlugin />\n            <EquationsPlugin />\n            <ExcalidrawPlugin />\n            <TabFocusPlugin />\n          </>\n        ) : (\n          <>\n        \n            <HistoryPlugin externalHistoryState={historyState} />\n          </>\n        )}\n   \n        {isAutocomplete && <AutocompletePlugin />}\n        <ActionsPlugin isRichText={isRichText} />\n      </div>\n      {/* {showTreeView && <TreeViewPlugin />} */}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {Klass, LexicalNode} from 'lexical';\n\nimport {CodeHighlightNode, CodeNode} from '@lexical/code';\nimport {HashtagNode} from '@lexical/hashtag';\nimport {AutoLinkNode, LinkNode} from '@lexical/link';\nimport {ListItemNode, ListNode} from '@lexical/list';\nimport {MarkNode} from '@lexical/mark';\nimport {OverflowNode} from '@lexical/overflow';\nimport {HorizontalRuleNode} from '@lexical/react/LexicalHorizontalRuleNode';\nimport {HeadingNode, QuoteNode} from '@lexical/rich-text';\nimport {TableCellNode, TableNode, TableRowNode} from '@lexical/table';\n\nimport {AutocompleteNode} from './AutocompleteNode';\nimport {EmojiNode} from './EmojiNode';\nimport {EquationNode} from './EquationNode';\nimport {ExcalidrawNode} from './ExcalidrawNode';\nimport {ImageNode} from './ImageNode';\nimport {KeywordNode} from './KeywordNode';\nimport {MentionNode} from './MentionNode';\nimport {PollNode} from './PollNode';\nimport {StickyNode} from './StickyNode';\nimport {TweetNode} from './TweetNode';\nimport {TypeaheadNode} from './TypeaheadNode';\nimport {YouTubeNode} from './YouTubeNode';\n\nconst PlaygroundNodes: Array<Klass<LexicalNode>> = [\n  HeadingNode,\n  ListNode,\n  ListItemNode,\n  QuoteNode,\n  CodeNode,\n  TableNode,\n  TableCellNode,\n  TableRowNode,\n  HashtagNode,\n  CodeHighlightNode,\n  AutoLinkNode,\n  LinkNode,\n  OverflowNode,\n  PollNode,\n  StickyNode,\n  ImageNode,\n  MentionNode,\n  EmojiNode,\n  ExcalidrawNode,\n  EquationNode,\n  AutocompleteNode,\n  TypeaheadNode,\n  KeywordNode,\n  HorizontalRuleNode,\n  TweetNode,\n  YouTubeNode,\n  MarkNode,\n];\n\nexport default PlaygroundNodes;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {Spread} from 'lexical';\n\nimport {EditorConfig, SerializedTextNode, TextNode} from 'lexical';\n\nexport type SerializedTypeaheadNode = Spread<\n  {\n    type: 'typeahead';\n    version: 1;\n  },\n  SerializedTextNode\n>;\n\nexport class TypeaheadNode extends TextNode {\n  static clone(node: TypeaheadNode): TypeaheadNode {\n    return new TypeaheadNode(node.__text, node.__key);\n  }\n\n  static getType(): 'typeahead' {\n    return 'typeahead';\n  }\n\n  // static importJSON(serializedNode: SerializedTypeaheadNode): TypeaheadNode {\n  //   // const node = $createTypeaheadNode(serializedNode.text);\n  //   node.setFormat(serializedNode.format);\n  //   node.setDetail(serializedNode.detail);\n  //   node.setMode(serializedNode.mode);\n  //   node.setStyle(serializedNode.style);\n  //   return node;\n  // }\n\n  exportJSON(): SerializedTypeaheadNode {\n    return {\n      ...super.exportJSON(),\n      type: 'typeahead',\n      version: 1,\n    };\n  }\n\n  createDOM(config: EditorConfig): HTMLElement {\n    const dom = super.createDOM(config);\n    dom.style.cssText = 'color: #ccc;';\n    return dom;\n  }\n}\n\n// export function $createTypeaheadNode(text: string): TypeaheadNode {\n//   return new TypeaheadNode(text).setMode('inert');\n// }\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {\n  GridSelection,\n  LexicalEditor,\n  NodeSelection,\n  RangeSelection,\n} from 'lexical';\n\nimport {useLexicalComposerContext} from '@lexical/react/LexicalComposerContext';\nimport {$createParagraphNode, $createTextNode, $getRoot} from 'lexical';\nimport * as React from 'react';\nimport {useCallback, useEffect, useRef, useState} from 'react';\nimport {IS_APPLE} from '../shared/src/environment';\nimport useLayoutEffect from '../shared/src/useLayoutEffect';\n\nconst copy = (text: string | null) => {\n  const textArea = document.createElement('textarea');\n  textArea.value = text || '';\n  textArea.style.position = 'absolute';\n  textArea.style.opacity = '0';\n  document.body?.appendChild(textArea);\n  textArea.focus();\n  textArea.select();\n  try {\n    const result = document.execCommand('copy');\n    // eslint-disable-next-line no-console\n    console.log(result);\n  } catch (error) {\n    console.error(error);\n  }\n  document.body?.removeChild(textArea);\n};\n\nconst download = (filename: string, text: string | null) => {\n  const a = document.createElement('a');\n  a.setAttribute(\n    'href',\n    'data:text/plain;charset=utf-8,' + encodeURIComponent(text || ''),\n  );\n  a.setAttribute('download', filename);\n  a.style.display = 'none';\n  document.body?.appendChild(a);\n  a.click();\n  document.body?.removeChild(a);\n};\n\nconst formatStep = (step: Step) => {\n  const formatOneStep = (name: string, value: Step['value']) => {\n    switch (name) {\n      case 'click': {\n        return `      await page.mouse.click(${value.x}, ${value.y});`;\n      }\n      case 'press': {\n        return `      await page.keyboard.press('${value}');`;\n      }\n      case 'keydown': {\n        return `      await page.keyboard.keydown('${value}');`;\n      }\n      case 'keyup': {\n        return `      await page.keyboard.keyup('${value}');`;\n      }\n      case 'type': {\n        return `      await page.keyboard.type('${value}');`;\n      }\n      case 'selectAll': {\n        return `      await selectAll(page);`;\n      }\n      case 'snapshot': {\n        return `      await assertHTMLSnapshot(page);\n      await assertSelection(page, {\n        anchorPath: [${value.anchorPath.toString()}],\n        anchorOffset: ${value.anchorOffset},\n        focusPath: [${value.focusPath.toString()}],\n        focusOffset: ${value.focusOffset},\n      });\n`;\n      }\n      default:\n        return ``;\n    }\n  };\n  const formattedStep = formatOneStep(step.name, step.value);\n  switch (step.count) {\n    case 1:\n      return formattedStep;\n    case 2:\n      return [formattedStep, formattedStep].join(`\\n`);\n    default:\n      return `      await repeat(${step.count}, async () => {\n  ${formattedStep}\n      );`;\n  }\n};\n\nexport function isSelectAll(event: KeyboardEvent): boolean {\n  return event.keyCode === 65 && (IS_APPLE ? event.metaKey : event.ctrlKey);\n}\n\n// stolen from LexicalSelection-test\nfunction sanitizeSelection(selection: Selection) {\n  const {anchorNode, focusNode} = selection;\n  let {anchorOffset, focusOffset} = selection;\n  if (anchorOffset !== 0) {\n    anchorOffset--;\n  }\n  if (focusOffset !== 0) {\n    focusOffset--;\n  }\n  return {anchorNode, anchorOffset, focusNode, focusOffset};\n}\n\nfunction getPathFromNodeToEditor(node: Node, rootElement: HTMLElement | null) {\n  let currentNode: Node | null | undefined = node;\n  const path = [];\n  while (currentNode !== rootElement) {\n    if (currentNode !== null && currentNode !== undefined) {\n      path.unshift(\n        Array.from(currentNode?.parentNode?.childNodes ?? []).indexOf(\n          currentNode as ChildNode,\n        ),\n      );\n    }\n    currentNode = currentNode?.parentNode;\n  }\n  return path;\n}\n\nconst keyPresses = new Set([\n  'Enter',\n  'Backspace',\n  'Delete',\n  'Escape',\n  'ArrowLeft',\n  'ArrowRight',\n  'ArrowUp',\n  'ArrowDown',\n]);\n\ntype Step = {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  value: any;\n  count: number;\n  name: string;\n};\n\ntype Steps = Step[];\n\nfunction useTestRecorder(\n  editor: LexicalEditor,\n): [JSX.Element, JSX.Element | null] {\n  const [steps, setSteps] = useState<Steps>([]);\n  const [isRecording, setIsRecording] = useState(false);\n  const [, setCurrentInnerHTML] = useState('');\n  const [templatedTest, setTemplatedTest] = useState('');\n  const previousSelectionRef = useRef<\n    RangeSelection | GridSelection | NodeSelection | null\n  >(null);\n  const skipNextSelectionChangeRef = useRef(false);\n  const preRef = useRef<HTMLPreElement>(null);\n\n  const getCurrentEditor = useCallback(() => {\n    return editor;\n  }, [editor]);\n\n  const generateTestContent = useCallback(() => {\n    const rootElement = editor.getRootElement();\n    const browserSelection = window.getSelection();\n\n    if (\n      rootElement == null ||\n      browserSelection == null ||\n      browserSelection.anchorNode == null ||\n      browserSelection.focusNode == null ||\n      !rootElement.contains(browserSelection.anchorNode) ||\n      !rootElement.contains(browserSelection.focusNode)\n    ) {\n      return null;\n    }\n\n    return `\n/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {\n  initializeE2E,\n  assertHTMLSnapshot,\n  assertSelection,\n  repeat,\n} from '../utils';\nimport {selectAll} from '../keyboardShortcuts';\nimport { RangeSelection } from 'lexical';\nimport { NodeSelection } from 'lexical';\n\ndescribe('Test case', () => {\n  initializeE2E((e2e) => {\n    it('Should pass this test', async () => {\n      const {page} = e2e;\n\n      await page.focus('div[contenteditable=\"true\"]');\n${steps.map(formatStep).join(`\\n`)}\n    });\n});\n    `;\n  }, [editor, steps]);\n\n  // just a wrapper around inserting new actions so that we can\n  // coalesce some actions like insertText/moveNativeSelection\n  const pushStep = useCallback(\n    (name: string, value: Step['value']) => {\n      setSteps((currentSteps) => {\n        // trying to group steps\n        const currentIndex = steps.length - 1;\n        const lastStep = steps[currentIndex];\n        if (lastStep) {\n          if (lastStep.name === name) {\n            if (name === 'type') {\n              // for typing events we just append the text\n              return [\n                ...steps.slice(0, currentIndex),\n                {...lastStep, value: lastStep.value + value},\n              ];\n            } else {\n              // for other events we bump the counter if their values are the same\n              if (lastStep.value === value) {\n                return [\n                  ...steps.slice(0, currentIndex),\n                  {...lastStep, count: lastStep.count + 1},\n                ];\n              }\n            }\n          }\n        }\n        // could not group, just append a new one\n        return [...currentSteps, {count: 1, name, value}];\n      });\n    },\n    [steps, setSteps],\n  );\n\n  useLayoutEffect(() => {\n    const onKeyDown = (event: KeyboardEvent) => {\n      if (!isRecording) {\n        return;\n      }\n      const key = event.key;\n      if (isSelectAll(event)) {\n        pushStep('selectAll', '');\n      } else if (keyPresses.has(key)) {\n        pushStep('press', event.key);\n      } else if ([...key].length > 1) {\n        pushStep('keydown', event.key);\n      } else {\n        pushStep('type', event.key);\n      }\n    };\n\n    const onKeyUp = (event: KeyboardEvent) => {\n      if (!isRecording) {\n        return;\n      }\n      const key = event.key;\n      if (!keyPresses.has(key) && [...key].length > 1) {\n        pushStep('keyup', event.key);\n      }\n    };\n\n    return editor.registerRootListener(\n      (\n        rootElement: null | HTMLElement,\n        prevRootElement: null | HTMLElement,\n      ) => {\n        if (prevRootElement !== null) {\n          prevRootElement.removeEventListener('keydown', onKeyDown);\n          prevRootElement.removeEventListener('keyup', onKeyUp);\n        }\n        if (rootElement !== null) {\n          rootElement.addEventListener('keydown', onKeyDown);\n          rootElement.addEventListener('keyup', onKeyUp);\n        }\n      },\n    );\n  }, [editor, isRecording, pushStep]);\n\n  useLayoutEffect(() => {\n    if (preRef.current) {\n      preRef.current.scrollTo(0, preRef.current.scrollHeight);\n    }\n  }, [generateTestContent]);\n\n  useEffect(() => {\n    if (steps) {\n      const testContent = generateTestContent();\n      if (testContent !== null) {\n        setTemplatedTest(testContent);\n      }\n      if (preRef.current) {\n        preRef.current.scrollTo(0, preRef.current.scrollHeight);\n      }\n    }\n  }, [generateTestContent, steps]);\n\n  useEffect(() => {\n    const removeUpdateListener = editor.registerUpdateListener(\n      ({editorState, dirtyLeaves, dirtyElements}) => {\n        if (!isRecording) {\n          return;\n        }\n        const currentSelection = editorState._selection;\n        const previousSelection = previousSelectionRef.current;\n        const skipNextSelectionChange = skipNextSelectionChangeRef.current;\n        if (previousSelection !== currentSelection) {\n          if (\n            dirtyLeaves.size === 0 &&\n            dirtyElements.size === 0 &&\n            !skipNextSelectionChange\n          ) {\n            const browserSelection = window.getSelection();\n            if (\n              browserSelection &&\n              (browserSelection.anchorNode == null ||\n                browserSelection.focusNode == null)\n            ) {\n              return;\n            }\n          }\n          // previousSelectionRef.current = currentSelection;\n        }\n        skipNextSelectionChangeRef.current = false;\n        const testContent = generateTestContent();\n        if (testContent !== null) {\n          setTemplatedTest(testContent);\n        }\n      },\n    );\n    return removeUpdateListener;\n  }, [editor, generateTestContent, isRecording, pushStep]);\n\n  // save innerHTML\n  useEffect(() => {\n    if (!isRecording) {\n      return;\n    }\n    const removeUpdateListener = editor.registerUpdateListener(() => {\n      const rootElement = editor.getRootElement();\n      if (rootElement !== null) {\n        setCurrentInnerHTML(rootElement?.innerHTML);\n      }\n    });\n    return removeUpdateListener;\n  }, [editor, isRecording]);\n\n  // clear editor and start recording\n  const toggleEditorSelection = useCallback(\n    (currentEditor: LexicalEditor) => {\n      if (!isRecording) {\n        currentEditor.update(() => {\n          const root = $getRoot();\n          root.clear();\n          const text = $createTextNode();\n          root.append($createParagraphNode().append(text));\n          text.select();\n        });\n        setSteps([]);\n      }\n      setIsRecording((currentIsRecording) => !currentIsRecording);\n    },\n    [isRecording],\n  );\n\n  const onSnapshotClick = useCallback(() => {\n    if (!isRecording) {\n      return;\n    }\n    const browserSelection = window.getSelection();\n    if (\n      browserSelection === null ||\n      browserSelection.anchorNode == null ||\n      browserSelection.focusNode == null\n    ) {\n      return;\n    }\n    const {anchorNode, anchorOffset, focusNode, focusOffset} =\n      sanitizeSelection(browserSelection);\n    const rootElement = getCurrentEditor().getRootElement();\n    let anchorPath;\n    if (anchorNode !== null) {\n      anchorPath = getPathFromNodeToEditor(anchorNode, rootElement);\n    }\n    let focusPath;\n    if (focusNode !== null) {\n      focusPath = getPathFromNodeToEditor(focusNode, rootElement);\n    }\n    pushStep('snapshot', {\n      anchorNode,\n      anchorOffset,\n      anchorPath,\n      focusNode,\n      focusOffset,\n      focusPath,\n    });\n  }, [pushStep, isRecording, getCurrentEditor]);\n\n  const onCopyClick = useCallback(() => {\n    copy(generateTestContent());\n  }, [generateTestContent]);\n\n  const onDownloadClick = useCallback(() => {\n    download('test.js', generateTestContent());\n  }, [generateTestContent]);\n\n  const button = (\n    <button\n      id=\"test-recorder-button\"\n      className={`editor-dev-button ${isRecording ? 'active' : ''}`}\n      onClick={() => toggleEditorSelection(getCurrentEditor())}\n      title={isRecording ? 'Disable test recorder' : 'Enable test recorder'}\n    />\n  );\n  const output = isRecording ? (\n    <div className=\"test-recorder-output\">\n      <div className=\"test-recorder-toolbar\">\n        <button\n          className=\"test-recorder-button\"\n          id=\"test-recorder-button-snapshot\"\n          title=\"Insert snapshot\"\n          onClick={onSnapshotClick}\n        />\n        <button\n          className=\"test-recorder-button\"\n          id=\"test-recorder-button-copy\"\n          title=\"Copy to clipboard\"\n          onClick={onCopyClick}\n        />\n        <button\n          className=\"test-recorder-button\"\n          id=\"test-recorder-button-download\"\n          title=\"Download as a file\"\n          onClick={onDownloadClick}\n        />\n      </div>\n      <pre id=\"test-recorder\" ref={preRef}>\n        {templatedTest}\n      </pre>\n    </div>\n  ) : null;\n\n  return [button, output];\n}\n\nexport default function TestRecorderPlugin(): JSX.Element {\n  const [editor] = useLexicalComposerContext();\n  const [testRecorderButton, testRecorderOutput] = useTestRecorder(editor);\n\n  return (\n    <>\n      {testRecorderButton}\n      {testRecorderOutput}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport * as React from 'react';\nimport {useMemo} from 'react';\n\nexport default function Switch({\n  checked,\n  onClick,\n  text,\n  id,\n}: Readonly<{\n  checked: boolean;\n  id?: string;\n  onClick: (e: React.MouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  text: string;\n}>): JSX.Element {\n  const buttonId = useMemo(() => 'id_' + Math.floor(Math.random() * 10000), []);\n  return (\n    <div className=\"switch\" id={id}>\n      <label htmlFor={buttonId}>{text}</label>\n      <button\n        role=\"switch\"\n        aria-checked={checked}\n        id={buttonId}\n        onClick={onClick}>\n        <span />\n      </button>\n    </div>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport * as React from 'react';\nimport {useMemo, useState} from 'react';\n\nimport {isDevPlayground} from './appSettings';\nimport {useSettings} from './context/SettingsContext';\nimport Switch from './ui/Switch';\n\nexport default function Settings(): JSX.Element {\n  const windowLocation = window.location;\n  const {\n    setOption,\n    settings: {\n      measureTypingPerf,\n      isCollab,\n      isRichText,\n      isMaxLength,\n      isCharLimit,\n      isCharLimitUtf8,\n      isAutocomplete,\n      showTreeView,\n      showNestedEditorTreeView,\n      disableBeforeInput,\n    },\n  } = useSettings();\n  const [showSettings, setShowSettings] = useState(false);\n  const [isSplitScreen, search] = useMemo(() => {\n    const parentWindow = window.parent;\n    const _search = windowLocation.search;\n    const _isSplitScreen =\n      parentWindow && parentWindow.location.pathname === '/split/';\n    return [_isSplitScreen, _search];\n  }, [windowLocation]);\n\n  return (\n    <>\n      <button\n        id=\"options-button\"\n        className={`editor-dev-button ${showSettings ? 'active' : ''}`}\n        onClick={() => setShowSettings(!showSettings)}\n      />\n      {showSettings ? (\n        <div className=\"switches\">\n          {isRichText && isDevPlayground && (\n            <Switch\n              onClick={() => {\n                setOption('isCollab', !isCollab);\n                window.location.reload();\n              }}\n              checked={isCollab}\n              text=\"Collaboration\"\n            />\n          )}\n          {isDevPlayground && (\n            <Switch\n              onClick={() => {\n                if (isSplitScreen) {\n                  window.parent.location.href = `/${search}`;\n                } else {\n                  window.location.href = `/split/${search}`;\n                }\n              }}\n              checked={isSplitScreen}\n              text=\"Split Screen\"\n            />\n          )}\n          <Switch\n            onClick={() => setOption('measureTypingPerf', !measureTypingPerf)}\n            checked={measureTypingPerf}\n            text=\"Measure Perf\"\n          />\n          <Switch\n            onClick={() => setOption('showTreeView', !showTreeView)}\n            checked={showTreeView}\n            text=\"Debug View\"\n          />\n          <Switch\n            onClick={() =>\n              setOption('showNestedEditorTreeView', !showNestedEditorTreeView)\n            }\n            checked={showNestedEditorTreeView}\n            text=\"Nested Editors Debug View\"\n          />\n          <Switch\n            onClick={() => {\n              setOption('isRichText', !isRichText);\n              setOption('isCollab', false);\n            }}\n            checked={isRichText}\n            text=\"Rich Text\"\n          />\n          <Switch\n            onClick={() => setOption('isCharLimit', !isCharLimit)}\n            checked={isCharLimit}\n            text=\"Char Limit\"\n          />\n          <Switch\n            onClick={() => setOption('isCharLimitUtf8', !isCharLimitUtf8)}\n            checked={isCharLimitUtf8}\n            text=\"Char Limit (UTF-8)\"\n          />\n          <Switch\n            onClick={() => setOption('isMaxLength', !isMaxLength)}\n            checked={isMaxLength}\n            text=\"Max Length\"\n          />\n          <Switch\n            onClick={() => setOption('isAutocomplete', !isAutocomplete)}\n            checked={isAutocomplete}\n            text=\"Autocomplete\"\n          />\n          <Switch\n            onClick={() => {\n              setOption('disableBeforeInput', !disableBeforeInput);\n              setTimeout(() => window.location.reload(), 500);\n            }}\n            checked={disableBeforeInput}\n            text=\"Legacy Events\"\n          />\n        </div>\n      ) : null}\n    </>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport type {EditorThemeClasses} from 'lexical';\n\n// import './PlaygroundEditorTheme.css';\n\nconst theme: EditorThemeClasses = {\n  characterLimit: 'PlaygroundEditorTheme__characterLimit',\n  code: 'PlaygroundEditorTheme__code',\n  codeHighlight: {\n    atrule: 'PlaygroundEditorTheme__tokenAttr',\n    attr: 'PlaygroundEditorTheme__tokenAttr',\n    boolean: 'PlaygroundEditorTheme__tokenProperty',\n    builtin: 'PlaygroundEditorTheme__tokenSelector',\n    cdata: 'PlaygroundEditorTheme__tokenComment',\n    char: 'PlaygroundEditorTheme__tokenSelector',\n    class: 'PlaygroundEditorTheme__tokenFunction',\n    'class-name': 'PlaygroundEditorTheme__tokenFunction',\n    comment: 'PlaygroundEditorTheme__tokenComment',\n    constant: 'PlaygroundEditorTheme__tokenProperty',\n    deleted: 'PlaygroundEditorTheme__tokenProperty',\n    doctype: 'PlaygroundEditorTheme__tokenComment',\n    entity: 'PlaygroundEditorTheme__tokenOperator',\n    function: 'PlaygroundEditorTheme__tokenFunction',\n    important: 'PlaygroundEditorTheme__tokenVariable',\n    inserted: 'PlaygroundEditorTheme__tokenSelector',\n    keyword: 'PlaygroundEditorTheme__tokenAttr',\n    namespace: 'PlaygroundEditorTheme__tokenVariable',\n    number: 'PlaygroundEditorTheme__tokenProperty',\n    operator: 'PlaygroundEditorTheme__tokenOperator',\n    prolog: 'PlaygroundEditorTheme__tokenComment',\n    property: 'PlaygroundEditorTheme__tokenProperty',\n    punctuation: 'PlaygroundEditorTheme__tokenPunctuation',\n    regex: 'PlaygroundEditorTheme__tokenVariable',\n    selector: 'PlaygroundEditorTheme__tokenSelector',\n    string: 'PlaygroundEditorTheme__tokenSelector',\n    symbol: 'PlaygroundEditorTheme__tokenProperty',\n    tag: 'PlaygroundEditorTheme__tokenProperty',\n    url: 'PlaygroundEditorTheme__tokenOperator',\n    variable: 'PlaygroundEditorTheme__tokenVariable',\n  },\n  embedBlock: {\n    base: 'PlaygroundEditorTheme__embedBlock',\n    focus: 'PlaygroundEditorTheme__embedBlockFocus',\n  },\n  hashtag: 'PlaygroundEditorTheme__hashtag',\n  heading: {\n    h1: 'PlaygroundEditorTheme__h1',\n    h2: 'PlaygroundEditorTheme__h2',\n    h3: 'PlaygroundEditorTheme__h3',\n    h4: 'PlaygroundEditorTheme__h4',\n    h5: 'PlaygroundEditorTheme__h5',\n    h6: 'PlaygroundEditorTheme__h6',\n  },\n  image: 'editor-image',\n  link: 'PlaygroundEditorTheme__link',\n  list: {\n    listitem: 'PlaygroundEditorTheme__listItem',\n    listitemChecked: 'PlaygroundEditorTheme__listItemChecked',\n    listitemUnchecked: 'PlaygroundEditorTheme__listItemUnchecked',\n    nested: {\n      listitem: 'PlaygroundEditorTheme__nestedListItem',\n    },\n    olDepth: [\n      'PlaygroundEditorTheme__ol1',\n      'PlaygroundEditorTheme__ol2',\n      'PlaygroundEditorTheme__ol3',\n      'PlaygroundEditorTheme__ol4',\n      'PlaygroundEditorTheme__ol5',\n    ],\n    ul: 'PlaygroundEditorTheme__ul',\n  },\n  ltr: 'PlaygroundEditorTheme__ltr',\n  mark: 'PlaygroundEditorTheme__mark',\n  markOverlap: 'PlaygroundEditorTheme__markOverlap',\n  paragraph: 'PlaygroundEditorTheme__paragraph',\n  quote: 'PlaygroundEditorTheme__quote',\n  rtl: 'PlaygroundEditorTheme__rtl',\n  table: 'PlaygroundEditorTheme__table',\n  tableCell: 'PlaygroundEditorTheme__tableCell',\n  tableCellHeader: 'PlaygroundEditorTheme__tableCellHeader',\n  text: {\n    bold: 'PlaygroundEditorTheme__textBold',\n    code: 'PlaygroundEditorTheme__textCode',\n    italic: 'PlaygroundEditorTheme__textItalic',\n    strikethrough: 'PlaygroundEditorTheme__textStrikethrough',\n    subscript: 'PlaygroundEditorTheme__textSubscript',\n    superscript: 'PlaygroundEditorTheme__textSuperscript',\n    underline: 'PlaygroundEditorTheme__textUnderline',\n    underlineStrikethrough: 'PlaygroundEditorTheme__textUnderlineStrikethrough',\n  },\n};\n\nexport default theme;\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {$createLinkNode} from '@lexical/link';\nimport {$createListItemNode, $createListNode} from '@lexical/list';\nimport {LexicalComposer} from '@lexical/react/LexicalComposer';\nimport {$createHeadingNode, $createQuoteNode} from '@lexical/rich-text';\nimport {$createParagraphNode, $createTextNode, $getRoot} from 'lexical';\nimport * as React from 'react';\n\nimport {isDevPlayground} from './appSettings';\nimport {SettingsContext, useSettings} from './context/SettingsContext';\n// import {SharedAutocompleteContext} from './context/SharedAutocompleteContext';\nimport {SharedHistoryContext} from './context/SharedHistoryContext';\nimport Editor from './Editor';\n// import logo from './images/logo.svg';\nimport PlaygroundNodes from './nodes/PlaygroundNodes';\nimport TestRecorderPlugin from './plugins/TestRecorderPlugin';\n// import TypingPerfPlugin from './plugins/TypingPerfPlugin';\nimport Settings from './Settings';\nimport PlaygroundEditorTheme from './themes/PlaygroundEditorTheme';\n\nconsole.warn(\n  'If you are profiling the playground app, please ensure you turn off the debug view. You can disable it by pressing on the settings control in the bottom-left of your screen and toggling the debug view setting.',\n);\n\nfunction prepopulatedRichText() {\n  const root = $getRoot();\n  if (root.getFirstChild() === null) {\n    const heading = $createHeadingNode('h1');\n    heading.append($createTextNode('Welcome to the playground'));\n    root.append(heading);\n    const quote = $createQuoteNode();\n    quote.append(\n      $createTextNode(\n        `In case you were wondering what the black box at the bottom is – it's the debug view, showing the current state of editor. ` +\n          `You can disable it by pressing on the settings control in the bottom-left of your screen and toggling the debug view setting.`,\n      ),\n    );\n    root.append(quote);\n    const paragraph = $createParagraphNode();\n    paragraph.append(\n      $createTextNode('The playground is a demo environment built with '),\n      $createTextNode('@lexical/react').toggleFormat('code'),\n      $createTextNode('.'),\n      $createTextNode(' Try typing in '),\n      $createTextNode('some text').toggleFormat('bold'),\n      $createTextNode(' with '),\n      $createTextNode('different').toggleFormat('italic'),\n      $createTextNode(' formats.'),\n    );\n    root.append(paragraph);\n    const paragraph2 = $createParagraphNode();\n    paragraph2.append(\n      $createTextNode(\n        'Make sure to check out the various plugins in the toolbar. You can also use #hashtags or @-mentions too!',\n      ),\n    );\n    root.append(paragraph2);\n    const paragraph3 = $createParagraphNode();\n    paragraph3.append(\n      $createTextNode(`If you'd like to find out more about Lexical, you can:`),\n    );\n    root.append(paragraph3);\n    const list = $createListNode('bullet');\n    list.append(\n      $createListItemNode().append(\n        $createTextNode(`Visit the `),\n        $createLinkNode('https://lexical.dev/').append(\n          $createTextNode('Lexical website'),\n        ),\n        $createTextNode(` for documentation and more information.`),\n      ),\n      $createListItemNode().append(\n        $createTextNode(`Check out the code on our `),\n        $createLinkNode('https://github.com/facebook/lexical').append(\n          $createTextNode('GitHub repository'),\n        ),\n        $createTextNode(`.`),\n      ),\n      $createListItemNode().append(\n        $createTextNode(`Playground code can be found `),\n        $createLinkNode(\n          'https://github.com/facebook/lexical/tree/main/packages/lexical-playground',\n        ).append($createTextNode('here')),\n        $createTextNode(`.`),\n      ),\n      $createListItemNode().append(\n        $createTextNode(`Join our `),\n        $createLinkNode('https://discord.com/invite/KmG4wQnnD9').append(\n          $createTextNode('Discord Server'),\n        ),\n        $createTextNode(` and chat with the team.`),\n      ),\n    );\n    root.append(list);\n    const paragraph4 = $createParagraphNode();\n    paragraph4.append(\n      $createTextNode(\n        `Lastly, we're constantly adding cool new features to this playground. So make sure you check back here when you next get a chance :).`,\n      ),\n    );\n    root.append(paragraph4);\n  }\n}\n\nfunction App(): JSX.Element {\n  const {\n    settings: {isCollab, emptyEditor, measureTypingPerf},\n  } = useSettings();\n\n  const initialConfig = {\n    editorState: isCollab\n      ? null\n      : emptyEditor\n      ? undefined\n      : prepopulatedRichText,\n    namespace: 'Playground',\n    nodes: [...PlaygroundNodes],\n    onError: (error: Error) => {\n      throw error;\n    },\n    theme: PlaygroundEditorTheme,\n  };\n\n  return (\n    <LexicalComposer initialConfig={initialConfig}>\n      <SharedHistoryContext>\n       \n          <header>\n            <a href=\"https://lexical.dev\" target=\"_blank\" rel=\"noopener\">\n              {/* <img src={logo} alt=\"Lexical Logo\" /> */}\n            </a>\n          </header>\n          <div className=\"editor-shell\">\n            <Editor />\n          </div>\n          <Settings />\n          {isDevPlayground ? <TestRecorderPlugin /> : null}\n          {/* {measureTypingPerf ? <TypingPerfPlugin /> : null} */}\n  \n      </SharedHistoryContext>\n    </LexicalComposer>\n  );\n}\n\nexport default function PlaygroundApp(): JSX.Element {\n  return (\n    <SettingsContext>\n      <App />\n      <a\n        href=\"https://github.com/facebook/lexical/tree/main/packages/lexical-playground\"\n        className=\"github-corner\"\n        aria-label=\"View source on GitHub\">\n        <svg\n          width=\"80\"\n          height=\"80\"\n          viewBox=\"0 0 250 250\"\n          style={{\n            border: '0',\n            color: '#eee',\n            fill: '#222',\n            left: '0',\n            position: 'absolute',\n            top: '0',\n            transform: 'scale(-1,1)',\n          }}\n          aria-hidden=\"true\">\n          <path d=\"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z\" />\n          <path\n            d=\"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2\"\n            fill=\"currentColor\"\n            style={{\n              transformOrigin: '130px 106px',\n            }}\n            className=\"octo-arm\"\n          />\n          <path\n            d=\"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z\"\n            fill=\"currentColor\"\n            className=\"octo-body\"\n          />\n        </svg>\n      </a>\n    </SettingsContext>\n  );\n}\n","/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport './setupEnv';\n// import './index.css';\n\nimport * as React from 'react';\nimport {createRoot} from 'react-dom/client';\n\nimport App from './App';\n\n// Handle runtime errors\nconst showErrorOverlay = (err: Event) => {\n  const ErrorOverlay = customElements.get('vite-error-overlay');\n  if (!ErrorOverlay) {\n    return;\n  }\n  const overlay = new ErrorOverlay(err);\n  const body = document.body;\n  if (body !== null) {\n    body.appendChild(overlay);\n  }\n};\n\nwindow.addEventListener('error', showErrorOverlay);\nwindow.addEventListener('unhandledrejection', ({reason}) =>\n  showErrorOverlay(reason),\n);\n\ncreateRoot(document.getElementById('root') as HTMLElement).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n);\n"],"names":["hostName","window","location","hostname","isDevPlayground","DEFAULT_SETTINGS","disableBeforeInput","emptyEditor","isAutocomplete","isCharLimit","isCharLimitUtf8","isCollab","isMaxLength","isRichText","measureTypingPerf","showNestedEditorTreeView","showTreeView","urlSearchParams","URLSearchParams","search","_i","_Object$keys","Object","keys","length","param","has","_urlSearchParams$get","value","JSON","parse","get","Boolean","error","console","warn","InputEvent","prototype","getTargetRanges","Context","createContext","setOption","name","settings","SettingsContext","_ref","children","_useState","useState","setSettings","useCallback","setting","options","_extends2","_extends","url","URL","href","params","set","String","append","toString","history","pushState","setURLParam","contextValue","useMemo","React","Provider","useSettings","useContext","SharedHistoryContext","historyContext","historyState","createEmptyHistoryState","useSharedHistoryContext","PortalImpl","onClose","title","closeOnClickOutside","modalRef","useRef","useEffect","current","focus","_modalRef$current","_modalOverlayElement","modalOverlayElement","handler","event","keyCode","clickOutsideHandler","contains","target","parentElement","addEventListener","_modalOverlayElement2","removeEventListener","className","role","tabIndex","ref","type","onClick","Modal","_ref2","_ref2$closeOnClickOut","createPortal","document","body","useModal","modalContent","setModalContent","content","getContent","joinClasses","args","Array","_len","_key","arguments","filter","join","Button","dataTestId","disabled","small","data-test-id","ActionsPlugin","editor","useLexicalComposerContext","_useState3","isEditorEmpty","setIsEditorEmpty","_useModal","modal","showModal","registerUpdateListener","getEditorState","read","$getRoot","getChildren","$isParagraphNode","paragraphChildren","handleMarkdownToggle","update","root","firstChild","getFirstChild","$isCodeNode","getLanguage","selectEnd","ShowClearDialog","AutocompleteNode","_DecoratorNode","uuid","key","_this","call","__uuid","_inheritsLoose","clone","node","__key","getType","importJSON","serializedNode","$createAutocompleteNode","_proto","exportJSON","this","version","updateDOM","prevNode","dom","config","createDOM","createElement","decorate","UUID","AutocompleteComponent","DecoratorNode","style","color","spellCheck","elements","WeakMap","readTouch","e","touch","changedTouches","undefined","clientX","clientY","addListener","element","cb","elementValues","listeners","Set","handleTouchstart","start","handleTouchend","_step","end","_iterator","_createForOfIteratorHelperLoose","done","listener","add","size","deleteListener","Math","random","replace","substr","AutocompletePlugin","query","searchText","server","AutocompleteServer","time","response","timeEnd","$handleKeypressCommand","rootElem","getRootElement","mergeRegister","apply","registerNodeTransform","getKey","$getSelection","registerCommand","KEY_TAB_COMMAND","COMMAND_PRIORITY_LOW","KEY_ARROW_RIGHT_COMMAND","concat","_force","force","x","abs","DICTIONARY","isDismissed","dismiss","promise","Promise","resolve","reject","setTimeout","searchTextLength","char0","charCodeAt","isCapitalized","caseInsensitiveSearchText","fromCharCode","substring","match","DATABASE","find","dictionaryWord","_dictionaryWord$start","startsWith","autocompleteChunk","LATENCY","URL_MATCHER","EMAIL_MATCHER","MATCHERS","text","exec","index","LexicalAutoLinkPlugin","AutoLinkPlugin","matchers","ClickableLinkPlugin","_ref$newTab","newTab","linkDomNode","domNode","isLinkDomNode","parentNode","getLinkDomNode","getAttribute","selection","$isRangeSelection","isCollapsed","linkNode","maybeLinkNode","$getNearestNodeFromDOMNode","$isLinkNode","open","metaKey","ctrlKey","_unused","registerRootListener","rootElement","prevRootElement","nodeName","toLowerCase","CodeHighlightPlugin","registerCodeHighlighting","EmojiNode","_TextNode","__className","__text","inner","appendChild","$createEmojiNode","setFormat","format","setDetail","detail","setMode","mode","setStyle","getClassName","getLatest","TextNode","emojiText","emojis","Map","findAndTransformEmoji","getTextContent","i","emojiData","slice","emojiStyle","targetNode","splitText","emojiNode","textNodeTransform","isSimpleText","EmojisPlugin","hasNodes","Error","EquationEditor","setEquation","inputRef","inline","InlineEquationEditor","BlockEquationEditor","equation","onChange","autoFocus","_ref3","KatexRenderer","katexElementRef","katexElement","katex","render","displayMode","errorColor","output","strict","throwOnError","trust","EquationComponent","nodeKey","equationValue","setEquationValue","_useState2","showEquationEditor","setShowEquationEditor","onHide","restoreSelection","$getNodeByKey","EquationNode","$isEquationNode","selectNext","SELECTION_CHANGE_COMMAND","payload","activeElement","COMMAND_PRIORITY_HIGH","KEY_ESCAPE_COMMAND","__equation","__inline","$createEquationNode","getEquation","_config","getWritable","INSERT_EQUATION_COMMAND","createCommand","EquationsPlugin","equationNode","insertNodes","COMMAND_PRIORITY_EDITOR","clamp","min","max","ImageResizer","onResizeStart","onResizeEnd","imageRef","maxWidth","showCaption","setShowCaption","buttonRef","controlWrapperRef","userSelect","priority","positioningRef","currentHeight","currentWidth","direction","isResizing","ratio","startHeight","startWidth","startX","startY","editorRootElement","maxWidthContainer","getBoundingClientRect","width","maxHeightContainer","height","handlePointerDown","image","controlWrapper","_image$getBoundingCli","positioning","cursorDir","setProperty","getPropertyValue","getPropertyPriority","setStartCursor","classList","handlePointerMove","handlePointerUp","isVertical","diff","floor","remove","onPointerDown","Direction","removeStyleFromSvg_HACK","svg","styleTag","_svg$firstElementChil","firstElementChild","viewBox","viewBoxDimensions","split","setAttribute","tagName","ExcalidrawImage","imageContainerRef","_ref$appState","appState","_ref$rootClassName","rootClassName","Svg","setSvg","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","abrupt","exportToSvg","files","sent","stop","setContent","dangerouslySetInnerHTML","__html","_Svg$outerHTML","outerHTML","ExcalidrawComponent","data","_useLexicalNodeSelect","useLexicalNodeSelection","isSelected","setSelected","clearSelection","setIsResizing","onDelete","$isNodeSelection","preventDefault","$isExcalidrawNode","CLICK_COMMAND","buttonElem","shiftKey","KEY_DELETE_COMMAND","KEY_BACKSPACE_COMMAND","convertExcalidrawElement","excalidrawData","$createExcalidrawNode","__data","ExcalidrawNode","span","theme","importDOM","hasAttribute","conversion","exportDOM","getElementByKey","querySelector","innerHTML","setData","INSERT_EXCALIDRAW_COMMAND","ExcalidrawPlugin","excalidrawNode","HorizontalRulePlugin","INSERT_HORIZONTAL_RULE_COMMAND","getNode","horizontalRuleNode","$createHorizontalRuleNode","insertParagraph","getTopLevelElementOrThrow","insertBefore","KeywordNode","$createKeywordNode","cursor","canInsertTextBefore","canInsertTextAfter","isTextEntity","keyword","KEYWORDS_REGEX","KeywordsPlugin","createKeywordNode","textNode","getKeywordMatch","matchArr","startOffset","useLexicalTextEntity","useLayoutEffectImpl","useLayoutEffect","convertMentionElement","textContent","$createMentionNode","MentionNode","mentionName","__mention","setTextContent","cssText","mentionNode","toggleDirectionless","CapitalizedNameMentionsRegex","RegExp","PUNC","TRIGGERS","VALID_CHARS","AtSignMentionsRegex","AtSignMentionsRegexAliasRegex","mentionsCache","dummyMentionsData","MentionsTypeaheadItem","onMouseEnter","result","liRef","id","MentionsTypeahead","close","resolution","divRef","results","mentionString","setResults","string","callback","cachedResults","newResults","mention","includes","useMentionLookupService","matchingString","selectedIndex","setSelectedIndex","div","_range$getBoundingCli","range","left","top","display","removeAttribute","applyCurrentSelected","selectedEntry","entryText","anchor","anchorNode","selectionOffset","offset","documentText","triggerOffset","ii","getMentionOffset","replaceableString","nodeToReplace","select","createMentionNodeFromSearchResult","updateSelectedIndex","KEY_ARROW_DOWN_COMMAND","SUGGESTION_LIST_LENGTH_LIMIT","stopImmediatePropagation","KEY_ARROW_UP_COMMAND","KEY_ENTER_COMMAND","map","MentionsPlugin","setResolution","activeRange","createRange","previousText","removeUpdateListener","anchorOffset","getTextUpToAnchor","getMentionsTextToSearch","minMatchLength","leadOffset","checkForAtSignMentions","checkForCapitalizedNameMentions","getPossibleMentionMatch","prevSibling","getPreviousSibling","$isTextNode","isSelectionOnEntityBoundary","domSelection","getSelection","endOffset","setStart","setEnd","tryToPositionRange","startTransition","closeTypeahead","useMentions","TableActionMenu","_tableCellNode","tableCellNode","setIsMenuOpen","contextRef","dropDownRef","updateTableCellNode","selectionCounts","columns","rows","registerMutationListener","TableCellNode","nodeMutations","menuButtonElement","dropDownElement","menuButtonRect","opacity","pageXOffset","pageYOffset","handleClickOutside","clearTableSelection","isAttached","tableNode","$getTableNodeFromLexicalNodeOrThrow","tableElement","tableSelection","getTableSelectionFromTableElement","clearHighlight","markDirty","$setSelection","insertTableRowAtSelection","shouldInsertAfter","$getElementGridForTableNode","insertTableColumnAtSelection","deleteTableRowAtSelection","tableRowIndex","$getTableRowIndexFromTableCellNode","$removeTableRowAtIndex","deleteTableAtSelection","deleteTableColumnAtSelection","tableColumnIndex","$getTableColumnIndexFromTableCellNode","$deleteTableColumn","toggleTableRowIsHeader","tableRows","tableRow","$isTableRowNode","forEach","tableCell","$isTableCellNode","toggleHeaderStyle","TableCellHeaderStates","ROW","toggleTableColumnIsHeader","r","tableCells","COLUMN","stopPropagation","__headerState","TableCellActionMenuContainer","menuButtonRef","menuRootRef","isMenuOpen","_useState4","setTableMenuCellNode","moveMenu","menu","nativeSelection","tableCellNodeFromSelection","$getTableCellNodeFromLexicalNode","menuButtonDOM","tableCellNodeDOM","tableCellRect","menuRect","prevTableCellDOM","TableActionMenuPlugin","imageCache","convertImageElement","HTMLImageElement","$createImageNode","altText","alt","src","LazyImage","img","Image","onload","useSuspenseImage","draggable","ImageComponent","resizable","caption","$isImageNode","isFocused","Suspense","fallback","LexicalNestedComposer","initialEditor","TablePlugin","TableCellActionMenuPlugin","ImagesPlugin","LinkPlugin","HashtagPlugin","nextWidth","nextHeight","setWidthAndHeight","ImageNode","__src","__altText","__maxWidth","__width","__height","__showCaption","__caption","createEditor","nestedEditor","editorState","parseEditorState","isEmpty","setEditorState","getAltText","toJSON","getSrc","writable","_ref3$maxWidth","INSERT_IMAGE_COMMAND","$isRootNode","imageNode","DRAGSTART_COMMAND","getImageNodeInSelection","dataTransfer","setDragImage","stringify","onDragStart","DRAGOVER_COMMAND","canDropImage","onDragover","DROP_COMMAND","dragData","_event$dataTransfer","getData","_JSON$parse","getDragImageData","caretRangeFromPoint","rangeParent","collapse","rangeOffset","getRangeAt","getDragSelection","rangeSelection","$createRangeSelection","applyDOMRange","dispatchCommand","onDrop","getNodes","HTMLElement","closest","ListMaxIndentLevelPlugin","maxDepth","INDENT_CONTENT_COMMAND","totalDepth","nodesInSelection","getParentOrThrow","n","$isElementNode","getElementNodesInSelection","elementNode","$isListNode","$getListDepth","$isListItemNode","parent","getParent","isIndentPermitted","COMMAND_PRIORITY_CRITICAL","MaxLengthPlugin","maxLength","lastRestoredEditorState","RootNode","rootNode","prevEditorState","prevTextContent","delCount","$restoreEditorState","trimTextContentFromAnchor","createPollOption","uid","votes","cloneOption","option","from","PollOptionComponent","totalVotes","withPollNode","setOptionText","placeholder","deleteOption","PollComponent","question","reduce","getTotalVotes","$isPollNode","addOption","convertPollElement","$createPollNode","PollNode","__question","__options","self","push","indexOf","splice","clonedOption","toggleVote","clientID","votesClone","voteIndex","elem","INSERT_POLL_COMMAND","PollPlugin","pollNode","getElement","getElementById","position","fontSize","transform","padding","background","borderRadius","SPEECH_TO_TEXT_COMMAND","VOICE_COMMANDS","\n","redo","REDO_COMMAND","undo","UNDO_COMMAND","timer","cleanup","isEnabled","setIsEnabled","SpeechRecognition","webkitSpeechRecognition","recognition","report","clearTimeout","removeChild","log","continuous","interimResults","resultItem","item","resultIndex","transcript","isFinal","command","trim","insertText","_isEnabled","lastTabKeyDownTimestamp","hasRegisteredKeyDownListener","TabFocusPlugin","timeStamp","FOCUS_COMMAND","TableCellResizer","targetRef","resizerRef","tableRectRef","mouseStartPosRef","mouseCurrentPos","updateMouseCurrentPos","activeCell","updateActiveCell","isSelectingGrid","draggingDirection","updateDraggingDirection","resetState","onMouseMove","y","cell","getCellFromTarget","isHeightChanging","updateRowHeight","newHeight","setHeight","updateColumnWidth","newWidth","setWidth","toggleResize","_mouseStartPosRef$cur","_activeCell$elem$getB","heightChange","widthChange","resizerStyles","_activeCell$elem$getB2","styles","bottom","backgroundColor","right","tableRect","getResizers","onMouseDown","onMouseUp","TableCellResizerPlugin","TextFormatFloatingToolbar","isLink","isBold","isItalic","isUnderline","isCode","isStrikethrough","isSubscript","isSuperscript","popupCharStylesEditorRef","insertLink","TOGGLE_LINK_COMMAND","updateTextFormatFloatingToolbar","popupCharStylesEditorElem","rect","domRange","rootElementRect","offsetWidth","setPopupPosition","onResize","FORMAT_TEXT_COMMAND","getSelectedNode","focusNode","isBackward","$isAtNodeEnd","TextFormatFloatingToolbarPlugin","isText","setIsText","setIsLink","setIsBold","setIsItalic","_useState5","setIsUnderline","_useState6","setIsStrikethrough","_useState7","setIsSubscript","_useState8","setIsSuperscript","_useState9","setIsCode","updatePopup","isComposing","hasFormat","$isCodeHighlightNode","IS_APPLE","test","navigator","platform","positionSticky","stickyElem","rectLeft","StickyComponent","stickyContainerRef","isDragging","offsetX","offsetY","stickyContainer","pageX","pageY","$isStickyNode","setPosition","button","stickContainer","_stickContainer$getBo","toggleColor","StickyNode","__x","__y","__color","xOffset","yOffset","isIsolated","DropDownContext","DropDownItem","dropDownContext","registerItem","DropDownItems","items","setItems","highlightedItem","setHighlightedItem","itemRef","onKeyDown","DropDown","buttonLabel","buttonAriaLabel","buttonClassName","buttonIconClassName","stopCloseOnClickSelf","showDropDown","setShowDropDown","dropDown","_button$getBoundingCl","innerWidth","handle","TextInput","_ref$placeholder","label","basicColors","ColorPicker","rest","_objectWithoutPropertiesLoose","_excluded","transformColor","selfColor","setSelfColor","inputColor","setInputColor","innerDivRef","saturationPosition","hsv","s","v","huePosition","h","hex","newColor","basicColor","MoveWrapper","_ref4","move","_div$getBoundingClien","_e","toHex","ctx","getContext","fillStyle","hex2rgb","rbgArr","m","g","b","parseInt","rgb2hsv","_ref5","d","rgb2hex","_ref7","padStart","_ref6","f","p","q","t","rgb","round","FileInput","accept","KatexEquationAlterer","onConfirm","_ref$initialEquation","initialEquation","setInline","onCheckboxChange","checked","PREVIEW_CACHE","LinkPreviewContent","preview","cached","fetch","encodeURI","then","json","useSuspenseRequest","domain","description","Glimmer","props","animationDelay","LinkPreview","convertTweetElement","$createTweetNode","TweetComponent","loadingComponent","onError","onLoad","tweetID","containerRef","previousTweetIDRef","isLoading","setIsLoading","createTweet","twttr","widgets","t0","_document$body","script","async","onerror","BlockWithAlignableContents","TweetNode","_DecoratorBlockNode","__id","__format","getId","embedBlockTheme","embedBlock","base","isTopLevel","DecoratorBlockNode","INSERT_TWEET_COMMAND","TwitterPlugin","tweetNode","paragraphNode","$createParagraphNode","insertAfter","YouTubeComponent","videoID","frameBorder","allow","allowFullScreen","YouTubeNode","$createYouTubeNode","_editor","INSERT_YOUTUBE_COMMAND","YouTubePlugin","youTubeNode","blockTypeToBlockName","bullet","check","code","h1","h2","h3","h4","h5","h6","number","paragraph","quote","CODE_LANGUAGE_OPTIONS","CODE_LANGUAGE_MAP","javascript","md","plaintext","python","positionEditorElement","FloatingLinkEditor","editorRef","linkUrl","setLinkUrl","isEditMode","setEditMode","lastSelection","setLastSelection","updateLinkEditor","getURL","editorElem","rel","InsertImageUriDialogBody","setSrc","setAltText","isDisabled","InsertImageUploadedDialogBody","reader","FileReader","readAsDataURL","InsertImageDialog","activeEditor","InsertTableDialog","setRows","_useState10","setColumns","INSERT_TABLE_COMMAND","InsertPollDialog","_useState11","VALID_TWITTER_URL","InsertTweetDialog","_ref8","_useState12","setText","_text$split","YOUTUBE_ID_PARSER","parseYouTubeVideoID","urlMatches","InsertYouTubeDialog","_ref9","_useState13","InsertEquationDialog","_ref10","onEquationConfirm","dropDownActiveClass","active","BlockFormatDropDown","_ref11","blockType","formatHeading","headingSize","INSERT_UNORDERED_LIST_COMMAND","REMOVE_LIST_COMMAND","INSERT_ORDERED_LIST_COMMAND","INSERT_CHECK_LIST_COMMAND","codeNode","$createCodeNode","insertRawText","Divider","Select","_ref12","_ref13","ToolbarPlugin","_useState14","setActiveEditor","_useState15","setBlockType","_useState16","selectedElementKey","setSelectedElementKey","_useState17","setFontSize","_useState18","fontColor","setFontColor","_useState19","bgColor","setBgColor","_useState20","fontFamily","setFontFamily","_useState21","_useState22","_useState23","_useState24","_useState25","_useState26","_useState27","_useState28","_useState29","canUndo","setCanUndo","_useState30","canRedo","setCanRedo","_useState31","isRTL","setIsRTL","_useState32","codeLanguage","setCodeLanguage","updateToolbar","elementKey","elementDOM","$isParentElementRTL","parentList","$getNearestNodeOfType","ListNode","getListType","$isHeadingNode","getTag","language","$getSelectionStyleValueForProperty","_payload","newEditor","_ref14","CAN_UNDO_COMMAND","CAN_REDO_COMMAND","applyStyleText","$patchStyleText","clearFormatting","$selectAll","$getNearestBlockElementAncestorOrThrow","$isDecoratorBlockNode","onFontSizeSelect","font-size","onFontColorSelect","onBgColorSelect","background-color","onFontFamilySelect","font-family","onCodeLanguageSelect","setLanguage","stickyNode","FORMAT_ELEMENT_COMMAND","OUTDENT_CONTENT_COMMAND","Placeholder","Editor","_useSettings$settings","scrollRef","AutoFocusPlugin","ClearEditorPlugin","SpeechToTextPlugin","ListPlugin","CheckListPlugin","HistoryPlugin","externalHistoryState","PlaygroundNodes","HeadingNode","ListItemNode","QuoteNode","CodeNode","TableNode","TableRowNode","HashtagNode","CodeHighlightNode","AutoLinkNode","LinkNode","OverflowNode","TypeaheadNode","HorizontalRuleNode","MarkNode","formatStep","step","formattedStep","anchorPath","focusPath","focusOffset","formatOneStep","count","getPathFromNodeToEditor","currentNode","path","_currentNode2","_currentNode$parentNo","_currentNode","unshift","childNodes","keyPresses","TestRecorderPlugin","_useTestRecorder","steps","setSteps","isRecording","setIsRecording","setCurrentInnerHTML","templatedTest","setTemplatedTest","previousSelectionRef","skipNextSelectionChangeRef","preRef","getCurrentEditor","generateTestContent","browserSelection","pushStep","currentSteps","currentIndex","lastStep","isSelectAll","onKeyUp","scrollTo","scrollHeight","testContent","_selection","dirtyLeaves","dirtyElements","toggleEditorSelection","currentEditor","clear","$createTextNode","currentIsRecording","onSnapshotClick","_sanitizeSelection","sanitizeSelection","onCopyClick","textArea","execCommand","_document$body2","copy","onDownloadClick","a","encodeURIComponent","_document$body3","click","_document$body4","useTestRecorder","Switch","buttonId","htmlFor","Settings","windowLocation","_useSettings","showSettings","setShowSettings","_useMemo","parentWindow","pathname","isSplitScreen","reload","characterLimit","codeHighlight","atrule","attr","boolean","builtin","cdata","char","class","class-name","comment","constant","deleted","doctype","entity","function","important","inserted","namespace","operator","prolog","property","punctuation","regex","selector","symbol","tag","variable","hashtag","heading","link","list","listitem","listitemChecked","listitemUnchecked","nested","olDepth","ul","ltr","markOverlap","rtl","table","tableCellHeader","bold","italic","strikethrough","subscript","superscript","underline","underlineStrikethrough","prepopulatedRichText","$createHeadingNode","$createQuoteNode","toggleFormat","paragraph2","paragraph3","$createListNode","$createListItemNode","$createLinkNode","paragraph4","App","initialConfig","nodes","PlaygroundEditorTheme","LexicalComposer","showErrorOverlay","err","ErrorOverlay","customElements","overlay","reason","createRoot","border","fill","transformOrigin"],"mappings":"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gBACA,cACA,YACA,YACA,aACA,YACA,YACA,YACA,YACA,aACA,aACA,cACA,YACA,YACA,aACA,aACA,cACA,YACA,YACA,cACA,YACA,YACA,cACA,aACA,YACA,aACA,aACA,YACA,eACA,YACA,aACA,aACA,YACA,YACA,YACA,YACA,YACA,aACA,gBACA,YACA,YACA,cACA,aACA,YACA,cACA,YACA,YACA,aACA,cACA,YACA,YACA,eACA,eACA,aACA,YACA,aACA,aACA,aACA,cACA,YACA,aACA,YACA,YACA,eACA,aACA,aACA,cACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,gBACA,eACA,aACA,aACA,iBACA,YACA,YACA,aACA,YACA,YACA,eACA,YACA,cACA,YACA,YACA,YACA,aACA,aACA,gBACA,cACA,aACA,aACA,YACA,eACA,YACA,YACA,YACA,eACA,aACA,YACA,cACA,iBACA,aACA,aACA,YACA,gBACA,cACA,YACA,YACA,YACA,aACA,aACA,aACA,YACA,YACA,aACA,eACA,YACA,aACA,YACA,eACA,aACA,gBACA,YACA,cACA,aACA,aACA,YACA,YACA,cACA,YACA,YACA,cACA,eACA,eACA,YACA,YACA,aACA,YACA,aACA,cACA,YACA,cACA,aACA,iBACA,aACA,cACA,YACA,cACA,aACA,aACA,YACA,gBACA,YACA,iBACA,aACA,aACA,cACA,aACA,YACA,cACA,YACA,aACA,cACA,YACA,aACA,aACA,aACA,cACA,cACA,YACA,eACA,YACA,gBACA,YACA,aACA,cACA,aACA,YACA,aACA,aACA,eACA,cACA,YACA,aACA,YACA,cACA,aACA,iBACA,YACA,aACA,YACA,aACA,aACA,aACA,YACA,aACA,aACA,YACA,YACA,cACA,aACA,eACA,YACA,YACA,aACA,cACA,cACA,aACA,gBACA,aACA,aACA,cACA,YACA,aACA,YACA,aACA,YACA,cACA,gBACA,aACA,YACA,YACA,aACA,YACA,eACA,aACA,aACA,eACA,YACA,aACA,aACA,gBACA,YACA,YACA,YACA,aACA,aACA,aACA,YACA,YACA,YACA,YACA,YACA,cACA,YACA,cACA,YACA,aACA,YACA,aACA,YACA,iBACA,YACA,YACA,YACA,YACA,cACA,aACA,aACA,gBACA,gBACA,YACA,eACA,YACA,aACA,cACA,eACA,YACA,aACA,aACA,aACA,aACA,YACA,YACA,cACA,YACA,aACA,YACA,YACA,YACA,gBACA,kBACA,aACA,gBACA,YACA,YACA,eACA,YACA,gBACA,YACA,YACA,aACA,YACA,YACA,aACA,aACA,aACA,aACA,gBACA,YACA,YACA,YACA,aACA,YACA,YACA,aACA,gBACA,YACA,cACA,YACA,YACA,gBACA,cACA,YACA,YACA,YACA,gBACA,YACA,aACA,cACA,aACA,cACA,eACA,iBACA,cACA,cACA,YACA,aACA,cACA,YACA,aACA,aACA,aACA,cACA,cACA,YACA,YACA,aACA,YACA,cACA,aACA,aACA,eACA,YACA,cACA,YACA,YACA,eACA,YACA,YACA,cACA,aACA,gBACA,YACA,iBACA,YACA,aACA,cACA,YACA,YACA,YACA,gBACA,YACA,YACA,cACA,cACA,YACA,YACA,YACA,eACA,iBACA,YACA,aACA,YACA,aACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,YACA,YACA,aACA,aACA,aACA,YACA,YACA,gBACA,aACA,cACA,YACA,aACA,YACA,cACA,YACA,cACA,aACA,YACA,gBACA,aACA,YACA,YACA,YACA,YACA,eACA,eACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,aACA,YACA,YACA,aACA,YACA,eACA,eACA,YACA,eACA,YACA,aACA,cACA,YACA,eACA,aACA,YACA,YACA,aACA,eACA,aACA,cACA,cACA,YACA,cACA,YACA,aACA,YACA,YACA,eACA,cACA,cACA,aACA,cACA,YACA,YACA,YACA,cACA,eACA,YACA,aACA,cACA,YACA,cACA,YACA,YACA,eACA,aACA,cACA,cACA,aACA,cACA,gBACA,cACA,YACA,cACA,eACA,kBACA,cACA,YACA,cACA,YACA,aACA,aACA,aACA,YACA,eACA,YACA,YACA,aACA,aACA,YACA,gBACA,iBACA,aACA,aACA,YACA,YACA,cACA,YACA,YACA,YACA,YACA,YACA,aACA,cACA,cACA,kBACA,YACA,YACA,cACA,eACA,aACA,aACA,YACA,aACA,YACA,aACA,YACA,aACA,YACA,YACA,aACA,aACA,YACA,aACA,YACA,cACA,YACA,YACA,eACA,YACA,YACA,aACA,YACA,aACA,cACA,YACA,YACA,aACA,aACA,aACA,cACA,aACA,YACA,aACA,aACA,YACA,YACA,cACA,aACA,gBACA,aACA,YACA,YACA,aACA,YACA,aACA,YACA,aACA,cACA,YACA,YACA,YACA,aACA,YACA,YACA,cACA,cACA,YACA,aACA,gBACA,YACA,YACA,aACA,YACA,cACA,YACA,YACA,YACA,YACA,aACA,YACA,aACA,YACA,YACA,YACA,aACA,gBACA,YACA,aACA,YACA,YACA,eACA,cACA,eACA,YACA,eACA,YACA,YACA,YACA,YACA,cACA,aACA,YACA,aACA,YACA,aACA,aACA,cACA,aACA,iBACA,YACA,YACA,YACA,YACA,cACA,aACA,eACA,aACA,aACA,YACA,eACA,cACA,cACA,YACA,cACA,eACA,aACA,gBACA,YACA,YACA,aACA,cACA,YACA,cACA,cACA,cACA,cACA,aACA,eACA,YACA,YACA,YACA,YACA,cACA,gBACA,YACA,YACA,aACA,eACA,YACA,cACA,gBACA,YACA,YACA,YACA,YACA,cACA,eACA,gBACA,aACA,YACA,YACA,iBACA,eACA,cACA,YACA,cACA,aACA,YACA,aACA,aACA,YACA,aACA,cACA,cACA,cACA,YACA,YACA,YACA,YACA,cACA,cACA,cACA,aACA,YACA,cACA,YACA,YACA,aACA,YACA,YACA,eACA,YACA,YACA,eACA,iBACA,cACA,YACA,YACA,YACA,gBACA,YACA,aACA,YACA,YACA,YACA,aACA,aACA,cACA,aACA,aACA,YACA,gBACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,eACA,YACA,cACA,aACA,YACA,cACA,gBACA,eACA,gBACA,YACA,cACA,qBACA,aACA,aACA,aACA,YACA,YACA,aACA,YACA,YACA,cACA,eACA,YACA,cACA,gBACA,eACA,aACA,aACA,cACA,YACA,YACA,cACA,YACA,mBACA,YACA,eACA,YACA,cACA,YACA,YACA,YACA,aACA,aACA,eACA,YACA,YACA,YACA,YACA,YACA,cACA,YACA,YACA,aACA,aACA,YACA,cACA,aACA,YACA,YACA,eACA,YACA,aACA,YACA,aACA,cACA,gBACA,iBACA,aACA,eACA,aACA,aACA,eACA,gBACA,aACA,cACA,aACA,aACA,YACA,aACA,aACA,eACA,cACA,eACA,cACA,YACA,aACA,cACA,YACA,aACA,aACA,cACA,YACA,cACA,cACA,cACA,eACA,aACA,aACA,aACA,eACA,cACA,YACA,cACA,aACA,aACA,cACA,YACA,YACA,YACA,aACA,YACA,cACA,cACA,YACA,eACA,YACA,aACA,aACA,aACA,gBACA,gBACA,gBACA,aACA,YACA,eACA,aACA,YACA,YACA,YACA,YACA,eACA,YACA,gBACA,cACA,aACA,aACA,YACA,aACA,aACA,YACA,YACA,YACA,aACA,aACA,YACA,eACA,YACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,gBACA,eACA,eACA,aACA,aACA,aACA,YACA,aACA,YACA,YACA,YACA,YACA,cACA,YACA,aACA,aACA,aACA,aACA,YACA,aACA,YACA,YACA,aACA,eACA,aACA,YACA,aACA,YACA,YACA,aACA,YACA,aACA,YACA,cACA,cACA,cACA,aACA,cACA,YACA,eACA,YACA,eACA,aACA,YACA,YACA,cACA,eACA,cACA,YACA,aACA,aACA,iBACA,cACA,eACA,YACA,YACA,eACA,YACA,YACA,YACA,iBACA,YACA,eACA,gBACA,eACA,YACA,YACA,YACA,aACA,cACA,YACA,YACA,cACA,YACA,cACA,YACA,aACA,aACA,iBACA,cACA,aACA,YACA,YACA,YACA,YACA,cACA,YACA,YACA,aACA,YACA,cACA,cACA,YACA,cACA,cACA,YACA,YACA,aACA,cACA,YACA,cACA,eACA,aACA,aACA,aACA,cACA,aACA,aACA,YACA,YACA,aACA,YACA,YACA,eACA,cACA,eACA,eACA,eACA,cACA,eACA,YACA,YACA,eACA,aACA,eACA,aACA,aACA,aACA,aACA,aACA,YACA,aACA,YACA,YACA,aACA,cACA,eACA,cACA,cACA,cACA,YACA,aACA,YACA,YACA,eACA,aACA,cACA,cACA,YACA,cACA,eACA,eACA,aACA,eACA,aACA,aACA,YACA,YACA,aACA,eACA,cACA,eACA,aACA,aACA,YACA,YACA,cACA,YACA,aACA,cACA,aACA,aACA,aACA,eACA,cACA,eACA,aACA,aACA,YACA,eACA,YACA,cACA,YACA,YACA,aACA,YACA,YACA,cACA,cACA,eACA,gBACA,cACA,cACA,YACA,eACA,eACA,YACA,iBACA,cACA,iBACA,cACA,aACA,aACA,aACA,YACA,YACA,aACA,eACA,iBACA,YACA,YACA,iBACA,aACA,aACA,YACA,YACA,YACA,cACA,aACA,aACA,YACA,YACA,YACA,iBACA,YACA,YACA,cACA,aACA,cACA,aACA,YACA,YACA,YACA,aACA,eACA,cACA,aACA,eACA,eACA,YACA,aACA,eACA,YACA,iBACA,YACA,aACA,YACA,YACA,YACA,cACA,aACA,YACA,YACA,YACA,aACA,aACA,YACA,YACA,cACA,YACA,YACA,YACA,YACA,cACA,eACA,iBACA,YACA,YACA,aACA,cACA,eACA,aACA,YACA,gBACA,YACA,YACA,cACA,aACA,aACA,cACA,eACA,YACA,aACA,aACA,YACA,cACA,aACA,YACA,cACA,cACA,YACA,cACA,eACA,YACA,aACA,YACA,eACA,aACA,aACA,YACA,eACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,YACA,eACA,YACA,YACA,aACA,YACA,YACA,YACA,YACA,cACA,cACA,aACA,YACA,aACA,gBACA,aACA,YACA,YACA,YACA,YACA,gBACA,YACA,cACA,gBACA,YACA,YACA,cACA,YACA,eACA,aACA,YACA,gBACA,YACA,YACA,aACA,YACA,cACA,aACA,YACA,aACA,eACA,YACA,aACA,aACA,cACA,cACA,YACA,YACA,iBACA,cACA,eACA,aACA,YACA,cACA,YACA,aACA,cACA,cACA,YACA,aACA,YACA,aACA,aACA,YACA,YACA,YACA,YACA,eACA,YACA,aACA,gBACA,YACA,cACA,gBACA,aACA,YACA,aACA,cACA,eACA,YACA,YACA,cACA,cACA,iBACA,aACA,YACA,YACA,cACA,cACA,YACA,cACA,YACA,cACA,eACA,YACA,YACA,gBACA,YACA,YACA,aACA,aACA,aACA,aACA,YACA,YACA,gBACA,eACA,eACA,aACA,aACA,YACA,cACA,YACA,YACA,eACA,cACA,YACA,eACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,YACA,aACA,aACA,aACA,aACA,cACA,eACA,eACA,YACA,aACA,YACA,aACA,iBACA,cACA,YACA,aACA,aACA,eACA,gBACA,aACA,eACA,aACA,aACA,YACA,aACA,YACA,cACA,YACA,gBACA,iBACA,YACA,aACA,YACA,aACA,aACA,eACA,YACA,aACA,cACA,aACA,cACA,YACA,cACA,YACA,YACA,aACA,eACA,aACA,eACA,eACA,aACA,YACA,aACA,iBACA,eACA,eACA,YACA,aACA,YACA,gBACA,eACA,gBACA,aACA,YACA,YACA,aACA,YACA,aACA,YACA,YACA,eACA,aACA,YACA,aACA,YACA,aACA,aACA,YACA,aACA,aACA,cACA,YACA,cACA,YACA,aACA,aACA,aACA,aACA,cACA,eACA,YACA,gBACA,YACA,eACA,gBACA,aACA,YACA,YACA,cACA,aACA,aACA,YACA,aACA,cACA,eACA,YACA,YACA,gBACA,aACA,aACA,cACA,aACA,aACA,eACA,YACA,YACA,cACA,YACA,cACA,YACA,YACA,cACA,YACA,aACA,cACA,cACA,aACA,YACA,YACA,YACA,YACA,cACA,YACA,aACA,cACA,YACA,YACA,gBACA,aACA,aACA,YACA,gBACA,eACA,aACA,cACA,aACA,YACA,eACA,YACA,aACA,aACA,YACA,YACA,YACA,YACA,aACA,aACA,YACA,eACA,eACA,YACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,cACA,aACA,YACA,eACA,YACA,cACA,YACA,aACA,YACA,YACA,aACA,aACA,YACA,aACA,aACA,YACA,aACA,YACA,gBACA,gBACA,YACA,gBACA,aACA,eACA,aACA,eACA,cACA,aACA,cACA,YACA,YACA,cACA,aACA,YACA,aACA,aACA,gBACA,YACA,aACA,aACA,cACA,cACA,cACA,gBACA,YACA,cACA,eACA,gBACA,YACA,cACA,aACA,aACA,YACA,cACA,aACA,aACA,aACA,YACA,aACA,YACA,cACA,gBACA,aACA,aACA,aACA,eACA,YACA,cACA,cACA,aACA,cACA,YACA,YACA,aACA,aACA,YACA,aACA,YACA,YACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,YACA,iBACA,YACA,YACA,aACA,cACA,YACA,YACA,aACA,aACA,aACA,YACA,aACA,eACA,YACA,YACA,YACA,YACA,YACA,aACA,gBACA,YACA,YACA,aACA,cACA,aACA,gBACA,YACA,cACA,YACA,YACA,YACA,eACA,aACA,YACA,aACA,iBACA,mBACA,YACA,aACA,YACA,aACA,eACA,aACA,aACA,aACA,eACA,aACA,aACA,aACA,eACA,eACA,aACA,cACA,cACA,cACA,YACA,cACA,gBACA,gBACA,YACA,aACA,YACA,YACA,YACA,YACA,aACA,cACA,cACA,cACA,aACA,aACA,aACA,cACA,YACA,iBACA,aACA,YACA,cACA,YACA,aACA,cACA,aACA,gBACA,cACA,aACA,cACA,YACA,YACA,YACA,aACA,kBACA,YACA,eACA,cACA,YACA,aACA,YACA,aACA,aACA,YACA,eACA,aACA,cACA,gBACA,YACA,YACA,aACA,YACA,YACA,aACA,aACA,aACA,aACA,YACA,YACA,YACA,cACA,cACA,YACA,eACA,YACA,cACA,aACA,cACA,YACA,YACA,gBACA,YACA,YACA,cACA,aACA,YACA,YACA,aACA,YACA,aACA,cACA,eACA,YACA,YACA,gBACA,YACA,aACA,eACA,YACA,YACA,cACA,YACA,aACA,YACA,iBACA,YACA,eACA,eACA,YACA,YACA,eACA,eACA,cACA,cACA,YACA,YACA,iBACA,aACA,cACA,YACA,cACA,YACA,eACA,gBACA,YACA,YACA,YACA,YACA,cACA,YACA,aACA,YACA,aACA,YACA,YACA,YACA,YACA,YACA,gBACA,aACA,aACA,aACA,YACA,YACA,eACA,aACA,aACA,aACA,YACA,YACA,YACA,eACA,YACA,aACA,eACA,aACA,aACA,kBACA,aACA,cACA,cACA,cACA,cACA,aACA,aACA,eACA,cACA,cACA,aACA,kBACA,YACA,YACA,aACA,YACA,aACA,YACA,gBACA,cACA,aACA,aACA,aACA,gBACA,gBACA,YACA,YACA,aACA,cACA,aACA,YACA,aACA,aACA,kBACA,aACA,YACA,YACA,aACA,aACA,aACA,aACA,cACA,aACA,YACA,aACA,aACA,gBACA,aACA,eACA,YACA,YACA,YACA,aACA,YACA,eACA,YACA,aACA,YACA,YACA,YACA,YACA,YACA,YACA,aACA,cACA,YACA,YACA,aACA,cACA,cACA,cACA,aACA,YACA,YACA,aACA,YACA,aACA,YACA,YACA,aACA,aACA,YACA,aACA,YACA,cACA,YACA,cACA,cACA,eACA,eACA,aACA,YACA,aACA,eACA,YACA,eACA,YACA,cACA,aACA,aACA,YACA,YACA,eACA,aACA,YACA,YACA,YACA,YACA,aACA,YACA,YACA,YACA,eACA,YACA,YACA,cACA,iBACA,aACA,YACA,cACA,YACA,cACA,YACA,YACA,eACA,aACA,aACA,YACA,cACA,kBACA,aACA,YACA,YACA,aACA,aACA,eACA,eACA,aACA,YACA,aACA,aACA,eACA,YACA,aACA,aACA,aACA,YACA,YACA,cACA,cACA,YACA,YACA,aACA,YACA,YACA,aACA,YACA,aACA,YACA,cACA,eACA,cACA,gBACA,YACA,aACA,aACA,YACA,eACA,aACA,YACA,YACA,iBACA,YACA,YACA,YACA,cACA,cACA,aACA,eACA,YACA,cACA,eACA,YACA,YACA,aACA,aACA,YACA,YACA,aACA,cACA,YACA,gBACA,aACA,cACA,gBACA,YACA,YACA,iBACA,aACA,aACA,cACA,aACA,YACA,YACA,cACA,aACA,YACA,YACA,YACA,YACA,cACA,YACA,aACA,aACA,YACA,aACA,YACA,YACA,cACA,aACA,YACA,aACA,cACA,eACA,cACA,cACA,cACA,eACA,YACA,eACA,YACA,YACA,YACA,cACA,YACA,YACA,cACA,YACA,gBACA,YACA,YACA,YACA,cACA,aACA,YACA,cACA,iBACA,YACA,cACA,eACA,YACA,cACA,cACA,aACA,YACA,YACA,cACA,YACA,eACA,cACA,YACA,YACA,YACA,YACA,aACA,aACA,cACA,eACA,cACA,cACA,YACA,aACA,YACA,YACA,eACA,eACA,cACA,cACA,aACA,aACA,cACA,YACA,eACA,YACA,aACA,YACA,cACA,eACA,YACA,YACA,cACA,cACA,cACA,eACA,aACA,gBACA,aACA,YACA,cACA,cACA,YACA,aACA,cACA,eACA,aACA,mBACA,aACA,eACA,gBACA,aACA,aACA,aACA,YACA,aACA,cACA,YACA,YACA,kBACA,YACA,YACA,gBACA,aACA,gBACA,YACA,YACA,YACA,YACA,YACA,YACA,cACA,YACA,gBACA,cACA,eACA,YACA,cACA,YACA,aACA,aACA,eACA,aACA,eACA,aACA,YACA,cACA,aACA,cACA,cACA,cACA,eACA,YACA,eACA,YACA,cACA,aACA,aACA,YACA,YACA,cACA,YACA,aACA,YACA,YACA,cACA,cACA,YACA,aACA,YACA,cACA,eACA,cACA,YACA,cACA,gBACA,YACA,eACA,eACA,aACA,YACA,aACA,YACA,eACA,YACA,aACA,YACA,YACA,aACA,aACA,gBACA,aACA,YACA,aACA,cACA,YACA,YACA,aACA,cACA,aACA,aACA,YACA,cACA,cACA,YACA,gBACA,aACA,aACA,YACA,YACA,aACA,cACA,cACA,YACA,aACA,aACA,cACA,YACA,cACA,aACA,eACA,aACA,eACA,cACA,YACA,YACA,YACA,YACA,cACA,YACA,YACA,YACA,aACA,YACA,gBACA,YACA,cACA,eACA,cACA,YACA,aACA,gBACA,aACA,cACA,YACA,YACA,aACA,cACA,YACA,kBACA,aACA,cACA,gBACA,aACA,eACA,aACA,YACA,YACA,YACA,kBC39EIuB,GACJ,kHAEIC,GACJ,sJAEIC,GAAW,CACf,SAACC,GACC,IAAMX,EAAQQ,GAAYI,KAAKD,GAC/B,OACEX,GAAS,CACPa,MAAOb,EAAMa,MACbtP,OAAQyO,EAAM,GAAGzO,OACjBoP,KAAMX,EAAM,GACZ1M,IAAK0M,EAAM,KAIjB,SAACW,GACC,IAAMX,EAAQS,GAAcG,KAAKD,GACjC,OACEX,GAAS,CACPa,MAAOb,EAAMa,MACbtP,OAAQyO,EAAM,GAAGzO,OACjBoP,KAAMX,EAAM,GACZ1M,cAAe0M,EAAM,MAM7B,SAAwBc,KACtB,OAAO3M,gBAAC4M,kBAAeC,SAAUN,cCrBXO,GAAmBrO,OACzC6E,EAAM7E,EAAN6E,OAAMyJ,EAAAtO,EACNuO,OAAAA,WAAMD,GAAOA,EAKNjJ,EAAUC,iCAoEjB,OAnEAhD,aAAU,WACR,SAASqB,EAAQqF,GACf,IAAMnG,EAAQmG,EACRwF,EAuEZ,SACE3L,EACAwC,GAEA,OAAOA,EAAOS,iBAAiBC,MAAK,WAClC,IAAM0I,EAAU5L,EAAMI,OAEtB,OAAIyL,GAAcD,GACTA,EAGLA,EAAQE,YAAcD,GAAcD,EAAQE,YACvCF,EAAQE,WAGV,QAt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,KAAKqI,OACpB,CAAC5G,QAAAA,IACTkV,EAEMvC,UAAP,WACE,MAAO,CACLF,KAAM,SAACvN,GACL,OAAKA,EAAQ0N,aAAa,wBAGnB,CACLC,WAAYkC,GACZpI,SAAU,GAJH,QAQdtO,EAED8V,aAAA,WACE,OAAO,GACRe,GAhE8BzN,qBAmEjBwN,GAAmBE,GACjC,IAAMI,EAAc,IAAIL,GAAYC,GAEpC,OADAI,EAAYnO,QAAQ,aAAaoO,sBAC1BD,ECpET,IASME,GAA+B,IAAIC,OACvC,iGAGIC,GAZJ,+DAcIC,GAAW,CAAC,IAAK,WAAWra,KAAK,IAGjCsa,GAAc,KAAOD,GAAWD,GAAO,OAevCG,GAAsB,IAAIJ,OAC9B,gBAEEE,GAFF,QAKEC,GAhBF,kBAIAF,GAOA,iBAiBII,GAAgC,IAAIL,OACxC,gBAEEE,GAFF,QAKEC,GALF,cAeIG,GAAgB,IAAIpO,IAEpBqO,GAAoB,CACxB,eACA,aACA,sBACA,uBACA,sBACA,gBACA,iBACA,2BACA,iBACA,uBACA,aACA,eACA,2BACA,UACA,QACA,eACA,OACA,OACA,eACA,QACA,eACA,iBACA,aACA,QACA,WACA,SACA,kBACA,kBACA,gBACA,cACA,eACA,OACA,QACA,iBACA,eACA,YACA,cACA,oBACA,kBACA,iBACA,YACA,UACA,aACA,iBACA,YACA,QACA,wBACA,cACA,cACA,OACA,QACA,SACA,WACA,eACA,iBACA,iBACA,wBACA,cACA,kBACA,gBACA,gBACA,eACA,gBACA,uBACA,YACA,uBACA,eACA,eACA,YACA,cACA,iBACA,cACA,eACA,iBACA,iBACA,gBACA,2BACA,0BACA,gBACA,iBACA,gBACA,mBACA,sBACA,aACA,kBACA,QACA,gBACA,cACA,eACA,aACA,OACA,aACA,aACA,gBACA,iBACA,YACA,cACA,SACA,eACA,gBACA,kBACA,kBACA,KACA,eACA,gBACA,QACA,QACA,WACA,YACA,gBACA,aACA,WACA,kBACA,iBACA,YACA,iBACA,SACA,YACA,OACA,YACA,OACA,WACA,aACA,SACA,iBACA,aACA,eACA,cACA,QACA,gBACA,gBACA,OACA,QACA,UACA,UACA,sBACA,UACA,OACA,QACA,aACA,cACA,yBACA,oBACA,iBACA,eACA,cACA,cACA,eACA,aACA,mBACA,sBACA,SACA,eACA,WACA,WACA,QACA,aACA,WACA,iBACA,YACA,gBACA,OACA,eACA,SACA,cACA,QACA,aACA,cACA,oBACA,QACA,iBACA,cACA,aACA,kBACA,gBACA,YACA,SACA,mBACA,kBACA,OACA,iBACA,aACA,eACA,YACA,aACA,kBACA,cACA,SACA,WACA,QACA,eACA,SACA,mBACA,cACA,aACA,eACA,gBACA,YACA,gBACA,SACA,YACA,aACA,WACA,QACA,UACA,mBACA,oBACA,cACA,gBACA,8BACA,mBACA,QACA,SACA,WACA,iBACA,gBACA,cACA,WACA,iBACA,QACA,kBACA,cACA,SACA,YACA,aACA,WACA,gBACA,WACA,aACA,WACA,WACA,mBACA,aACA,SACA,cACA,kBACA,eACA,gBACA,eACA,aACA,eACA,aACA,gBACA,cACA,SACA,gBACA,cACA,kBACA,YACA,iBACA,QACA,eACA,cACA,aACA,iBACA,WACA,eACA,MACA,gBACA,OACA,QACA,gBACA,eACA,cACA,YACA,aACA,YACA,aACA,gBACA,eACA,aACA,SACA,0BACA,kBACA,WACA,UACA,cACA,oBACA,aACA,iBACA,SACA,UACA,eACA,iBACA,iBACA,kBACA,eACA,WACA,cACA,QACA,QACA,QACA,SACA,QACA,OACA,OACA,eACA,mBACA,cACA,gBACA,kBACA,WACA,gBACA,MACA,WACA,cACA,QACA,eACA,aACA,iBACA,QACA,eACA,YACA,iBACA,OACA,aACA,cACA,iBACA,gBACA,OACA,cACA,QACA,cACA,cACA,qBACA,WACA,eACA,cACA,SACA,eACA,gBACA,UACA,iBACA,iBACA,iBACA,WACA,YACA,iBACA,UACA,eACA,YACA,WACA,oBACA,aACA,gBACA,YACA,YACA,eACA,cACA,QACA,gBACA,YACA,eACA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"}